{"version":3,"sources":["../src/shared/email.vo.ts","../src/shared/hash-password.vo.ts","../src/shared/person-name.vo.ts","../src/shared/id.vo.ts","../src/shared/entity.ts","../src/shared/required-string.vo.ts","../src/shared/constants/colors.constants.ts","../src/shared/constants/priorities.constants.ts","../src/shared/constants/status.constants.ts","../src/shared/constants/timer.constants.ts","../src/shared/constants/limits.constants.ts","../src/shared/utils/date.utils.ts","../src/shared/utils/time.utils.ts","../src/shared/utils/string.utils.ts","../src/shared/utils/calculation.utils.ts","../src/shared/utils/color.utils.ts","../src/shared/validation/task.validation.ts","../src/shared/validation/project.validation.ts","../src/shared/validation/workspace.validation.ts","../src/shared/validation/tag.validation.ts","../src/shared/validation/user.validation.ts","../src/shared/validation/comment.validation.ts","../src/users/model/user.entity.ts","../src/users/usecase/change-user-name.usecase.ts","../src/users/usecase/register-user.usecase.ts","../src/users/usecase/user-by-email.usecase.ts","../src/users/usecase/user-login.usecase.ts","../src/tasks/model/task.entity.ts","../src/tasks/usecase/create-task.usecase.ts","../src/tasks/usecase/complete-task.usecase.ts","../src/tasks/usecase/soft-delete-task.usecase.ts","../src/tasks/usecase/restore-task.usecase.ts","../src/tasks/usecase/permanent-delete-task.usecase.ts","../src/tasks/usecase/get-deleted-tasks.usecase.ts","../src/workspaces/model/workspace.entity.ts","../src/workspaces/model/workspace-member.entity.ts","../src/workspaces/model/workspace-settings.entity.ts","../src/workspaces/model/workspace-audit-log.entity.ts","../src/workspaces/usecase/create-workspace.usecase.ts","../src/workspaces/usecase/add-member-to-workspace.usecase.ts","../src/workspaces/usecase/remove-member-from-workspace.usecase.ts","../src/workspaces/usecase/soft-delete-workspace.usecase.ts","../src/workspaces/usecase/restore-workspace.usecase.ts","../src/workspaces/usecase/permanent-delete-workspace.usecase.ts","../src/workspaces/usecase/get-deleted-workspaces.usecase.ts","../src/workspaces/usecase/archive-workspace.usecase.ts","../src/workspaces/model/workspace-invitation.entity.ts","../src/workspaces/usecase/invite-member.usecase.ts","../src/workspaces/usecase/accept-invitation.usecase.ts","../src/workspaces/usecase/update-workspace-settings.usecase.ts","../src/workspaces/usecase/get-workspace-settings.usecase.ts","../src/workspaces/usecase/create-audit-log.usecase.ts","../src/workspaces/usecase/get-workspace-audit-logs.usecase.ts","../src/projects/model/project.entity.ts","../src/projects/usecase/create-project.usecase.ts","../src/projects/usecase/update-project.usecase.ts","../src/projects/usecase/archive-project.usecase.ts","../src/projects/usecase/delete-project.usecase.ts","../src/projects/usecase/soft-delete-project.usecase.ts","../src/projects/usecase/restore-project.usecase.ts","../src/projects/usecase/permanent-delete-project.usecase.ts","../src/projects/usecase/get-deleted-projects.usecase.ts","../src/workflows/model/workflow.entity.ts","../src/workflows/usecase/create-workflow.usecase.ts","../src/workflows/usecase/list-workflows.usecase.ts","../src/workflows/usecase/update-workflow.usecase.ts","../src/workflows/usecase/delete-workflow.usecase.ts","../src/tags/model/tag.entity.ts","../src/tags/usecase/create-tag.usecase.ts","../src/tags/usecase/assign-tag-to-task.usecase.ts","../src/tags/usecase/remove-tag-from-task.usecase.ts","../src/tags/usecase/update-tag.usecase.ts","../src/timer/model/time-session.entity.ts","../src/timer/usecase/start-timer.usecase.ts","../src/timer/usecase/stop-timer.usecase.ts","../src/timer/usecase/pause-timer.usecase.ts","../src/timer/usecase/resume-timer.usecase.ts","../src/timer/usecase/switch-task.usecase.ts","../src/analytics/model/daily-metrics.entity.ts","../src/analytics/usecase/get-daily-metrics.usecase.ts","../src/analytics/usecase/update-daily-metrics.usecase.ts","../src/analytics/usecase/calculate-focus-score.usecase.ts","../src/ai/model/ai-profile.entity.ts","../src/ai/model/productivity-report.entity.ts","../src/ai/usecase/learn-from-session.usecase.ts","../src/ai/usecase/get-optimal-schedule.usecase.ts","../src/ai/usecase/predict-task-duration.usecase.ts","../src/ai/usecase/generate-weekly-report.usecase.ts","../src/ai/ai-service.ts","../src/habits/model/habit.entity.ts","../src/notes/model/note.entity.ts","../src/notes/usecase/create-note.usecase.ts","../src/notes/usecase/find-note.usecase.ts","../src/notes/usecase/update-note.usecase.ts","../src/notes/usecase/delete-note.usecase.ts","../src/notes/usecase/find-all-notes.usecase.ts","../src/comments/model/comment.entity.ts","../src/comments/usecase/create-comment.usecase.ts","../src/comments/usecase/update-comment.usecase.ts","../src/comments/usecase/delete-comment.usecase.ts","../src/comments/usecase/get-comments-by-task.usecase.ts","../src/comments/usecase/get-comments-by-user.usecase.ts","../src/comments/usecase/add-mention.usecase.ts","../src/comments/usecase/remove-mention.usecase.ts","../src/attachments/model/attachment.entity.ts","../src/attachments/usecase/create-attachment.usecase.ts","../src/attachments/usecase/mark-as-uploaded.usecase.ts","../src/attachments/usecase/delete-attachment.usecase.ts","../src/attachments/usecase/get-attachments-by-task.usecase.ts","../src/attachments/usecase/get-attachments-by-user.usecase.ts","../src/attachments/usecase/get-attachment-by-id.usecase.ts","../src/notifications/model/notification.entity.ts","../src/notifications/usecase/create-notification.usecase.ts","../src/notifications/usecase/mark-as-read.usecase.ts","../src/notifications/usecase/mark-all-as-read.usecase.ts","../src/notifications/usecase/mark-as-unread.usecase.ts","../src/notifications/usecase/get-unread-notifications.usecase.ts","../src/notifications/usecase/get-notification-by-id.usecase.ts","../src/notifications/usecase/get-notifications-by-type.usecase.ts","../src/notifications/usecase/delete-notification.usecase.ts","../src/notifications/usecase/count-unread-notifications.usecase.ts","../src/changelog/model/changelog-entry.entity.ts","../src/newsletter/model/newsletter-subscriber.entity.ts","../src/contact/model/contact-submission.entity.ts","../src/roadmap/model/roadmap-item.entity.ts","../src/roadmap/model/roadmap-vote.entity.ts","../src/blog/model/blog-post.entity.ts","../src/blog/model/blog-comment.entity.ts","../src/gamification/model/achievement.entity.ts","../src/gamification/model/user-achievement.entity.ts","../src/chat/model/chat-conversation.entity.ts","../src/chat/model/chat-message.entity.ts","../src/templates/model/task-template.entity.ts"],"sourcesContent":["import { ValueObject } from \"./value-object\";\r\n\r\nexport class Email implements ValueObject<Email, string> {\r\n  private readonly _value: string;\r\n\r\n  private constructor(value: string) {\r\n    this._value = value;\r\n  }\r\n\r\n  public static create(email: string): Email {\r\n    const finalEmail = email?.trim?.().toLowerCase();\r\n    this.validate(finalEmail);\r\n    return new Email(finalEmail);\r\n  }\r\n\r\n  private static validate(email: string): void {\r\n    if (!email || typeof email !== \"string\") {\r\n      throw new Error(\"O email não pode estar vazio\");\r\n    }\r\n\r\n    if (email.length > 254) {\r\n      throw new Error(\"O email deve ter no máximo 254 caracteres\");\r\n    }\r\n\r\n    const emailRegex =\r\n      /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-\\u00A0-\\uFFFF]+@[a-zA-Z0-9\\u00A0-\\uFFFF](?:[a-zA-Z0-9\\u00A0-\\uFFFF-]{0,61}[a-zA-Z0-9\\u00A0-\\uFFFF])?(?:\\.[a-zA-Z0-9\\u00A0-\\uFFFF](?:[a-zA-Z0-9\\u00A0-\\uFFFF-]{0,61}[a-zA-Z0-9\\u00A0-\\uFFFF])?)*$/;\r\n\r\n    if (!emailRegex.test(email)) {\r\n      throw new Error(\"O formato do email é inválido\");\r\n    }\r\n\r\n    const [localPart, domainPart] = email.split(\"@\");\r\n\r\n    if (localPart && localPart.includes(\"..\")) {\r\n      throw new Error(\r\n        \"O email não pode conter pontos consecutivos na parte local\"\r\n      );\r\n    }\r\n\r\n    // Verificar se não começa ou termina com ponto na parte local\r\n    if (localPart && (localPart.startsWith(\".\") || localPart.endsWith(\".\"))) {\r\n      throw new Error(\r\n        \"O email não pode começar ou terminar com ponto na parte local\"\r\n      );\r\n    }\r\n  }\r\n\r\n  public get value(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public get localPart(): string {\r\n    return this._value.split(\"@\")[0]!;\r\n  }\r\n\r\n  public get domain(): string {\r\n    return this._value.split(\"@\")[1]!;\r\n  }\r\n\r\n  public equals(other: Email): boolean {\r\n    if (!(other instanceof Email)) {\r\n      return false;\r\n    }\r\n    return this._value === other._value;\r\n  }\r\n\r\n  public toString(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public toJSON(): string {\r\n    return this._value;\r\n  }\r\n}\r\n","import { ValueObject } from \"./value-object\";\r\n\r\nexport class HashPassword implements ValueObject<HashPassword, string> {\r\n  private readonly _value: string;\r\n\r\n  private constructor(value: string) {\r\n    this._value = value;\r\n  }\r\n\r\n  public static create(hashPassword: string): HashPassword {\r\n    this.validate(hashPassword);\r\n    return new HashPassword(hashPassword.trim());\r\n  }\r\n\r\n  private static validate(hashPassword: string): void {\r\n    if (!hashPassword || typeof hashPassword !== \"string\") {\r\n      throw new Error(\"O hash da senha não pode estar vazio\");\r\n    }\r\n\r\n    const trimmedHash = hashPassword.trim();\r\n\r\n    if (trimmedHash.length === 0) {\r\n      throw new Error(\"O hash da senha não pode estar vazio\");\r\n    }\r\n\r\n    // Regex para validar hash bcrypt (formato: $2a$, $2b$, $2x$, $2y$ seguido de cost e hash)\r\n    const bcryptRegex = /^\\$2[abxy]\\$\\d{2}\\$[A-Za-z0-9.\\/]{53}$/;\r\n\r\n    if (!bcryptRegex.test(trimmedHash)) {\r\n      throw new Error(\"A senha deve estar criptografada\");\r\n    }\r\n  }\r\n\r\n  public get value(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public get algorithm(): string {\r\n    return this._value.split(\"$\")[1]!;\r\n  }\r\n\r\n  public get cost(): number {\r\n    return parseInt(this._value.split(\"$\")[2]!, 10);\r\n  }\r\n\r\n  public equals(other: HashPassword): boolean {\r\n    if (!(other instanceof HashPassword)) {\r\n      return false;\r\n    }\r\n    return this._value === other._value;\r\n  }\r\n\r\n  public toString(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public toJSON(): string {\r\n    return this._value;\r\n  }\r\n}\r\n","import { ValueObject } from \"./value-object\";\r\n\r\nexport class PersonName implements ValueObject<PersonName, string> {\r\n  private readonly _value: string;\r\n\r\n  private constructor(value: string) {\r\n    this._value = value;\r\n  }\r\n\r\n  public static create(name: string): PersonName {\r\n    this.validate(name);\r\n    return new PersonName(name.trim());\r\n  }\r\n\r\n  private static validate(name: string): void {\r\n    if (!name || typeof name !== \"string\") {\r\n      throw new Error(\"O nome é obrigatório e deve ser uma string\");\r\n    }\r\n\r\n    const trimmedName = name.trim();\r\n\r\n    if (trimmedName.length < 3) {\r\n      throw new Error(\"O nome deve ter pelo menos 3 caracteres\");\r\n    }\r\n\r\n    if (trimmedName.length > 120) {\r\n      throw new Error(\"O nome deve ter no máximo 120 caracteres\");\r\n    }\r\n\r\n    const validNameRegex =\r\n      /^[a-zA-ZÀ-ÿ\\u0100-\\u017F\\u0180-\\u024F\\u1E00-\\u1EFF\\s'-]+$/;\r\n    if (!validNameRegex.test(trimmedName)) {\r\n      throw new Error(\r\n        \"O nome contém caracteres inválidos. Apenas letras, espaços, apóstrofes e hífens são permitidos\"\r\n      );\r\n    }\r\n\r\n    const nameParts = trimmedName\r\n      .split(/\\s+/)\r\n      .filter((part) => part.length > 0);\r\n    if (nameParts.length < 2) {\r\n      throw new Error(\"O nome deve conter pelo menos um nome e um sobrenome\");\r\n    }\r\n\r\n    if (/\\s{2,}/.test(trimmedName)) {\r\n      throw new Error(\"O nome não pode conter espaços múltiplos consecutivos\");\r\n    }\r\n\r\n    // Validar se não começa ou termina com caracteres especiais\r\n    if (/^[-'\\s]|[-'\\s]$/.test(trimmedName)) {\r\n      throw new Error(\r\n        \"O nome não pode começar ou terminar com espaços, hífens ou apóstrofes\"\r\n      );\r\n    }\r\n  }\r\n\r\n  public get value(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public get firstName(): string {\r\n    const firstName = this._value.split(\" \")[0];\r\n    return firstName!;\r\n  }\r\n\r\n  public get lastName(): string {\r\n    const parts = this._value.split(\" \");\r\n    const lastName = parts[parts.length - 1];\r\n    return lastName!;\r\n  }\r\n\r\n  public get fullName(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public get initials(): string {\r\n    const nameParts = this.value\r\n      .trim()\r\n      .split(/\\s+/)\r\n      .filter((part) => part.length > 0);\r\n\r\n    return (this.firstName.charAt(0) + this.lastName.charAt(0)).toUpperCase();\r\n  }\r\n\r\n  public equals(other: PersonName): boolean {\r\n    if (!(other instanceof PersonName)) {\r\n      return false;\r\n    }\r\n    return this._value.toLowerCase() === other._value.toLowerCase();\r\n  }\r\n\r\n  public toString(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public toJSON(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public toFormattedString(): string {\r\n    return this._value\r\n      .split(\" \")\r\n      .map((name) => name.charAt(0).toUpperCase() + name.slice(1).toLowerCase())\r\n      .join(\" \");\r\n  }\r\n}\r\n","import { ValueObject } from \"./value-object\";\r\nimport { v4 as uuidv4, validate as isUuid } from \"uuid\";\r\n\r\nexport class Id implements ValueObject<Id, string> {\r\n  private readonly _value: string;\r\n\r\n  private constructor(value: string) {\r\n    this._value = value;\r\n  }\r\n\r\n  public static create(id?: string): Id {\r\n    const value = id?.trim().toLowerCase() ?? uuidv4();\r\n    this.validate(value);\r\n    return new Id(value);\r\n  }\r\n\r\n  private static validate(id: string): void {\r\n    if (!isUuid(id)) {\r\n      throw new Error(\"O id fornecido não é um UUID válido.\");\r\n    }\r\n  }\r\n\r\n  public get value(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public equals(other: Id): boolean {\r\n    return other instanceof Id && this._value === other._value;\r\n  }\r\n\r\n  public toString(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public toJSON(): string {\r\n    return this._value;\r\n  }\r\n}\r\n","import { Id } from \"./id.vo\";\r\n\r\nexport type EntityMode = \"draft\" | \"valid\";\r\n\r\nexport interface EntityProps<ID = string | number> {\r\n  id?: ID;\r\n}\r\n\r\nexport abstract class Entity<PROPS extends EntityProps> {\r\n  public readonly props: Readonly<PROPS>;\r\n  public readonly mode: EntityMode = \"valid\";\r\n  public readonly id: NonNullable<PROPS[\"id\"]>;\r\n\r\n  constructor(props: Readonly<PROPS>, mode: EntityMode = \"valid\") {\r\n    this.props = Object.freeze({\r\n      ...props,\r\n      id: props.id ? props.id : Id.create().value,\r\n    });\r\n    this.mode = mode;\r\n    this.id = this.props.id!;\r\n\r\n    if (\"props\" in props) {\r\n      throw new Error(\"Props should not contain 'props' property\");\r\n    }\r\n  }\r\n\r\n  get data(): Readonly<PROPS> {\r\n    return this.props;\r\n  }\r\n\r\n  isDraft(): boolean {\r\n    return this.mode === \"draft\";\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return this.mode === \"valid\";\r\n  }\r\n\r\n  equals(entity?: unknown): boolean {\r\n    if (entity == null) return false;\r\n    if (!(entity instanceof Entity)) return false;\r\n    if (this === entity) return true;\r\n    if (this.constructor !== entity.constructor) return false;\r\n    return this.sameId(entity as Entity<PROPS>);\r\n  }\r\n\r\n  notEquals(entity?: unknown): boolean {\r\n    return !this.equals(entity);\r\n  }\r\n\r\n  protected sameId(other: Entity<PROPS>): boolean {\r\n    return this.id === other.id;\r\n  }\r\n\r\n  asDraft(): this {\r\n    return this.clone(this.props, \"draft\");\r\n  }\r\n\r\n  asValid(): this {\r\n    return this.clone(this.props, \"valid\");\r\n  }\r\n\r\n  clone(newProps: Partial<PROPS>, newMode: EntityMode = this.mode): this {\r\n    const Self = this.constructor as new (\r\n      props: Readonly<PROPS>,\r\n      mode: EntityMode,\r\n    ) => this;\r\n    return new Self(\r\n      {\r\n        ...this.props,\r\n        ...newProps,\r\n      },\r\n      newMode,\r\n    );\r\n  }\r\n}\r\n","import { ValueObject } from \"./value-object\";\r\n\r\nexport interface RequiredStringOptions {\r\n  attributeName?: string;\r\n  errorMessage?: string;\r\n  minLength?: number;\r\n  maxLength?: number;\r\n}\r\n\r\nexport class RequiredString implements ValueObject<RequiredString, string> {\r\n  private readonly _value: string;\r\n\r\n  private constructor(value: string) {\r\n    this._value = value;\r\n  }\r\n\r\n  public static create(\r\n    value: string,\r\n    options?: RequiredStringOptions\r\n  ): RequiredString {\r\n    this.validate(value, options);\r\n    return new RequiredString(value.trim());\r\n  }\r\n\r\n  private static validate(\r\n    value: string,\r\n    options?: RequiredStringOptions\r\n  ): void {\r\n    const errorMessage =\r\n      options?.errorMessage ||\r\n      `${options?.attributeName ?? \"Valor\"} é obrigatório`;\r\n\r\n    if (!value || typeof value !== \"string\") {\r\n      throw new Error(errorMessage);\r\n    }\r\n\r\n    const trimmedValue = value.trim();\r\n\r\n    if (trimmedValue.length === 0) {\r\n      throw new Error(errorMessage);\r\n    }\r\n\r\n    if (options?.minLength && trimmedValue.length < options.minLength) {\r\n      throw new Error(\r\n        `${options.attributeName ?? `\"${value}\"`} deve ter pelo menos ${options.minLength} caracteres`\r\n      );\r\n    }\r\n\r\n    if (options?.maxLength && trimmedValue.length > options.maxLength) {\r\n      throw new Error(\r\n        `${options.attributeName ?? `\"${value}\"`} deve ter no máximo ${options.maxLength} caracteres`\r\n      );\r\n    }\r\n  }\r\n\r\n  public get value(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public equals(other: RequiredString): boolean {\r\n    return other instanceof RequiredString && this._value === other._value;\r\n  }\r\n\r\n  public toString(): string {\r\n    return this._value;\r\n  }\r\n\r\n  public toJSON(): string {\r\n    return this._value;\r\n  }\r\n}\r\n","/**\r\n * Shared color constants for Projects, Tags, and Workspaces\r\n * These colors are used across all applications (Web, Mobile, Desktop)\r\n */\r\n\r\nexport const PROJECT_COLORS = [\r\n    \"#EF4444\", // red\r\n    \"#F59E0B\", // amber\r\n    \"#10B981\", // emerald\r\n    \"#3B82F6\", // blue\r\n    \"#8B5CF6\", // violet\r\n    \"#EC4899\", // pink\r\n    \"#6B7280\", // gray\r\n] as const;\r\n\r\nexport const TAG_COLORS = [\r\n    \"#EF4444\", // red\r\n    \"#F59E0B\", // amber\r\n    \"#10B981\", // emerald\r\n    \"#3B82F6\", // blue\r\n    \"#8B5CF6\", // violet\r\n    \"#EC4899\", // pink\r\n    \"#06B6D4\", // cyan\r\n    \"#F43F5E\", // rose\r\n    \"#84CC16\", // lime\r\n    \"#6366F1\", // indigo\r\n] as const;\r\n\r\nexport const WORKSPACE_COLORS = {\r\n    PERSONAL: \"#06B6D4\", // cyan\r\n    WORK: \"#8B5CF6\",     // violet/purple\r\n    TEAM: \"#EC4899\",     // pink\r\n} as const;\r\n\r\nexport type ProjectColor = typeof PROJECT_COLORS[number];\r\nexport type TagColor = typeof TAG_COLORS[number];\r\nexport type WorkspaceColor = typeof WORKSPACE_COLORS[keyof typeof WORKSPACE_COLORS];\r\n","/**\r\n * Task priority constants with labels and colors\r\n * Used across all applications for consistent priority handling\r\n */\r\n\r\nexport const TASK_PRIORITIES = {\r\n    LOW: {\r\n        value: \"LOW\" as const,\r\n        label: \"Low\",\r\n        color: \"#10B981\", // emerald\r\n        order: 1,\r\n    },\r\n    MEDIUM: {\r\n        value: \"MEDIUM\" as const,\r\n        label: \"Medium\",\r\n        color: \"#F59E0B\", // amber\r\n        order: 2,\r\n    },\r\n    HIGH: {\r\n        value: \"HIGH\" as const,\r\n        label: \"High\",\r\n        color: \"#EF4444\", // red\r\n        order: 3,\r\n    },\r\n} as const;\r\n\r\nexport const PRIORITY_VALUES = [\"LOW\", \"MEDIUM\", \"HIGH\"] as const;\r\n\r\n/**\r\n * Task priority type\r\n * Note: TaskPriority is defined in tasks domain, so we use TaskPriorityValue here\r\n */\r\nexport type TaskPriorityValue = typeof PRIORITY_VALUES[number];\r\n\r\n/**\r\n * Get priority configuration by value\r\n */\r\nexport function getPriorityConfig(priority: TaskPriorityValue) {\r\n    return TASK_PRIORITIES[priority];\r\n}\r\n\r\n/**\r\n * Get priority color\r\n */\r\nexport function getPriorityColor(priority: TaskPriorityValue): string {\r\n    return TASK_PRIORITIES[priority].color;\r\n}\r\n\r\n/**\r\n * Get priority label\r\n */\r\nexport function getPriorityLabel(priority: TaskPriorityValue): string {\r\n    return TASK_PRIORITIES[priority].label;\r\n}\r\n","/**\r\n * Task and Project status constants\r\n * Used across all applications for consistent status handling\r\n */\r\n\r\nexport const TASK_STATUS = {\r\n    TODO: {\r\n        value: \"TODO\" as const,\r\n        label: \"To Do\",\r\n        color: \"#6B7280\", // gray\r\n        order: 1,\r\n    },\r\n    IN_PROGRESS: {\r\n        value: \"IN_PROGRESS\" as const,\r\n        label: \"In Progress\",\r\n        color: \"#3B82F6\", // blue\r\n        order: 2,\r\n    },\r\n    IN_REVIEW: {\r\n        value: \"IN_REVIEW\" as const,\r\n        label: \"In Review\",\r\n        color: \"#F59E0B\", // amber\r\n        order: 3,\r\n    },\r\n    DONE: {\r\n        value: \"DONE\" as const,\r\n        label: \"Done\",\r\n        color: \"#10B981\", // emerald\r\n        order: 4,\r\n    },\r\n    CANCELLED: {\r\n        value: \"CANCELLED\" as const,\r\n        label: \"Cancelled\",\r\n        color: \"#EF4444\", // red\r\n        order: 5,\r\n    },\r\n} as const;\r\n\r\nexport const TASK_STATUS_VALUES = [\r\n    \"TODO\",\r\n    \"IN_PROGRESS\",\r\n    \"IN_REVIEW\",\r\n    \"DONE\",\r\n    \"CANCELLED\",\r\n] as const;\r\n\r\n/**\r\n * Task status type\r\n * Note: TaskStatus is defined in tasks domain, so we use TaskStatusValue here\r\n */\r\nexport type TaskStatusValue = typeof TASK_STATUS_VALUES[number];\r\n\r\n/**\r\n * Project status constants\r\n */\r\nexport const PROJECT_STATUS = {\r\n    ACTIVE: {\r\n        value: \"ACTIVE\" as const,\r\n        label: \"Active\",\r\n        color: \"#10B981\", // emerald\r\n    },\r\n    ARCHIVED: {\r\n        value: \"ARCHIVED\" as const,\r\n        label: \"Archived\",\r\n        color: \"#6B7280\", // gray\r\n    },\r\n    ON_HOLD: {\r\n        value: \"ON_HOLD\" as const,\r\n        label: \"On Hold\",\r\n        color: \"#F59E0B\", // amber\r\n    },\r\n} as const;\r\n\r\nexport const PROJECT_STATUS_VALUES = [\"ACTIVE\", \"ARCHIVED\", \"ON_HOLD\"] as const;\r\n\r\n/**\r\n * Project status type\r\n * Note: ProjectStatus might be defined elsewhere, so we use ProjectStatusValue here\r\n */\r\nexport type ProjectStatusValue = typeof PROJECT_STATUS_VALUES[number];\r\n\r\n/**\r\n * Get task status configuration by value\r\n */\r\nexport function getTaskStatusConfig(status: TaskStatusValue) {\r\n    return TASK_STATUS[status];\r\n}\r\n\r\n/**\r\n * Get task status color\r\n */\r\nexport function getTaskStatusColor(status: TaskStatusValue): string {\r\n    return TASK_STATUS[status].color;\r\n}\r\n\r\n/**\r\n * Get task status label\r\n */\r\nexport function getTaskStatusLabel(status: TaskStatusValue): string {\r\n    return TASK_STATUS[status].label;\r\n}\r\n\r\n/**\r\n * Check if task is completed\r\n */\r\nexport function isTaskCompleted(status: TaskStatusValue): boolean {\r\n    return status === \"DONE\";\r\n}\r\n\r\n/**\r\n * Check if task is in progress\r\n */\r\nexport function isTaskInProgress(status: TaskStatusValue): boolean {\r\n    return status === \"IN_PROGRESS\" || status === \"IN_REVIEW\";\r\n}\r\n","/**\r\n * Pomodoro Timer constants\r\n * Used across all applications for consistent timer behavior\r\n */\r\n\r\nexport const TIMER_MODES = {\r\n    WORK: {\r\n        value: \"WORK\" as const,\r\n        label: \"Work\",\r\n        color: \"#EF4444\", // red\r\n        defaultDuration: 25, // minutes\r\n    },\r\n    SHORT_BREAK: {\r\n        value: \"SHORT_BREAK\" as const,\r\n        label: \"Short Break\",\r\n        color: \"#10B981\", // light green\r\n        defaultDuration: 5, // minutes\r\n    },\r\n    LONG_BREAK: {\r\n        value: \"LONG_BREAK\" as const,\r\n        label: \"Long Break\",\r\n        color: \"#059669\", // dark green\r\n        defaultDuration: 15, // minutes\r\n    },\r\n    CONTINUOUS: {\r\n        value: \"CONTINUOUS\" as const,\r\n        label: \"Continuous\",\r\n        color: \"#3B82F6\", // blue\r\n        defaultDuration: 0, // no limit\r\n    },\r\n} as const;\r\n\r\nexport const TIMER_MODE_VALUES = [\r\n    \"WORK\",\r\n    \"SHORT_BREAK\",\r\n    \"LONG_BREAK\",\r\n    \"CONTINUOUS\",\r\n] as const;\r\n\r\nexport type TimerMode = typeof TIMER_MODE_VALUES[number];\r\n\r\n/**\r\n * Default Pomodoro settings\r\n */\r\nexport const DEFAULT_POMODORO_SETTINGS = {\r\n    workDuration: 25, // minutes\r\n    shortBreakDuration: 5, // minutes\r\n    longBreakDuration: 15, // minutes\r\n    pomodorosUntilLongBreak: 4, // number of work sessions\r\n    autoStartBreaks: false,\r\n    autoStartPomodoros: false,\r\n    soundEnabled: true,\r\n    notificationsEnabled: true,\r\n} as const;\r\n\r\n/**\r\n * Timer limits and constraints\r\n */\r\nexport const TIMER_LIMITS = {\r\n    MIN_DURATION: 1, // minutes\r\n    MAX_DURATION: 120, // minutes\r\n    MIN_POMODOROS_UNTIL_LONG_BREAK: 2,\r\n    MAX_POMODOROS_UNTIL_LONG_BREAK: 10,\r\n} as const;\r\n\r\n/**\r\n * Get timer mode configuration\r\n */\r\nexport function getTimerModeConfig(mode: TimerMode) {\r\n    return TIMER_MODES[mode];\r\n}\r\n\r\n/**\r\n * Get timer mode color\r\n */\r\nexport function getTimerModeColor(mode: TimerMode): string {\r\n    return TIMER_MODES[mode].color;\r\n}\r\n\r\n/**\r\n * Get timer mode label\r\n */\r\nexport function getTimerModeLabel(mode: TimerMode): string {\r\n    return TIMER_MODES[mode].label;\r\n}\r\n\r\n/**\r\n * Get timer mode default duration\r\n */\r\nexport function getTimerModeDefaultDuration(mode: TimerMode): number {\r\n    return TIMER_MODES[mode].defaultDuration;\r\n}\r\n\r\n/**\r\n * Check if it's time for a long break\r\n */\r\nexport function shouldTakeLongBreak(\r\n    completedPomodoros: number,\r\n    pomodorosUntilLongBreak: number = DEFAULT_POMODORO_SETTINGS.pomodorosUntilLongBreak\r\n): boolean {\r\n    return completedPomodoros > 0 && completedPomodoros % pomodorosUntilLongBreak === 0;\r\n}\r\n","/**\r\n * Application limits and constraints\r\n * Used across all applications for validation and UI constraints\r\n */\r\n\r\n/**\r\n * Task limits\r\n */\r\nexport const TASK_LIMITS = {\r\n    TITLE_MIN_LENGTH: 1,\r\n    TITLE_MAX_LENGTH: 200,\r\n    DESCRIPTION_MAX_LENGTH: 5000,\r\n    MIN_ESTIMATED_MINUTES: 1,\r\n    MAX_ESTIMATED_MINUTES: 480, // 8 hours\r\n    MAX_SUBTASKS: 50,\r\n    MAX_TAGS_PER_TASK: 10,\r\n    MAX_ATTACHMENTS_PER_TASK: 20,\r\n} as const;\r\n\r\n/**\r\n * Project limits\r\n */\r\nexport const PROJECT_LIMITS = {\r\n    NAME_MIN_LENGTH: 1,\r\n    NAME_MAX_LENGTH: 100,\r\n    DESCRIPTION_MAX_LENGTH: 2000,\r\n    MAX_PROJECTS_PER_WORKSPACE: 100,\r\n    MAX_TASKS_PER_PROJECT: 1000,\r\n} as const;\r\n\r\n/**\r\n * Workspace limits\r\n */\r\nexport const WORKSPACE_LIMITS = {\r\n    NAME_MIN_LENGTH: 1,\r\n    NAME_MAX_LENGTH: 100,\r\n    DESCRIPTION_MAX_LENGTH: 500,\r\n    MAX_MEMBERS: 50,\r\n    MAX_WORKSPACES_PER_USER: 20,\r\n    SLUG_MIN_LENGTH: 3,\r\n    SLUG_MAX_LENGTH: 50,\r\n} as const;\r\n\r\n/**\r\n * Tag limits\r\n */\r\nexport const TAG_LIMITS = {\r\n    NAME_MIN_LENGTH: 1,\r\n    NAME_MAX_LENGTH: 30,\r\n    MAX_TAGS_PER_WORKSPACE: 100,\r\n} as const;\r\n\r\n/**\r\n * Comment limits\r\n */\r\nexport const COMMENT_LIMITS = {\r\n    CONTENT_MIN_LENGTH: 1,\r\n    CONTENT_MAX_LENGTH: 2000,\r\n    MAX_COMMENTS_PER_TASK: 500,\r\n} as const;\r\n\r\n/**\r\n * File upload limits\r\n */\r\nexport const FILE_LIMITS = {\r\n    MAX_FILE_SIZE: 10 * 1024 * 1024, // 10 MB\r\n    MAX_IMAGE_SIZE: 5 * 1024 * 1024, // 5 MB\r\n    MAX_TOTAL_STORAGE_PER_WORKSPACE: 1024 * 1024 * 1024, // 1 GB\r\n    ALLOWED_IMAGE_TYPES: [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"],\r\n    ALLOWED_DOCUMENT_TYPES: [\r\n        \"application/pdf\",\r\n        \"application/msword\",\r\n        \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\r\n        \"application/vnd.ms-excel\",\r\n        \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\r\n    ],\r\n} as const;\r\n\r\n/**\r\n * User limits\r\n */\r\nexport const USER_LIMITS = {\r\n    NAME_MIN_LENGTH: 2,\r\n    NAME_MAX_LENGTH: 100,\r\n    PASSWORD_MIN_LENGTH: 6,\r\n    PASSWORD_MAX_LENGTH: 128,\r\n    BIO_MAX_LENGTH: 500,\r\n} as const;\r\n\r\n/**\r\n * Pagination limits\r\n */\r\nexport const PAGINATION_LIMITS = {\r\n    DEFAULT_PAGE_SIZE: 20,\r\n    MAX_PAGE_SIZE: 100,\r\n    MIN_PAGE_SIZE: 5,\r\n} as const;\r\n\r\n/**\r\n * Helper function to format file size\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n    if (bytes === 0) return \"0 Bytes\";\r\n    const k = 1024;\r\n    const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + \" \" + sizes[i];\r\n}\r\n\r\n/**\r\n * Check if file type is allowed\r\n */\r\nexport function isAllowedFileType(mimeType: string): boolean {\r\n    const allowedTypes: readonly string[] = [\r\n        ...FILE_LIMITS.ALLOWED_IMAGE_TYPES,\r\n        ...FILE_LIMITS.ALLOWED_DOCUMENT_TYPES,\r\n    ];\r\n    return allowedTypes.includes(mimeType);\r\n}\r\n\r\n/**\r\n * Check if file is an image\r\n */\r\nexport function isImageFile(mimeType: string): boolean {\r\n    return (FILE_LIMITS.ALLOWED_IMAGE_TYPES as readonly string[]).includes(mimeType);\r\n}\r\n\r\n/**\r\n * Notification limits\r\n */\r\nexport const NOTIFICATION_LIMITS = {\r\n    TITLE_MIN_LENGTH: 1,\r\n    TITLE_MAX_LENGTH: 200,\r\n    MESSAGE_MAX_LENGTH: 1000,\r\n    ACTION_LABEL_MAX_LENGTH: 50,\r\n    ACTION_URL_MAX_LENGTH: 2048,\r\n    MAX_NOTIFICATIONS_PER_USER: 500,\r\n} as const;\r\n","/**\r\n * Date utility functions\r\n * Used across all applications for consistent date handling\r\n */\r\n\r\n/**\r\n * Format a date to a readable string\r\n */\r\nexport function formatDate(date: Date | string, locale: string = \"en-US\"): string {\r\n    const d = typeof date === \"string\" ? new Date(date) : date;\r\n    return d.toLocaleDateString(locale, {\r\n        year: \"numeric\",\r\n        month: \"long\",\r\n        day: \"numeric\",\r\n    });\r\n}\r\n\r\n/**\r\n * Format a date to a short string (e.g., \"Dec 4, 2025\")\r\n */\r\nexport function formatDateShort(date: Date | string, locale: string = \"en-US\"): string {\r\n    const d = typeof date === \"string\" ? new Date(date) : date;\r\n    return d.toLocaleDateString(locale, {\r\n        year: \"numeric\",\r\n        month: \"short\",\r\n        day: \"numeric\",\r\n    });\r\n}\r\n\r\n/**\r\n * Format a date to relative time (e.g., \"2 days ago\", \"in 3 hours\")\r\n */\r\nexport function formatRelativeTime(date: Date | string, locale: string = \"en-US\"): string {\r\n    const d = typeof date === \"string\" ? new Date(date) : date;\r\n    const now = new Date();\r\n    const diffMs = d.getTime() - now.getTime();\r\n    const diffSec = Math.round(diffMs / 1000);\r\n    const diffMin = Math.round(diffSec / 60);\r\n    const diffHour = Math.round(diffMin / 60);\r\n    const diffDay = Math.round(diffHour / 24);\r\n\r\n    if (Math.abs(diffSec) < 60) {\r\n        return diffSec >= 0 ? \"in a few seconds\" : \"a few seconds ago\";\r\n    } else if (Math.abs(diffMin) < 60) {\r\n        return diffMin >= 0 ? `in ${diffMin} minute${diffMin !== 1 ? \"s\" : \"\"}` : `${Math.abs(diffMin)} minute${Math.abs(diffMin) !== 1 ? \"s\" : \"\"} ago`;\r\n    } else if (Math.abs(diffHour) < 24) {\r\n        return diffHour >= 0 ? `in ${diffHour} hour${diffHour !== 1 ? \"s\" : \"\"}` : `${Math.abs(diffHour)} hour${Math.abs(diffHour) !== 1 ? \"s\" : \"\"} ago`;\r\n    } else if (Math.abs(diffDay) < 30) {\r\n        return diffDay >= 0 ? `in ${diffDay} day${diffDay !== 1 ? \"s\" : \"\"}` : `${Math.abs(diffDay)} day${Math.abs(diffDay) !== 1 ? \"s\" : \"\"} ago`;\r\n    } else {\r\n        return formatDateShort(d, locale);\r\n    }\r\n}\r\n\r\n/**\r\n * Check if a date is today\r\n */\r\nexport function isToday(date: Date | string): boolean {\r\n    const d = typeof date === \"string\" ? new Date(date) : date;\r\n    const today = new Date();\r\n    return (\r\n        d.getDate() === today.getDate() &&\r\n        d.getMonth() === today.getMonth() &&\r\n        d.getFullYear() === today.getFullYear()\r\n    );\r\n}\r\n\r\n/**\r\n * Check if a date is in the past\r\n */\r\nexport function isPast(date: Date | string): boolean {\r\n    const d = typeof date === \"string\" ? new Date(date) : date;\r\n    return d.getTime() < new Date().getTime();\r\n}\r\n\r\n/**\r\n * Check if a date is in the future\r\n */\r\nexport function isFuture(date: Date | string): boolean {\r\n    const d = typeof date === \"string\" ? new Date(date) : date;\r\n    return d.getTime() > new Date().getTime();\r\n}\r\n\r\n/**\r\n * Check if a task is overdue\r\n */\r\nexport function isOverdue(dueDate: Date | string | null | undefined): boolean {\r\n    if (!dueDate) return false;\r\n    const d = typeof dueDate === \"string\" ? new Date(dueDate) : dueDate;\r\n    return isPast(d) && !isToday(d);\r\n}\r\n\r\n/**\r\n * Get the difference in days between two dates\r\n */\r\nexport function getDaysDiff(date1: Date | string, date2: Date | string): number {\r\n    const d1 = typeof date1 === \"string\" ? new Date(date1) : date1;\r\n    const d2 = typeof date2 === \"string\" ? new Date(date2) : date2;\r\n    const diffMs = d2.getTime() - d1.getTime();\r\n    return Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n}\r\n\r\n/**\r\n * Get the start of day for a date\r\n */\r\nexport function startOfDay(date: Date | string): Date {\r\n    const d = typeof date === \"string\" ? new Date(date) : new Date(date);\r\n    d.setHours(0, 0, 0, 0);\r\n    return d;\r\n}\r\n\r\n/**\r\n * Get the end of day for a date\r\n */\r\nexport function endOfDay(date: Date | string): Date {\r\n    const d = typeof date === \"string\" ? new Date(date) : new Date(date);\r\n    d.setHours(23, 59, 59, 999);\r\n    return d;\r\n}\r\n\r\n/**\r\n * Get the start of week for a date\r\n */\r\nexport function startOfWeek(date: Date | string): Date {\r\n    const d = typeof date === \"string\" ? new Date(date) : new Date(date);\r\n    const day = d.getDay();\r\n    const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday\r\n    const startDate = new Date(d.setDate(diff));\r\n    startDate.setHours(0, 0, 0, 0);\r\n    return startDate;\r\n}\r\n\r\n/**\r\n * Get the end of week for a date\r\n */\r\nexport function endOfWeek(date: Date | string): Date {\r\n    const d = typeof date === \"string\" ? new Date(date) : new Date(date);\r\n    const day = d.getDay();\r\n    const diff = d.getDate() + (day === 0 ? 0 : 7 - day);\r\n    const endDate = new Date(d.setDate(diff));\r\n    endDate.setHours(23, 59, 59, 999);\r\n    return endDate;\r\n}\r\n\r\n/**\r\n * Add days to a date\r\n */\r\nexport function addDays(date: Date | string, days: number): Date {\r\n    const d = typeof date === \"string\" ? new Date(date) : new Date(date);\r\n    d.setDate(d.getDate() + days);\r\n    return d;\r\n}\r\n\r\n/**\r\n * Add hours to a date\r\n */\r\nexport function addHours(date: Date | string, hours: number): Date {\r\n    const d = typeof date === \"string\" ? new Date(date) : new Date(date);\r\n    d.setHours(d.getHours() + hours);\r\n    return d;\r\n}\r\n\r\n/**\r\n * Add minutes to a date\r\n */\r\nexport function addMinutes(date: Date | string, minutes: number): Date {\r\n    const d = typeof date === \"string\" ? new Date(date) : new Date(date);\r\n    d.setMinutes(d.getMinutes() + minutes);\r\n    return d;\r\n}\r\n\r\n// ============ SMART DATES UTILITIES ============\r\n\r\n/**\r\n * Get the start of today\r\n */\r\nexport function startOfToday(): Date {\r\n    return startOfDay(new Date());\r\n}\r\n\r\n/**\r\n * Check if date1 is before date2\r\n */\r\nexport function isBefore(date1: Date | string, date2: Date | string): boolean {\r\n    const d1 = typeof date1 === \"string\" ? new Date(date1) : date1;\r\n    const d2 = typeof date2 === \"string\" ? new Date(date2) : date2;\r\n    return d1.getTime() < d2.getTime();\r\n}\r\n\r\n/**\r\n * Check if date1 is after date2\r\n */\r\nexport function isAfter(date1: Date | string, date2: Date | string): boolean {\r\n    const d1 = typeof date1 === \"string\" ? new Date(date1) : date1;\r\n    const d2 = typeof date2 === \"string\" ? new Date(date2) : date2;\r\n    return d1.getTime() > d2.getTime();\r\n}\r\n\r\n/**\r\n * Check if a task is available to work on (startDate <= today or no startDate)\r\n */\r\nexport function isTaskAvailable(task: { startDate?: Date | string | null }): boolean {\r\n    if (!task.startDate) return true;\r\n    const startDate = typeof task.startDate === \"string\" ? new Date(task.startDate) : task.startDate;\r\n    return startDate <= new Date();\r\n}\r\n\r\n/**\r\n * Check if a task is scheduled for today\r\n */\r\nexport function isScheduledForToday(task: { scheduledDate?: Date | string | null }): boolean {\r\n    if (!task.scheduledDate) return false;\r\n    return isToday(task.scheduledDate);\r\n}\r\n\r\n/**\r\n * Check if a task is due today\r\n */\r\nexport function isDueToday(task: { dueDate?: Date | string | null }): boolean {\r\n    if (!task.dueDate) return false;\r\n    return isToday(task.dueDate);\r\n}\r\n\r\n/**\r\n * Task interface for categorization\r\n */\r\ninterface TaskForCategorization {\r\n    dueDate?: Date | string | null;\r\n    startDate?: Date | string | null;\r\n    scheduledDate?: Date | string | null;\r\n    status?: string;\r\n}\r\n\r\n/**\r\n * Categorize tasks by availability and dates\r\n */\r\nexport function categorizeTasksByAvailability<T extends TaskForCategorization>(tasks: T[]): {\r\n    overdue: T[];\r\n    dueToday: T[];\r\n    scheduledToday: T[];\r\n    available: T[];\r\n    notYetAvailable: T[];\r\n} {\r\n    const today = startOfToday();\r\n\r\n    return {\r\n        overdue: tasks.filter(t =>\r\n            t.dueDate &&\r\n            isBefore(t.dueDate, today) &&\r\n            t.status !== 'COMPLETED'\r\n        ),\r\n        dueToday: tasks.filter(t =>\r\n            t.dueDate &&\r\n            isToday(t.dueDate)\r\n        ),\r\n        scheduledToday: tasks.filter(t =>\r\n            t.scheduledDate &&\r\n            isToday(t.scheduledDate)\r\n        ),\r\n        available: tasks.filter(t =>\r\n            isTaskAvailable(t) &&\r\n            !isScheduledForToday(t) &&\r\n            t.status !== 'COMPLETED'\r\n        ),\r\n        notYetAvailable: tasks.filter(t =>\r\n            !isTaskAvailable(t)\r\n        ),\r\n    };\r\n}\r\n\r\n/**\r\n * Get tasks that can be worked on today (available and not blocked)\r\n */\r\nexport function getWorkableTasks<T extends TaskForCategorization>(tasks: T[]): T[] {\r\n    return tasks.filter(t =>\r\n        isTaskAvailable(t) &&\r\n        t.status !== 'COMPLETED' &&\r\n        t.status !== 'CANCELLED'\r\n    );\r\n}\r\n\r\n/**\r\n * Format scheduled time for display\r\n */\r\nexport function formatScheduledDateTime(\r\n    scheduledDate: Date | string | null | undefined,\r\n    scheduledTime: string | null | undefined,\r\n    locale: string = \"en-US\"\r\n): string | null {\r\n    if (!scheduledDate) return null;\r\n\r\n    const dateStr = formatDateShort(scheduledDate, locale);\r\n\r\n    if (scheduledTime) {\r\n        return `${dateStr} at ${scheduledTime}`;\r\n    }\r\n\r\n    return dateStr;\r\n}\r\n","/**\r\n * Time utility functions\r\n * Used across all applications for consistent time formatting and calculations\r\n */\r\n\r\n/**\r\n * Format duration in minutes to human-readable string (e.g., \"2h 30m\")\r\n */\r\nexport function formatDuration(minutes: number): string {\r\n    if (minutes < 60) {\r\n        return `${minutes}m`;\r\n    }\r\n    const hours = Math.floor(minutes / 60);\r\n    const mins = minutes % 60;\r\n    return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\r\n}\r\n\r\n/**\r\n * Format duration in seconds to human-readable string (e.g., \"1h 23m 45s\")\r\n */\r\nexport function formatDurationFromSeconds(seconds: number): string {\r\n    const hours = Math.floor(seconds / 3600);\r\n    const minutes = Math.floor((seconds % 3600) / 60);\r\n    const secs = seconds % 60;\r\n\r\n    const parts: string[] = [];\r\n    if (hours > 0) parts.push(`${hours}h`);\r\n    if (minutes > 0) parts.push(`${minutes}m`);\r\n    if (secs > 0 || parts.length === 0) parts.push(`${secs}s`);\r\n\r\n    return parts.join(\" \");\r\n}\r\n\r\n/**\r\n * Format time for timer display (MM:SS)\r\n */\r\nexport function formatTimerDisplay(seconds: number): string {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins.toString().padStart(2, \"0\")}:${secs.toString().padStart(2, \"0\")}`;\r\n}\r\n\r\n/**\r\n * Format time for extended timer display (HH:MM:SS)\r\n */\r\nexport function formatTimerDisplayExtended(seconds: number): string {\r\n    const hours = Math.floor(seconds / 3600);\r\n    const mins = Math.floor((seconds % 3600) / 60);\r\n    const secs = seconds % 60;\r\n    return `${hours.toString().padStart(2, \"0\")}:${mins.toString().padStart(2, \"0\")}:${secs.toString().padStart(2, \"0\")}`;\r\n}\r\n\r\n/**\r\n * Convert minutes to hours (decimal)\r\n */\r\nexport function minutesToHours(minutes: number): number {\r\n    return Math.round((minutes / 60) * 100) / 100;\r\n}\r\n\r\n/**\r\n * Convert hours to minutes\r\n */\r\nexport function hoursToMinutes(hours: number): number {\r\n    return Math.round(hours * 60);\r\n}\r\n\r\n/**\r\n * Convert seconds to minutes\r\n */\r\nexport function secondsToMinutes(seconds: number): number {\r\n    return Math.round(seconds / 60);\r\n}\r\n\r\n/**\r\n * Convert minutes to seconds\r\n */\r\nexport function minutesToSeconds(minutes: number): number {\r\n    return minutes * 60;\r\n}\r\n\r\n/**\r\n * Parse duration string to minutes (e.g., \"2h 30m\" -> 150)\r\n */\r\nexport function parseDuration(duration: string): number {\r\n    const hourMatch = duration.match(/(\\d+)h/);\r\n    const minMatch = duration.match(/(\\d+)m/);\r\n\r\n    const hours = hourMatch ? parseInt(hourMatch[1]!, 10) : 0;\r\n    const minutes = minMatch ? parseInt(minMatch[1]!, 10) : 0;\r\n\r\n    return hours * 60 + minutes;\r\n}\r\n\r\n/**\r\n * Calculate total time worked from time entries\r\n */\r\nexport function calculateTotalTimeWorked(timeEntries: Array<{ duration: number }>): number {\r\n    return timeEntries.reduce((total, entry) => total + entry.duration, 0);\r\n}\r\n\r\n/**\r\n * Calculate average time per task\r\n */\r\nexport function calculateAverageTime(totalMinutes: number, taskCount: number): number {\r\n    if (taskCount === 0) return 0;\r\n    return Math.round(totalMinutes / taskCount);\r\n}\r\n\r\n/**\r\n * Format time of day (e.g., \"14:30\" -> \"2:30 PM\")\r\n */\r\nexport function formatTimeOfDay(time: string, use24Hour: boolean = false): string {\r\n    const [hours, minutes] = time.split(\":\").map(Number);\r\n\r\n    if (use24Hour) {\r\n        return `${(hours || 0).toString().padStart(2, \"0\")}:${(minutes || 0).toString().padStart(2, \"0\")}`;\r\n    }\r\n\r\n    const period = (hours || 0) >= 12 ? \"PM\" : \"AM\";\r\n    const displayHours = (hours || 0) % 12 || 12;\r\n    return `${displayHours}:${(minutes || 0).toString().padStart(2, \"0\")} ${period}`;\r\n}\r\n\r\n/**\r\n * Get current time in HH:MM format\r\n */\r\nexport function getCurrentTime(): string {\r\n    const now = new Date();\r\n    return `${now.getHours().toString().padStart(2, \"0\")}:${now.getMinutes().toString().padStart(2, \"0\")}`;\r\n}\r\n\r\n/**\r\n * Check if time is within working hours (9 AM - 6 PM by default)\r\n */\r\nexport function isWorkingHours(\r\n    date: Date = new Date(),\r\n    startHour: number = 9,\r\n    endHour: number = 18\r\n): boolean {\r\n    const hour = date.getHours();\r\n    return hour >= startHour && hour < endHour;\r\n}\r\n","/**\r\n * String utility functions\r\n * Used across all applications for consistent string manipulation\r\n */\r\n\r\n/**\r\n * Generate a URL-friendly slug from a string\r\n */\r\nexport function generateSlug(text: string): string {\r\n    return text\r\n        .toLowerCase()\r\n        .trim()\r\n        .replace(/[^\\w\\s-]/g, \"\") // Remove non-word chars (except spaces and hyphens)\r\n        .replace(/[\\s_-]+/g, \"-\") // Replace spaces, underscores with single hyphen\r\n        .replace(/^-+|-+$/g, \"\"); // Remove leading/trailing hyphens\r\n}\r\n\r\n/**\r\n * Truncate a string to a maximum length with ellipsis\r\n */\r\nexport function truncate(text: string, maxLength: number, ellipsis: string = \"...\"): string {\r\n    if (text.length <= maxLength) return text;\r\n    return text.slice(0, maxLength - ellipsis.length) + ellipsis;\r\n}\r\n\r\n/**\r\n * Capitalize the first letter of a string\r\n */\r\nexport function capitalize(text: string): string {\r\n    if (!text) return text;\r\n    return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();\r\n}\r\n\r\n/**\r\n * Capitalize the first letter of each word\r\n */\r\nexport function capitalizeWords(text: string): string {\r\n    return text\r\n        .split(\" \")\r\n        .map((word) => capitalize(word))\r\n        .join(\" \");\r\n}\r\n\r\n/**\r\n * Convert camelCase or PascalCase to Title Case\r\n */\r\nexport function camelToTitle(text: string): string {\r\n    const result = text.replace(/([A-Z])/g, \" $1\");\r\n    return result.charAt(0).toUpperCase() + result.slice(1);\r\n}\r\n\r\n/**\r\n * Convert snake_case to Title Case\r\n */\r\nexport function snakeToTitle(text: string): string {\r\n    return text\r\n        .split(\"_\")\r\n        .map((word) => capitalize(word))\r\n        .join(\" \");\r\n}\r\n\r\n/**\r\n * Extract initials from a name (e.g., \"John Doe\" -> \"JD\")\r\n */\r\nexport function getInitials(name: string, maxLength: number = 2): string {\r\n    const words = name.trim().split(/\\s+/);\r\n    const initials = words\r\n        .map((word) => word.charAt(0).toUpperCase())\r\n        .join(\"\");\r\n    return initials.slice(0, maxLength);\r\n}\r\n\r\n/**\r\n * Generate a random string of specified length\r\n */\r\nexport function generateRandomString(length: number): string {\r\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n    let result = \"\";\r\n    for (let i = 0; i < length; i++) {\r\n        result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return result;\r\n}\r\n\r\n/**\r\n * Check if a string is a valid email\r\n */\r\nexport function isValidEmail(email: string): boolean {\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    return emailRegex.test(email);\r\n}\r\n\r\n/**\r\n * Check if a string is a valid URL\r\n */\r\nexport function isValidUrl(url: string): boolean {\r\n    try {\r\n        new URL(url);\r\n        return true;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Sanitize a string for use in HTML (basic XSS prevention)\r\n */\r\nexport function sanitizeHtml(text: string): string {\r\n    const map: Record<string, string> = {\r\n        \"&\": \"&amp;\",\r\n        \"<\": \"&lt;\",\r\n        \">\": \"&gt;\",\r\n        '\"': \"&quot;\",\r\n        \"'\": \"&#x27;\",\r\n        \"/\": \"&#x2F;\",\r\n    };\r\n    return text.replace(/[&<>\"'/]/g, (char) => map[char] || char);\r\n}\r\n\r\n/**\r\n * Remove extra whitespace from a string\r\n */\r\nexport function normalizeWhitespace(text: string): string {\r\n    return text.replace(/\\s+/g, \" \").trim();\r\n}\r\n\r\n/**\r\n * Count words in a string\r\n */\r\nexport function countWords(text: string): number {\r\n    return text.trim().split(/\\s+/).filter(Boolean).length;\r\n}\r\n\r\n/**\r\n * Pluralize a word based on count\r\n */\r\nexport function pluralize(word: string, count: number, plural?: string): string {\r\n    if (count === 1) return word;\r\n    return plural || `${word}s`;\r\n}\r\n\r\n/**\r\n * Format a number with commas (e.g., 1000 -> \"1,000\")\r\n */\r\nexport function formatNumber(num: number): string {\r\n    return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n}\r\n\r\n/**\r\n * Generate a unique ID (simple implementation)\r\n */\r\nexport function generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Check if string contains only alphanumeric characters\r\n */\r\nexport function isAlphanumeric(text: string): boolean {\r\n    return /^[a-zA-Z0-9]+$/.test(text);\r\n}\r\n\r\n/**\r\n * Remove HTML tags from a string\r\n */\r\nexport function stripHtmlTags(html: string): string {\r\n    return html.replace(/<[^>]*>/g, \"\");\r\n}\r\n\r\n/**\r\n * Highlight search terms in text\r\n */\r\nexport function highlightSearchTerms(text: string, searchTerm: string): string {\r\n    if (!searchTerm) return text;\r\n    const regex = new RegExp(`(${searchTerm})`, \"gi\");\r\n    return text.replace(regex, \"<mark>$1</mark>\");\r\n}\r\n","/**\r\n * Calculation utility functions\r\n * Used across all applications for consistent business logic calculations\r\n */\r\n\r\n/**\r\n * Calculate progress percentage\r\n */\r\nexport function calculateProgress(completed: number, total: number): number {\r\n    if (total === 0) return 0;\r\n    return Math.round((completed / total) * 100);\r\n}\r\n\r\n/**\r\n * Calculate completion rate\r\n */\r\nexport function calculateCompletionRate(completed: number, total: number): number {\r\n    if (total === 0) return 0;\r\n    return Math.round((completed / total) * 100 * 10) / 10; // One decimal place\r\n}\r\n\r\n/**\r\n * Calculate productivity score (0-100)\r\n * Based on completed tasks, time worked, and focus time\r\n */\r\nexport function calculateProductivityScore(\r\n    completedTasks: number,\r\n    totalTasks: number,\r\n    focusMinutes: number,\r\n    targetFocusMinutes: number = 240 // 4 hours default\r\n): number {\r\n    if (totalTasks === 0 && focusMinutes === 0) return 0;\r\n\r\n    const taskScore = totalTasks > 0 ? (completedTasks / totalTasks) * 50 : 0;\r\n    const focusScore = Math.min((focusMinutes / targetFocusMinutes) * 50, 50);\r\n\r\n    return Math.round(taskScore + focusScore);\r\n}\r\n\r\n/**\r\n * Calculate focus score based on pomodoros completed\r\n */\r\nexport function calculateFocusScore(\r\n    completedPomodoros: number,\r\n    targetPomodoros: number = 8\r\n): number {\r\n    if (targetPomodoros === 0) return 0;\r\n    return Math.min(Math.round((completedPomodoros / targetPomodoros) * 100), 100);\r\n}\r\n\r\n/**\r\n * Calculate average completion time\r\n */\r\nexport function calculateAverageCompletionTime(\r\n    tasks: Array<{ createdAt: Date | string; completedAt?: Date | string | null }>\r\n): number {\r\n    const completedTasks = tasks.filter((t) => t.completedAt != null);\r\n    if (completedTasks.length === 0) return 0;\r\n\r\n    const totalTime = completedTasks.reduce((sum, task) => {\r\n        if (!task.completedAt) return sum; // Extra safety check\r\n        const created = typeof task.createdAt === \"string\" ? new Date(task.createdAt) : task.createdAt;\r\n        const completed = typeof task.completedAt === \"string\" ? new Date(task.completedAt) : task.completedAt;\r\n        return sum + (completed.getTime() - created.getTime());\r\n    }, 0);\r\n\r\n    return Math.round(totalTime / completedTasks.length / (1000 * 60)); // Convert to minutes\r\n}\r\n\r\n/**\r\n * Calculate velocity (tasks completed per day)\r\n */\r\nexport function calculateVelocity(\r\n    completedTasks: number,\r\n    days: number\r\n): number {\r\n    if (days === 0) return 0;\r\n    return Math.round((completedTasks / days) * 10) / 10; // One decimal place\r\n}\r\n\r\n/**\r\n * Calculate estimated completion date based on velocity\r\n */\r\nexport function calculateEstimatedCompletion(\r\n    remainingTasks: number,\r\n    velocity: number\r\n): Date | null {\r\n    if (velocity === 0) return null;\r\n    const daysNeeded = Math.ceil(remainingTasks / velocity);\r\n    const completionDate = new Date();\r\n    completionDate.setDate(completionDate.getDate() + daysNeeded);\r\n    return completionDate;\r\n}\r\n\r\n/**\r\n * Calculate burndown rate\r\n */\r\nexport function calculateBurndownRate(\r\n    initialTasks: number,\r\n    remainingTasks: number,\r\n    elapsedDays: number\r\n): number {\r\n    if (elapsedDays === 0) return 0;\r\n    const completedTasks = initialTasks - remainingTasks;\r\n    return Math.round((completedTasks / elapsedDays) * 10) / 10;\r\n}\r\n\r\n/**\r\n * Calculate project health score (0-100)\r\n * Based on progress, overdue tasks, and velocity\r\n */\r\nexport function calculateProjectHealth(\r\n    completedTasks: number,\r\n    totalTasks: number,\r\n    overdueTasks: number,\r\n    velocity: number,\r\n    targetVelocity: number = 2\r\n): number {\r\n    if (totalTasks === 0) return 100;\r\n\r\n    const progressScore = (completedTasks / totalTasks) * 40;\r\n    const overdueScore = Math.max(0, 30 - (overdueTasks / totalTasks) * 30);\r\n    const velocityScore = Math.min((velocity / targetVelocity) * 30, 30);\r\n\r\n    return Math.round(progressScore + overdueScore + velocityScore);\r\n}\r\n\r\n/**\r\n * Calculate time utilization percentage\r\n */\r\nexport function calculateTimeUtilization(\r\n    actualMinutes: number,\r\n    estimatedMinutes: number\r\n): number {\r\n    if (estimatedMinutes === 0) return 0;\r\n    return Math.round((actualMinutes / estimatedMinutes) * 100);\r\n}\r\n\r\n/**\r\n * Calculate efficiency score\r\n */\r\nexport function calculateEfficiency(\r\n    completedTasks: number,\r\n    totalMinutesWorked: number\r\n): number {\r\n    if (totalMinutesWorked === 0) return 0;\r\n    const tasksPerHour = (completedTasks / totalMinutesWorked) * 60;\r\n    return Math.round(tasksPerHour * 100) / 100;\r\n}\r\n\r\n/**\r\n * Calculate streak (consecutive days with activity)\r\n */\r\nexport function calculateStreak(\r\n    activityDates: Array<Date | string>\r\n): number {\r\n    if (activityDates.length === 0) return 0;\r\n\r\n    const sortedDates = activityDates\r\n        .map((d) => typeof d === \"string\" ? new Date(d) : d)\r\n        .sort((a, b) => b.getTime() - a.getTime());\r\n\r\n    let streak = 1;\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    // Check if the most recent activity was today or yesterday\r\n    const mostRecent = new Date(sortedDates[0]!);\r\n    mostRecent.setHours(0, 0, 0, 0);\r\n    const daysDiff = Math.floor((today.getTime() - mostRecent.getTime()) / (1000 * 60 * 60 * 24));\r\n\r\n    if (daysDiff > 1) return 0; // Streak broken\r\n\r\n    for (let i = 1; i < sortedDates.length; i++) {\r\n        const current = new Date(sortedDates[i]!);\r\n        current.setHours(0, 0, 0, 0);\r\n        const previous = new Date(sortedDates[i - 1]!);\r\n        previous.setHours(0, 0, 0, 0);\r\n\r\n        const diff = Math.floor((previous.getTime() - current.getTime()) / (1000 * 60 * 60 * 24));\r\n        if (diff === 1) {\r\n            streak++;\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n\r\n    return streak;\r\n}\r\n\r\n/**\r\n * Calculate percentile rank\r\n */\r\nexport function calculatePercentile(value: number, values: number[]): number {\r\n    if (values.length === 0) return 0;\r\n    const sorted = [...values].sort((a, b) => a - b);\r\n    const index = sorted.findIndex((v) => v >= value);\r\n    if (index === -1) return 100;\r\n    return Math.round((index / sorted.length) * 100);\r\n}\r\n\r\n/**\r\n * Calculate weighted average\r\n */\r\nexport function calculateWeightedAverage(\r\n    values: Array<{ value: number; weight: number }>\r\n): number {\r\n    if (values.length === 0) return 0;\r\n    const totalWeight = values.reduce((sum, item) => sum + item.weight, 0);\r\n    if (totalWeight === 0) return 0;\r\n    const weightedSum = values.reduce((sum, item) => sum + item.value * item.weight, 0);\r\n    return Math.round((weightedSum / totalWeight) * 100) / 100;\r\n}\r\n","/**\r\n * Color utility functions\r\n * Used across all applications for consistent color manipulation\r\n */\r\n\r\n/**\r\n * Convert hex color to RGB\r\n */\r\nexport function hexToRgb(hex: string): { r: number; g: number; b: number } | null {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result\r\n        ? {\r\n            r: parseInt(result[1]!, 16),\r\n            g: parseInt(result[2]!, 16),\r\n            b: parseInt(result[3]!, 16),\r\n        }\r\n        : null;\r\n}\r\n\r\n/**\r\n * Convert RGB to hex color\r\n */\r\nexport function rgbToHex(r: number, g: number, b: number): string {\r\n    const toHex = (x: number) => {\r\n        const hex = x.toString(16);\r\n        return hex.length === 1 ? \"0\" + hex : hex;\r\n    };\r\n    return \"#\" + toHex(r) + toHex(g) + toHex(b);\r\n}\r\n\r\n/**\r\n * Get contrast color (black or white) for a given background color\r\n */\r\nexport function getContrastColor(hexColor: string): string {\r\n    const rgb = hexToRgb(hexColor);\r\n    if (!rgb) return \"#000000\";\r\n\r\n    // Calculate relative luminance\r\n    const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;\r\n\r\n    return luminance > 0.5 ? \"#000000\" : \"#FFFFFF\";\r\n}\r\n\r\n/**\r\n * Lighten a color by a percentage\r\n */\r\nexport function lightenColor(hexColor: string, percent: number): string {\r\n    const rgb = hexToRgb(hexColor);\r\n    if (!rgb) return hexColor;\r\n\r\n    const amount = Math.round(2.55 * percent);\r\n    const r = Math.min(255, rgb.r + amount);\r\n    const g = Math.min(255, rgb.g + amount);\r\n    const b = Math.min(255, rgb.b + amount);\r\n\r\n    return rgbToHex(r, g, b);\r\n}\r\n\r\n/**\r\n * Darken a color by a percentage\r\n */\r\nexport function darkenColor(hexColor: string, percent: number): string {\r\n    const rgb = hexToRgb(hexColor);\r\n    if (!rgb) return hexColor;\r\n\r\n    const amount = Math.round(2.55 * percent);\r\n    const r = Math.max(0, rgb.r - amount);\r\n    const g = Math.max(0, rgb.g - amount);\r\n    const b = Math.max(0, rgb.b - amount);\r\n\r\n    return rgbToHex(r, g, b);\r\n}\r\n\r\n/**\r\n * Add alpha channel to hex color\r\n */\r\nexport function addAlpha(hexColor: string, alpha: number): string {\r\n    const rgb = hexToRgb(hexColor);\r\n    if (!rgb) return hexColor;\r\n\r\n    const a = Math.round(Math.min(Math.max(alpha, 0), 1) * 255);\r\n    return `${hexColor}${a.toString(16).padStart(2, \"0\")}`;\r\n}\r\n\r\n/**\r\n * Convert hex color to RGBA string\r\n */\r\nexport function hexToRgba(hexColor: string, alpha: number = 1): string {\r\n    const rgb = hexToRgb(hexColor);\r\n    if (!rgb) return `rgba(0, 0, 0, ${alpha})`;\r\n\r\n    return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha})`;\r\n}\r\n\r\n/**\r\n * Generate a random hex color\r\n */\r\nexport function randomColor(): string {\r\n    return \"#\" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, \"0\");\r\n}\r\n\r\n/**\r\n * Check if a color is light\r\n */\r\nexport function isLightColor(hexColor: string): boolean {\r\n    const rgb = hexToRgb(hexColor);\r\n    if (!rgb) return false;\r\n\r\n    const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;\r\n    return luminance > 0.5;\r\n}\r\n\r\n/**\r\n * Check if a color is dark\r\n */\r\nexport function isDarkColor(hexColor: string): boolean {\r\n    return !isLightColor(hexColor);\r\n}\r\n\r\n/**\r\n * Mix two colors\r\n */\r\nexport function mixColors(color1: string, color2: string, weight: number = 0.5): string {\r\n    const rgb1 = hexToRgb(color1);\r\n    const rgb2 = hexToRgb(color2);\r\n\r\n    if (!rgb1 || !rgb2) return color1;\r\n\r\n    const w = Math.max(0, Math.min(1, weight));\r\n    const r = Math.round(rgb1.r * (1 - w) + rgb2.r * w);\r\n    const g = Math.round(rgb1.g * (1 - w) + rgb2.g * w);\r\n    const b = Math.round(rgb1.b * (1 - w) + rgb2.b * w);\r\n\r\n    return rgbToHex(r, g, b);\r\n}\r\n\r\n/**\r\n * Generate a color palette from a base color\r\n */\r\nexport function generatePalette(baseColor: string): {\r\n    lighter: string;\r\n    light: string;\r\n    base: string;\r\n    dark: string;\r\n    darker: string;\r\n} {\r\n    return {\r\n        lighter: lightenColor(baseColor, 40),\r\n        light: lightenColor(baseColor, 20),\r\n        base: baseColor,\r\n        dark: darkenColor(baseColor, 20),\r\n        darker: darkenColor(baseColor, 40),\r\n    };\r\n}\r\n\r\n/**\r\n * Get color with opacity for backgrounds\r\n */\r\nexport function getColorWithOpacity(hexColor: string, opacity: number = 0.1): string {\r\n    return hexToRgba(hexColor, opacity);\r\n}\r\n","/**\r\n * Task validation schemas\r\n * Shared across all applications for consistent task validation\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { TASK_LIMITS } from \"../constants/limits.constants\";\r\nimport { PRIORITY_VALUES } from \"../constants/priorities.constants\";\r\nimport { TASK_STATUS_VALUES } from \"../constants/status.constants\";\r\n\r\n/**\r\n * Base task schema\r\n */\r\nexport const taskBaseSchema = z.object({\r\n    title: z\r\n        .string()\r\n        .min(TASK_LIMITS.TITLE_MIN_LENGTH, \"Title is required\")\r\n        .max(TASK_LIMITS.TITLE_MAX_LENGTH, `Title must be less than ${TASK_LIMITS.TITLE_MAX_LENGTH} characters`),\r\n    description: z\r\n        .string()\r\n        .max(TASK_LIMITS.DESCRIPTION_MAX_LENGTH, `Description must be less than ${TASK_LIMITS.DESCRIPTION_MAX_LENGTH} characters`)\r\n        .optional(),\r\n    priority: z.enum(PRIORITY_VALUES),\r\n    status: z.enum(TASK_STATUS_VALUES).optional(),\r\n    dueDate: z.string().optional().nullable(),\r\n    startDate: z.string().optional().nullable(),\r\n    scheduledDate: z.string().optional().nullable(),\r\n    scheduledTime: z.string().regex(/^\\d{2}:\\d{2}$/, \"Time must be in HH:mm format\").optional().nullable(),\r\n    isTimeBlocked: z.boolean().optional(),\r\n    estimatedMinutes: z\r\n        .union([\r\n            z.number()\r\n                .int()\r\n                .min(TASK_LIMITS.MIN_ESTIMATED_MINUTES)\r\n                .max(TASK_LIMITS.MAX_ESTIMATED_MINUTES),\r\n            z.nan(),\r\n        ])\r\n        .optional()\r\n        .nullable()\r\n        .transform((val) => (Number.isNaN(val) ? undefined : val)),\r\n});\r\n\r\n/**\r\n * Validation for date relationships\r\n */\r\nexport const taskDatesSchema = taskBaseSchema.refine(\r\n    (data) => {\r\n        if (data.startDate && data.dueDate) {\r\n            return new Date(data.startDate) <= new Date(data.dueDate);\r\n        }\r\n        return true;\r\n    },\r\n    { message: \"Start date must be before or equal to due date\", path: [\"startDate\"] }\r\n).refine(\r\n    (data) => {\r\n        if (data.scheduledDate && data.dueDate) {\r\n            return new Date(data.scheduledDate) <= new Date(data.dueDate);\r\n        }\r\n        return true;\r\n    },\r\n    { message: \"Scheduled date must be before or equal to due date\", path: [\"scheduledDate\"] }\r\n);\r\n\r\n/**\r\n * Create task schema\r\n */\r\nexport const createTaskSchema = taskBaseSchema.extend({\r\n    projectId: z.string().min(1, \"Project is required\"),\r\n    parentTaskId: z.string().optional().nullable(),\r\n    assigneeId: z.string().optional().nullable(),\r\n    tagIds: z.array(z.string()).max(TASK_LIMITS.MAX_TAGS_PER_TASK).optional(),\r\n});\r\n\r\n/**\r\n * Update task schema (all fields optional except what's being updated)\r\n */\r\nexport const updateTaskSchema = taskBaseSchema.partial().extend({\r\n    assigneeId: z.string().optional().nullable(),\r\n    tagIds: z.array(z.string()).max(TASK_LIMITS.MAX_TAGS_PER_TASK).optional(),\r\n    completedAt: z.string().datetime().optional().nullable(),\r\n});\r\n\r\n/**\r\n * Task filter schema\r\n */\r\nexport const taskFilterSchema = z.object({\r\n    projectId: z.string().optional(),\r\n    status: z.enum(TASK_STATUS_VALUES).optional(),\r\n    priority: z.enum(PRIORITY_VALUES).optional(),\r\n    assigneeId: z.string().optional(),\r\n    tagIds: z.array(z.string()).optional(),\r\n    search: z.string().optional(),\r\n    dueDate: z.object({\r\n        from: z.string().datetime().optional(),\r\n        to: z.string().datetime().optional(),\r\n    }).optional(),\r\n    isOverdue: z.boolean().optional(),\r\n});\r\n\r\n/**\r\n * Bulk update tasks schema\r\n */\r\nexport const bulkUpdateTasksSchema = z.object({\r\n    taskIds: z.array(z.string()).min(1, \"At least one task is required\"),\r\n    updates: z.object({\r\n        status: z.enum(TASK_STATUS_VALUES).optional(),\r\n        priority: z.enum(PRIORITY_VALUES).optional(),\r\n        assigneeId: z.string().optional().nullable(),\r\n        projectId: z.string().optional(),\r\n    }),\r\n});\r\n\r\n/**\r\n * Reorder tasks schema\r\n */\r\nexport const reorderTasksSchema = z.object({\r\n    taskId: z.string(),\r\n    newOrder: z.number().int().min(0),\r\n    projectId: z.string(),\r\n});\r\n\r\n/**\r\n * Type exports\r\n */\r\nexport type TaskBase = z.infer<typeof taskBaseSchema>;\r\nexport type CreateTaskDTO = z.infer<typeof createTaskSchema>;\r\nexport type UpdateTaskDTO = z.infer<typeof updateTaskSchema>;\r\nexport type TaskFilter = z.infer<typeof taskFilterSchema>;\r\nexport type BulkUpdateTasks = z.infer<typeof bulkUpdateTasksSchema>;\r\nexport type ReorderTasks = z.infer<typeof reorderTasksSchema>;\r\n","/**\r\n * Project validation schemas\r\n * Shared across all applications for consistent project validation\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { PROJECT_LIMITS } from \"../constants/limits.constants\";\r\nimport { PROJECT_COLORS } from \"../constants/colors.constants\";\r\n\r\n/**\r\n * Base project schema\r\n */\r\nexport const projectBaseSchema = z.object({\r\n    name: z\r\n        .string()\r\n        .min(PROJECT_LIMITS.NAME_MIN_LENGTH, \"Project name is required\")\r\n        .max(PROJECT_LIMITS.NAME_MAX_LENGTH, `Project name must be less than ${PROJECT_LIMITS.NAME_MAX_LENGTH} characters`),\r\n    description: z\r\n        .string()\r\n        .max(PROJECT_LIMITS.DESCRIPTION_MAX_LENGTH, `Description must be less than ${PROJECT_LIMITS.DESCRIPTION_MAX_LENGTH} characters`)\r\n        .optional(),\r\n    color: z.string().optional(),\r\n    icon: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Create project schema\r\n */\r\nexport const createProjectSchema = projectBaseSchema.extend({\r\n    workspaceId: z.string().min(1, \"Workspace is required\"),\r\n    workflowId: z.string().optional(),\r\n    startDate: z.string().datetime().optional().nullable(),\r\n    endDate: z.string().datetime().optional().nullable(),\r\n});\r\n\r\n/**\r\n * Update project schema\r\n */\r\nexport const updateProjectSchema = projectBaseSchema.partial().extend({\r\n    startDate: z.string().datetime().optional().nullable(),\r\n    endDate: z.string().datetime().optional().nullable(),\r\n    isArchived: z.boolean().optional(),\r\n});\r\n\r\n/**\r\n * Project filter schema\r\n */\r\nexport const projectFilterSchema = z.object({\r\n    workspaceId: z.string().optional(),\r\n    search: z.string().optional(),\r\n    isArchived: z.boolean().optional(),\r\n    color: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Archive project schema\r\n */\r\nexport const archiveProjectSchema = z.object({\r\n    isArchived: z.boolean(),\r\n});\r\n\r\n/**\r\n * Duplicate project schema\r\n */\r\nexport const duplicateProjectSchema = z.object({\r\n    name: z.string().min(PROJECT_LIMITS.NAME_MIN_LENGTH),\r\n    includeTasks: z.boolean().default(false),\r\n    includeMembers: z.boolean().default(false),\r\n});\r\n\r\n/**\r\n * Type exports\r\n */\r\nexport type ProjectBase = z.infer<typeof projectBaseSchema>;\r\nexport type CreateProjectDTO = z.infer<typeof createProjectSchema>;\r\nexport type UpdateProjectDTO = z.infer<typeof updateProjectSchema>;\r\nexport type ProjectFilter = z.infer<typeof projectFilterSchema>;\r\nexport type ArchiveProject = z.infer<typeof archiveProjectSchema>;\r\nexport type DuplicateProject = z.infer<typeof duplicateProjectSchema>;\r\n","/**\r\n * Workspace validation schemas\r\n * Shared across all applications for consistent workspace validation\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { WORKSPACE_LIMITS } from \"../constants/limits.constants\";\r\n\r\n/**\r\n * Workspace type enum\r\n */\r\nexport const WORKSPACE_TYPES = [\"PERSONAL\", \"WORK\", \"TEAM\"] as const;\r\n\r\n/**\r\n * Member role enum\r\n */\r\nexport const MEMBER_ROLES = [\"OWNER\", \"ADMIN\", \"MEMBER\", \"VIEWER\"] as const;\r\n\r\n/**\r\n * Base workspace schema\r\n */\r\nexport const workspaceBaseSchema = z.object({\r\n  name: z\r\n    .string()\r\n    .min(WORKSPACE_LIMITS.NAME_MIN_LENGTH, \"Workspace name is required\")\r\n    .max(\r\n      WORKSPACE_LIMITS.NAME_MAX_LENGTH,\r\n      `Workspace name must be less than ${WORKSPACE_LIMITS.NAME_MAX_LENGTH} characters`,\r\n    ),\r\n  slug: z\r\n    .string()\r\n    .min(1, \"Slug must be at least 1 character\")\r\n    .regex(\r\n      /^[a-z0-9-]+$/,\r\n      \"Slug must only contain lowercase letters, numbers, and hyphens\",\r\n    )\r\n    .optional(),\r\n  description: z\r\n    .string()\r\n    .max(\r\n      WORKSPACE_LIMITS.DESCRIPTION_MAX_LENGTH,\r\n      `Description must be less than ${WORKSPACE_LIMITS.DESCRIPTION_MAX_LENGTH} characters`,\r\n    )\r\n    .optional(),\r\n  type: z.enum(WORKSPACE_TYPES),\r\n  color: z.string().optional(),\r\n  icon: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Create workspace schema\r\n */\r\nexport const createWorkspaceSchema = workspaceBaseSchema;\r\n\r\n/**\r\n * Update workspace schema\r\n */\r\nexport const updateWorkspaceSchema = workspaceBaseSchema.partial();\r\n\r\n/**\r\n * Workspace settings schema\r\n */\r\nexport const workspaceSettingsSchema = z.object({\r\n  defaultTaskPriority: z.enum([\"LOW\", \"MEDIUM\", \"HIGH\"]).optional(),\r\n  defaultTaskStatus: z\r\n    .enum([\"TODO\", \"IN_PROGRESS\", \"IN_REVIEW\", \"DONE\", \"CANCELLED\"])\r\n    .optional(),\r\n  enableNotifications: z.boolean().optional(),\r\n  enableEmailDigest: z.boolean().optional(),\r\n  timezone: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Invite member schema\r\n */\r\nexport const inviteMemberSchema = z.object({\r\n  email: z.string().email(\"Invalid email address\"),\r\n  role: z.enum(MEMBER_ROLES),\r\n  message: z.string().max(500).optional(),\r\n});\r\n\r\n/**\r\n * Update member role schema\r\n */\r\nexport const updateMemberRoleSchema = z.object({\r\n  role: z.enum(MEMBER_ROLES),\r\n});\r\n\r\n/**\r\n * Accept invitation schema\r\n */\r\nexport const acceptInvitationSchema = z.object({\r\n  token: z.string().min(1, \"Invitation token is required\"),\r\n});\r\n\r\n/**\r\n * Transfer ownership schema\r\n */\r\nexport const transferOwnershipSchema = z.object({\r\n  newOwnerId: z.string().min(1, \"New owner is required\"),\r\n});\r\n\r\n/**\r\n * Workspace filter schema\r\n */\r\nexport const workspaceFilterSchema = z.object({\r\n  type: z.enum(WORKSPACE_TYPES).optional(),\r\n  search: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Type exports\r\n * Note: WorkspaceType is defined in workspaces domain, so we use WorkspaceTypeValue here\r\n */\r\nexport type WorkspaceTypeValue = (typeof WORKSPACE_TYPES)[number];\r\nexport type MemberRoleValue = (typeof MEMBER_ROLES)[number];\r\nexport type WorkspaceBase = z.infer<typeof workspaceBaseSchema>;\r\nexport type CreateWorkspaceDTO = z.infer<typeof createWorkspaceSchema>;\r\nexport type UpdateWorkspaceDTO = z.infer<typeof updateWorkspaceSchema>;\r\nexport type WorkspaceSettingsDTO = z.infer<typeof workspaceSettingsSchema>;\r\nexport type InviteMemberDTO = z.infer<typeof inviteMemberSchema>;\r\nexport type UpdateMemberRole = z.infer<typeof updateMemberRoleSchema>;\r\nexport type AcceptInvitation = z.infer<typeof acceptInvitationSchema>;\r\nexport type TransferOwnership = z.infer<typeof transferOwnershipSchema>;\r\nexport type WorkspaceFilter = z.infer<typeof workspaceFilterSchema>;\r\n","/**\r\n * Tag validation schemas\r\n * Shared across all applications for consistent tag validation\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { TAG_LIMITS } from \"../constants/limits.constants\";\r\n\r\n/**\r\n * Base tag schema\r\n */\r\nexport const tagBaseSchema = z.object({\r\n    name: z\r\n        .string()\r\n        .min(TAG_LIMITS.NAME_MIN_LENGTH, \"Tag name is required\")\r\n        .max(TAG_LIMITS.NAME_MAX_LENGTH, `Tag name must be less than ${TAG_LIMITS.NAME_MAX_LENGTH} characters`),\r\n    color: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Create tag schema\r\n */\r\nexport const createTagSchema = tagBaseSchema.extend({\r\n    workspaceId: z.string().min(1, \"Workspace is required\"),\r\n});\r\n\r\n/**\r\n * Update tag schema\r\n */\r\nexport const updateTagSchema = tagBaseSchema.partial();\r\n\r\n/**\r\n * Tag filter schema\r\n */\r\nexport const tagFilterSchema = z.object({\r\n    workspaceId: z.string().optional(),\r\n    search: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Assign tags to task schema\r\n */\r\nexport const assignTagsSchema = z.object({\r\n    tagIds: z.array(z.string()).max(TAG_LIMITS.NAME_MAX_LENGTH),\r\n});\r\n\r\n/**\r\n * Type exports\r\n */\r\nexport type TagBase = z.infer<typeof tagBaseSchema>;\r\nexport type CreateTagDTO = z.infer<typeof createTagSchema>;\r\nexport type UpdateTagDTO = z.infer<typeof updateTagSchema>;\r\nexport type TagFilter = z.infer<typeof tagFilterSchema>;\r\nexport type AssignTags = z.infer<typeof assignTagsSchema>;\r\n","/**\r\n * User validation schemas\r\n * Shared across all applications for consistent user validation\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { USER_LIMITS } from \"../constants/limits.constants\";\r\n\r\n/**\r\n * User registration schema\r\n */\r\nexport const registerUserSchema = z.object({\r\n    name: z\r\n        .string()\r\n        .min(USER_LIMITS.NAME_MIN_LENGTH, `Name must be at least ${USER_LIMITS.NAME_MIN_LENGTH} characters`)\r\n        .max(USER_LIMITS.NAME_MAX_LENGTH, `Name must be less than ${USER_LIMITS.NAME_MAX_LENGTH} characters`),\r\n    username: z\r\n        .string()\r\n        .min(3, \"Username must be at least 3 characters\")\r\n        .max(20, \"Username must be less than 20 characters\")\r\n        .regex(/^[a-z0-9_-]+$/, \"Username can only contain lowercase letters, numbers, hyphens, and underscores\"),\r\n    email: z.string().email(\"Invalid email address\"),\r\n    password: z\r\n        .string()\r\n        .min(USER_LIMITS.PASSWORD_MIN_LENGTH, `Password must be at least ${USER_LIMITS.PASSWORD_MIN_LENGTH} characters`)\r\n        .max(USER_LIMITS.PASSWORD_MAX_LENGTH, `Password must be less than ${USER_LIMITS.PASSWORD_MAX_LENGTH} characters`),\r\n});\r\n\r\n/**\r\n * User login schema\r\n */\r\nexport const loginUserSchema = z.object({\r\n    email: z.string().email(\"Invalid email address\"),\r\n    password: z.string().min(1, \"Password is required\"),\r\n});\r\n\r\n/**\r\n * Update user profile schema\r\n */\r\nexport const updateUserProfileSchema = z.object({\r\n    name: z\r\n        .string()\r\n        .min(USER_LIMITS.NAME_MIN_LENGTH)\r\n        .max(USER_LIMITS.NAME_MAX_LENGTH)\r\n        .optional(),\r\n    bio: z.string().max(USER_LIMITS.BIO_MAX_LENGTH).optional(),\r\n    avatar: z.string().url().optional().nullable(),\r\n    timezone: z.string().optional(),\r\n    language: z.enum([\"en\", \"es\", \"pt-BR\"]).optional(),\r\n});\r\n\r\n/**\r\n * Change password schema\r\n */\r\nexport const changePasswordSchema = z.object({\r\n    currentPassword: z.string().min(1, \"Current password is required\"),\r\n    newPassword: z\r\n        .string()\r\n        .min(USER_LIMITS.PASSWORD_MIN_LENGTH, `Password must be at least ${USER_LIMITS.PASSWORD_MIN_LENGTH} characters`)\r\n        .max(USER_LIMITS.PASSWORD_MAX_LENGTH),\r\n});\r\n\r\n/**\r\n * Reset password request schema\r\n */\r\nexport const resetPasswordRequestSchema = z.object({\r\n    email: z.string().email(\"Invalid email address\"),\r\n});\r\n\r\n/**\r\n * Reset password schema\r\n */\r\nexport const resetPasswordSchema = z.object({\r\n    token: z.string().min(1, \"Reset token is required\"),\r\n    newPassword: z\r\n        .string()\r\n        .min(USER_LIMITS.PASSWORD_MIN_LENGTH, `Password must be at least ${USER_LIMITS.PASSWORD_MIN_LENGTH} characters`)\r\n        .max(USER_LIMITS.PASSWORD_MAX_LENGTH),\r\n});\r\n\r\n/**\r\n * User preferences schema\r\n */\r\nexport const userPreferencesSchema = z.object({\r\n    theme: z.enum([\"light\", \"dark\", \"system\"]).optional(),\r\n    language: z.enum([\"en\", \"es\", \"pt-BR\"]).optional(),\r\n    timezone: z.string().optional(),\r\n    notifications: z.object({\r\n        email: z.boolean().optional(),\r\n        push: z.boolean().optional(),\r\n        desktop: z.boolean().optional(),\r\n    }).optional(),\r\n    pomodoro: z.object({\r\n        workDuration: z.number().int().min(1).max(120).optional(),\r\n        shortBreakDuration: z.number().int().min(1).max(30).optional(),\r\n        longBreakDuration: z.number().int().min(1).max(60).optional(),\r\n        pomodorosUntilLongBreak: z.number().int().min(2).max(10).optional(),\r\n        autoStartBreaks: z.boolean().optional(),\r\n        autoStartPomodoros: z.boolean().optional(),\r\n        soundEnabled: z.boolean().optional(),\r\n    }).optional(),\r\n});\r\n\r\n/**\r\n * Type exports\r\n */\r\nexport type RegisterUserDTO = z.infer<typeof registerUserSchema>;\r\nexport type LoginUserDTO = z.infer<typeof loginUserSchema>;\r\nexport type UpdateUserProfile = z.infer<typeof updateUserProfileSchema>;\r\nexport type ChangePassword = z.infer<typeof changePasswordSchema>;\r\nexport type ResetPasswordRequest = z.infer<typeof resetPasswordRequestSchema>;\r\nexport type ResetPassword = z.infer<typeof resetPasswordSchema>;\r\n/**\r\n * Username validation schema\r\n */\r\nexport const usernameValidationSchema = z.object({\r\n    username: z\r\n        .string()\r\n        .min(3, \"Username must be at least 3 characters\")\r\n        .max(20, \"Username must be less than 20 characters\")\r\n        .regex(/^[a-z0-9_-]+$/, \"Username can only contain lowercase letters, numbers, hyphens, and underscores\"),\r\n});\r\n\r\nexport type UserPreferences = z.infer<typeof userPreferencesSchema>;\r\nexport type UsernameValidation = z.infer<typeof usernameValidationSchema>;\r\n","/**\r\n * Comment validation schemas\r\n * Shared across all applications for consistent comment validation\r\n */\r\n\r\nimport { z } from \"zod\";\r\nimport { COMMENT_LIMITS } from \"../constants/limits.constants\";\r\n\r\n/**\r\n * Base comment schema\r\n */\r\nexport const commentBaseSchema = z.object({\r\n    content: z\r\n        .string()\r\n        .min(COMMENT_LIMITS.CONTENT_MIN_LENGTH, \"Comment cannot be empty\")\r\n        .max(COMMENT_LIMITS.CONTENT_MAX_LENGTH, `Comment must be less than ${COMMENT_LIMITS.CONTENT_MAX_LENGTH} characters`),\r\n});\r\n\r\n/**\r\n * Create comment schema\r\n */\r\nexport const createCommentSchema = commentBaseSchema.extend({\r\n    taskId: z.string().min(1, \"Task is required\"),\r\n    parentCommentId: z.string().optional().nullable(), // For threaded comments\r\n    mentions: z.array(z.string()).optional(), // User IDs mentioned in comment\r\n});\r\n\r\n/**\r\n * Update comment schema\r\n */\r\nexport const updateCommentSchema = commentBaseSchema;\r\n\r\n/**\r\n * Comment filter schema\r\n */\r\nexport const commentFilterSchema = z.object({\r\n    taskId: z.string().optional(),\r\n    userId: z.string().optional(),\r\n    parentCommentId: z.string().optional().nullable(),\r\n});\r\n\r\n/**\r\n * Type exports\r\n */\r\nexport type CommentBase = z.infer<typeof commentBaseSchema>;\r\nexport type CreateCommentDTO = z.infer<typeof createCommentSchema>;\r\nexport type UpdateCommentDTO = z.infer<typeof updateCommentSchema>;\r\nexport type CommentFilter = z.infer<typeof commentFilterSchema>;\r\n","import { PersonName } from \"../../shared/person-name.vo\";\r\nimport { Email, HashPassword, Id } from \"../../shared\";\r\nimport { Entity, EntityMode, EntityProps } from \"../../shared/entity\";\r\n\r\nexport interface UserProps extends EntityProps<string> {\r\n  name?: string;\r\n  username: string;\r\n  email?: string;\r\n  password?: string;\r\n  image?: string | null;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport class User extends Entity<UserProps> {\r\n  public readonly name: string;\r\n  public readonly username: string;\r\n  public readonly email: string;\r\n  public readonly password?: string;\r\n\r\n  constructor(props: UserProps, mode: EntityMode = \"valid\") {\r\n    super(props);\r\n    this.name =\r\n      mode === \"draft\"\r\n        ? (props?.name ?? \"\")\r\n        : PersonName.create(props?.name ?? \"\").value;\r\n    this.username = props.username;\r\n    this.email =\r\n      mode === \"draft\"\r\n        ? (props?.email ?? \"\")\r\n        : Email.create(props?.email ?? \"\").value;\r\n    this.password = props?.password\r\n      ? HashPassword.create(props.password).value\r\n      : undefined;\r\n  }\r\n\r\n  withoutPassword(): User {\r\n    return this.clone({ password: undefined });\r\n  }\r\n\r\n  static draft(props: UserProps = { username: \"\" }) {\r\n    return new User(props, \"draft\");\r\n  }\r\n\r\n  get $name(): PersonName {\r\n    return PersonName.create(this.name);\r\n  }\r\n\r\n  get $email(): Email {\r\n    return Email.create(this.email);\r\n  }\r\n\r\n  get $password(): HashPassword | undefined {\r\n    return this.password ? HashPassword.create(this.password) : undefined;\r\n  }\r\n}\r\n","import { User } from \"../model/user.entity\";\r\nimport { UseCase, LoggedUser } from \"../../shared/use-case\";\r\nimport UserRepository from \"../provider/user.repository\";\r\nimport { PersonName } from \"../../shared\";\r\n\r\nexport default class ChangeUserName implements UseCase<string, void> {\r\n  constructor(private readonly repo: UserRepository) {}\r\n\r\n  async execute(newName: string, loggedUser?: LoggedUser): Promise<void> {\r\n    if (!loggedUser) {\r\n      throw new Error(\"User is required\");\r\n    }\r\n\r\n    const validName = PersonName.create(newName).value;\r\n\r\n    const existingUser = await this.repo.findByEmail(loggedUser.email);\r\n    if (!existingUser) {\r\n      throw new Error(\"Usuário não encontrado\");\r\n    }\r\n\r\n    await this.repo.updateProps(existingUser, { name: validName });\r\n  }\r\n}\r\n","import { User } from \"../model/user.entity\";\r\nimport CryptoProvider from \"../provider/crypto.provider\";\r\nimport { UseCase } from \"../../shared/use-case\";\r\nimport UserRepository from \"../provider/user.repository\";\r\n\r\ntype Input = {\r\n  name: string;\r\n  username: string;\r\n  email: string;\r\n  password: string;\r\n};\r\n\r\nexport default class RegisterUser implements UseCase<Input, void> {\r\n  constructor(\r\n    private readonly repo: UserRepository,\r\n    private readonly crypto: CryptoProvider\r\n  ) { }\r\n\r\n  async execute(user: Input): Promise<void> {\r\n    const existingUser = await this.repo.findByEmail(user.email);\r\n\r\n    if (existingUser) {\r\n      throw new Error(\"Usuário já existe\");\r\n    }\r\n\r\n    // Check if username is already taken\r\n    const existingUsername = await this.repo.findByUsername(user.username);\r\n    if (existingUsername) {\r\n      throw new Error(\"Nome de usuário já está em uso\");\r\n    }\r\n\r\n    if (!user.password) {\r\n      throw new Error(\"Senha é obrigatória\");\r\n    }\r\n\r\n    if (!user.username || user.username.length < 3) {\r\n      throw new Error(\"Nome de usuário deve ter pelo menos 3 caracteres\");\r\n    }\r\n\r\n    if (user.name?.length < 3) {\r\n      throw new Error(\"Nome deve ter pelo menos 3 caracteres\");\r\n    }\r\n\r\n    const hashedPassword = await this.crypto.encrypt(user.password!);\r\n    const newUser = new User({\r\n      name: user.name,\r\n      username: user.username,\r\n      email: user.email,\r\n      password: hashedPassword,\r\n    });\r\n    await this.repo.save(newUser);\r\n  }\r\n}\r\n","import { User } from \"../model/user.entity\";\r\nimport { UseCase } from \"../../shared/use-case\";\r\nimport UserRepository from \"../provider/user.repository\";\r\n\r\nexport default class UserByEmail implements UseCase<string, User> {\r\n  constructor(private readonly repo: UserRepository) { }\r\n\r\n  async execute(email: string): Promise<User> {\r\n    const user = await this.repo.findByEmail(email?.toLowerCase?.());\r\n    if (!user) throw new Error(\"Usuário não encontrado\");\r\n    return user.withoutPassword();\r\n  }\r\n}\r\n","import { User } from \"../model/user.entity\";\r\nimport CryptoProvider from \"../provider/crypto.provider\";\r\nimport { UseCase } from \"../../shared/use-case\";\r\nimport UserRepository from \"../provider/user.repository\";\r\n\r\ntype Input = {\r\n  email: string;\r\n  password: string;\r\n};\r\n\r\nexport default class UserLogin implements UseCase<Input, User> {\r\n  constructor(\r\n    private readonly repo: UserRepository,\r\n    private readonly crypto: CryptoProvider\r\n  ) { }\r\n\r\n  async execute(input: Input): Promise<User> {\r\n    const { email, password } = input;\r\n\r\n    const withPassword = true;\r\n    const user = await this.repo.findByEmail(email, withPassword);\r\n    if (!user) throw new Error(\"Usuário não encontrado\");\r\n\r\n    const samePassword = await this.crypto.compare(password, user.password!);\r\n    if (!samePassword) throw new Error(\"Senha incorreta\");\r\n\r\n    return user.withoutPassword();\r\n  }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\nimport type { TagProps } from \"../../tags/model/tag.entity\";\r\n\r\nexport type TaskStatus = \"TODO\" | \"IN_PROGRESS\" | \"COMPLETED\" | \"CANCELLED\";\r\nexport type TaskPriority = \"LOW\" | \"MEDIUM\" | \"HIGH\" | \"URGENT\";\r\n\r\nexport interface TaskProps extends EntityProps {\r\n  title: string;\r\n  description?: string;\r\n  status: TaskStatus;\r\n  priority: TaskPriority;\r\n  dueDate?: Date;\r\n  startDate?: Date; // When task can be started\r\n  scheduledDate?: Date; // When task is scheduled to be worked on\r\n  scheduledTime?: string; // Time of day scheduled (e.g., \"14:30\")\r\n  scheduledEndTime?: string; // End time of day (e.g., \"15:30\")\r\n  isTimeBlocked?: boolean; // Whether task is time blocked in calendar\r\n  completedAt?: Date;\r\n  projectId: string;\r\n  ownerId: string;\r\n  assigneeId?: string | null;\r\n  parentTaskId?: string;\r\n  subTasks?: Task[];\r\n  estimatedTime?: number;\r\n  tags?: TagProps[];\r\n  project?: { id: string; name: string; color: string }; // Project information for display\r\n  assignee?: { id: string; name: string; image?: string }; // Assignee information for display\r\n  owner?: { id: string; name: string; image?: string }; // Owner information for display\r\n  isDeleted: boolean;\r\n  deletedAt?: Date;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n  recurrence?: RecurrenceProps;\r\n}\r\n\r\nexport interface RecurrenceProps {\r\n  pattern: \"DAILY\" | \"WEEKLY\" | \"MONTHLY\" | \"YEARLY\" | \"CUSTOM\";\r\n  interval?: number;\r\n  daysOfWeek?: number[];\r\n  dayOfMonth?: number;\r\n  endDate?: Date;\r\n}\r\n\r\nexport class Task extends Entity<TaskProps> {\r\n  constructor(props: TaskProps) {\r\n    super({\r\n      ...props,\r\n      status: props.status ?? \"TODO\",\r\n      priority: props.priority ?? \"MEDIUM\",\r\n      subTasks: props.subTasks ?? [],\r\n      isDeleted: props.isDeleted ?? false,\r\n      createdAt: props.createdAt ?? new Date(),\r\n      updatedAt: props.updatedAt ?? new Date(),\r\n    });\r\n  }\r\n\r\n  static create(\r\n    props: Omit<\r\n      TaskProps,\r\n      \"id\" | \"createdAt\" | \"updatedAt\" | \"status\" | \"isDeleted\" | \"deletedAt\"\r\n    >,\r\n  ): Task {\r\n    return new Task({\r\n      ...props,\r\n      status: \"TODO\",\r\n      priority: props.priority ?? \"MEDIUM\",\r\n      isDeleted: false,\r\n      deletedAt: undefined,\r\n    });\r\n  }\r\n\r\n  complete(): Task {\r\n    return this.clone({\r\n      status: \"COMPLETED\",\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  updateStatus(status: TaskStatus): Task {\r\n    return this.clone({\r\n      status,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  update(\r\n    props: Partial<Omit<TaskProps, \"id\" | \"ownerId\" | \"createdAt\">>,\r\n  ): Task {\r\n    return this.clone({\r\n      ...props,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  softDelete(): Task {\r\n    return this.clone({\r\n      isDeleted: true,\r\n      deletedAt: new Date(),\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  restore(): Task {\r\n    return this.clone({\r\n      isDeleted: false,\r\n      deletedAt: undefined,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { Task, TaskPriority, RecurrenceProps } from \"../model/task.entity\";\r\nimport { TaskRepository } from \"../provider/task.repository\";\r\n\r\nexport interface CreateTaskInput {\r\n    title: string;\r\n    description?: string;\r\n    priority?: TaskPriority;\r\n    dueDate?: Date;\r\n    projectId: string;\r\n    ownerId: string;\r\n    assigneeId?: string;\r\n    parentTaskId?: string;\r\n    recurrence?: RecurrenceProps;\r\n}\r\n\r\nexport class CreateTaskUseCase implements UseCase<CreateTaskInput, Task> {\r\n    constructor(private readonly repository: TaskRepository) { }\r\n\r\n    async execute(input: CreateTaskInput): Promise<Task> {\r\n        if (!input.title) {\r\n            throw new Error(\"Title is required\");\r\n        }\r\n\r\n        const task = Task.create({\r\n            title: input.title,\r\n            description: input.description,\r\n            priority: input.priority ?? \"MEDIUM\",\r\n            dueDate: input.dueDate,\r\n            projectId: input.projectId,\r\n            ownerId: input.ownerId,\r\n            assigneeId: input.assigneeId,\r\n            parentTaskId: input.parentTaskId,\r\n            recurrence: input.recurrence,\r\n        });\r\n\r\n        await this.repository.save(task);\r\n\r\n        return task;\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { Task } from \"../model/task.entity\";\r\nimport { TaskRepository } from \"../provider/task.repository\";\r\n\r\nexport interface CompleteTaskInput {\r\n    taskId: string;\r\n    ownerId: string;\r\n}\r\n\r\nexport class CompleteTaskUseCase implements UseCase<CompleteTaskInput, Task> {\r\n    constructor(private readonly repository: TaskRepository) { }\r\n\r\n    async execute(input: CompleteTaskInput): Promise<Task> {\r\n        const task = await this.repository.findById(input.taskId);\r\n\r\n        if (!task) {\r\n            throw new Error(\"Task not found\");\r\n        }\r\n\r\n        if (task.props.ownerId !== input.ownerId) {\r\n            throw new Error(\"Unauthorized\");\r\n        }\r\n\r\n        const completedTask = task.complete();\r\n        await this.repository.update(completedTask);\r\n\r\n        return completedTask;\r\n    }\r\n}\r\n","import { TaskRepository } from \"../provider/task.repository\";\r\n\r\nexport class SoftDeleteTaskUseCase {\r\n  constructor(private taskRepository: TaskRepository) {}\r\n\r\n  async execute(id: string): Promise<void> {\r\n    const task = await this.taskRepository.findById(id);\r\n    if (!task) {\r\n      throw new Error(\"Task not found\");\r\n    }\r\n\r\n    await this.taskRepository.softDelete(id);\r\n  }\r\n}\r\n","import { TaskRepository } from \"../provider/task.repository\";\r\n\r\nexport class RestoreTaskUseCase {\r\n  constructor(private taskRepository: TaskRepository) {}\r\n\r\n  async execute(id: string): Promise<void> {\r\n    const task = await this.taskRepository.findById(id);\r\n    if (!task) {\r\n      throw new Error(\"Task not found\");\r\n    }\r\n\r\n    if (!task.props.isDeleted) {\r\n      throw new Error(\"Task is not deleted\");\r\n    }\r\n\r\n    await this.taskRepository.restore(id);\r\n  }\r\n}\r\n","import { TaskRepository } from \"../provider/task.repository\";\r\n\r\nexport class PermanentDeleteTaskUseCase {\r\n  constructor(private taskRepository: TaskRepository) {}\r\n\r\n  async execute(id: string): Promise<void> {\r\n    const task = await this.taskRepository.findById(id);\r\n    if (!task) {\r\n      throw new Error(\"Task not found\");\r\n    }\r\n\r\n    if (!task.props.isDeleted) {\r\n      throw new Error(\"Task must be soft deleted first\");\r\n    }\r\n\r\n    await this.taskRepository.permanentDelete(id);\r\n  }\r\n}\r\n","import { TaskRepository } from \"../provider/task.repository\";\r\nimport { Task } from \"../model/task.entity\";\r\n\r\nexport class GetDeletedTasksUseCase {\r\n  constructor(private taskRepository: TaskRepository) {}\r\n\r\n  async execute(projectId: string): Promise<Task[]> {\r\n    const tasks = await this.taskRepository.findDeleted(projectId);\r\n    return tasks;\r\n  }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type WorkspaceType = \"PERSONAL\" | \"WORK\" | \"TEAM\";\r\nexport type WorkspaceTier = \"FREE\" | \"PRO\" | \"ENTERPRISE\";\r\n\r\nexport interface WorkspaceProps extends EntityProps {\r\n    name: string;\r\n    slug: string;\r\n    description?: string;\r\n    type: WorkspaceType;\r\n    tier: WorkspaceTier;\r\n    color: string;\r\n    icon?: string;\r\n    ownerId?: string;\r\n\r\n    // Lifecycle\r\n    isArchived: boolean;\r\n    isDeleted: boolean;\r\n    deletedAt?: Date;\r\n\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n\r\n    // Stats (Read-only)\r\n    stats?: {\r\n        projectCount: number;\r\n        taskCount: number;\r\n        memberCount: number;\r\n    };\r\n}\r\n\r\nexport class Workspace extends Entity<WorkspaceProps> {\r\n    constructor(props: WorkspaceProps) {\r\n        super({\r\n            ...props,\r\n            tier: props.tier ?? \"FREE\",\r\n            isArchived: props.isArchived ?? false,\r\n            isDeleted: props.isDeleted ?? false,\r\n            color: props.color ?? \"#2563EB\",\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<WorkspaceProps, \"id\" | \"createdAt\" | \"updatedAt\" | \"isArchived\" | \"isDeleted\" | \"deletedAt\">): Workspace {\r\n        return new Workspace({\r\n            ...props,\r\n            tier: props.tier ?? \"FREE\",\r\n            isArchived: false,\r\n            isDeleted: false,\r\n            color: props.color ?? \"#2563EB\",\r\n        });\r\n    }\r\n\r\n    update(props: Partial<Omit<WorkspaceProps, \"id\" | \"ownerId\" | \"createdAt\">>): Workspace {\r\n        return this.clone({\r\n            ...props,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    softDelete(): Workspace {\r\n        return this.clone({\r\n            isDeleted: true,\r\n            deletedAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    restore(): Workspace {\r\n        return this.clone({\r\n            isDeleted: false,\r\n            deletedAt: undefined,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    archive(): Workspace {\r\n        return this.clone({\r\n            isArchived: true,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    unarchive(): Workspace {\r\n        return this.clone({\r\n            isArchived: false,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    setStats(stats: { projectCount: number; taskCount: number; memberCount: number }): Workspace {\r\n        return this.clone({\r\n            stats,\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type MemberRole = \"OWNER\" | \"ADMIN\" | \"MEMBER\" | \"VIEWER\";\r\n\r\nexport interface WorkspaceMemberProps extends EntityProps {\r\n    workspaceId: string;\r\n    userId: string;\r\n    role: MemberRole;\r\n    joinedAt: Date;\r\n}\r\n\r\nexport class WorkspaceMember extends Entity<WorkspaceMemberProps> {\r\n    constructor(props: WorkspaceMemberProps) {\r\n        super({\r\n            ...props,\r\n            joinedAt: props.joinedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<WorkspaceMemberProps, \"id\" | \"joinedAt\">): WorkspaceMember {\r\n        return new WorkspaceMember({\r\n            ...props,\r\n            joinedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type ViewType = \"LIST\" | \"KANBAN\" | \"CALENDAR\" | \"TIMELINE\" | \"FOCUS\";\r\n\r\nexport interface WorkspaceSettingsProps extends EntityProps {\r\n    workspaceId: string;\r\n    defaultView?: ViewType;\r\n    defaultDueTime?: number; // minutos desde inicio del día (ej. 540 = 9:00 AM)\r\n    timezone?: string; // ej. \"America/Mexico_City\"\r\n    locale?: string; // ej. \"es-MX\"\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nexport class WorkspaceSettings extends Entity<WorkspaceSettingsProps> {\r\n    constructor(props: WorkspaceSettingsProps) {\r\n        super({\r\n            ...props,\r\n            defaultView: props.defaultView ?? \"LIST\",\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<WorkspaceSettingsProps, \"id\" | \"createdAt\" | \"updatedAt\">): WorkspaceSettings {\r\n        return new WorkspaceSettings({\r\n            ...props,\r\n            defaultView: props.defaultView ?? \"LIST\",\r\n        });\r\n    }\r\n\r\n    update(props: Partial<Omit<WorkspaceSettingsProps, \"id\" | \"workspaceId\" | \"createdAt\">>): WorkspaceSettings {\r\n        return this.clone({\r\n            ...props,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type AuditAction =\r\n    | \"WORKSPACE_CREATED\"\r\n    | \"WORKSPACE_UPDATED\"\r\n    | \"WORKSPACE_ARCHIVED\"\r\n    | \"WORKSPACE_UNARCHIVED\"\r\n    | \"WORKSPACE_DELETED\"\r\n    | \"MEMBER_INVITED\"\r\n    | \"MEMBER_JOINED\"\r\n    | \"MEMBER_REMOVED\"\r\n    | \"MEMBER_ROLE_CHANGED\"\r\n    | \"PROJECT_CREATED\"\r\n    | \"PROJECT_DELETED\"\r\n    | \"SETTINGS_UPDATED\";\r\n\r\nexport interface WorkspaceAuditLogProps extends EntityProps {\r\n    workspaceId: string;\r\n    actorId?: string; // Usuario que realizó la acción (puede ser null para acciones del sistema)\r\n    action: AuditAction;\r\n    payload?: Record<string, unknown>; // Detalles del cambio\r\n    createdAt?: Date;\r\n}\r\n\r\nexport class WorkspaceAuditLog extends Entity<WorkspaceAuditLogProps> {\r\n    constructor(props: WorkspaceAuditLogProps) {\r\n        super({\r\n            ...props,\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<WorkspaceAuditLogProps, \"id\" | \"createdAt\">): WorkspaceAuditLog {\r\n        return new WorkspaceAuditLog(props);\r\n    }\r\n}\r\n","import { Workspace, WorkspaceProps } from \"../model/workspace.entity\";\r\nimport { WorkspaceRepository } from \"../provider/workspace.repository\";\r\n\r\nexport class CreateWorkspaceUseCase {\r\n  constructor(\r\n    private workspaceRepository: WorkspaceRepository,\r\n    private ownerUsername?: string,\r\n  ) { }\r\n\r\n  async execute(\r\n    props: Omit<\r\n      WorkspaceProps,\r\n      | \"id\"\r\n      | \"slug\"\r\n      | \"createdAt\"\r\n      | \"updatedAt\"\r\n      | \"isArchived\"\r\n      | \"isDeleted\"\r\n      | \"deletedAt\"\r\n    >,\r\n    ownerUsername?: string,\r\n  ): Promise<Workspace> {\r\n    const username = ownerUsername || this.ownerUsername;\r\n    const workspaceNameSlug = this.generateSlug(props.name);\r\n\r\n    const slug = workspaceNameSlug;\r\n\r\n    let finalSlug = slug;\r\n    let counter = 1;\r\n\r\n    // Check for slug uniqueness within the owner's context\r\n    if (props.ownerId) {\r\n      while (await this.workspaceRepository.findBySlug(finalSlug, props.ownerId)) {\r\n        if (username) {\r\n          finalSlug = `${username}/${workspaceNameSlug}-${counter}`;\r\n        } else {\r\n          finalSlug = `${workspaceNameSlug}-${counter}`;\r\n        }\r\n        counter++;\r\n      }\r\n    }\r\n\r\n    const workspace = Workspace.create({\r\n      ...props,\r\n      slug: finalSlug,\r\n    });\r\n    return this.workspaceRepository.create(workspace);\r\n  }\r\n\r\n  private generateSlug(name: string): string {\r\n    return name\r\n      .toLowerCase()\r\n      .trim()\r\n      .replace(/[^\\w\\s-]/g, \"\")\r\n      .replace(/[\\s_-]+/g, \"-\")\r\n      .replace(/^-+|-+$/g, \"\");\r\n  }\r\n}\r\n","import { WorkspaceMember, MemberRole } from \"../model/workspace-member.entity\";\r\nimport { WorkspaceRepository } from \"../provider/workspace.repository\";\r\n\r\nexport class AddMemberToWorkspaceUseCase {\r\n    constructor(private workspaceRepository: WorkspaceRepository) { }\r\n\r\n    async execute(workspaceId: string, userId: string, role: MemberRole = \"MEMBER\"): Promise<WorkspaceMember> {\r\n        // Check if workspace exists\r\n        const workspace = await this.workspaceRepository.findById(workspaceId);\r\n        if (!workspace) {\r\n            throw new Error(\"Workspace not found\");\r\n        }\r\n\r\n        // Check if user is already a member\r\n        const existingMember = await this.workspaceRepository.findMember(workspaceId, userId);\r\n        if (existingMember) {\r\n            // If already a member, return existing member (idempotent operation)\r\n            // This handles the case where the repository already added the owner as member during workspace creation\r\n            return existingMember;\r\n        }\r\n\r\n        const member = WorkspaceMember.create({\r\n            workspaceId,\r\n            userId,\r\n            role,\r\n        });\r\n\r\n        return this.workspaceRepository.addMember(member);\r\n    }\r\n}\r\n","import { WorkspaceRepository } from \"../provider/workspace.repository\";\r\n\r\nexport class RemoveMemberFromWorkspaceUseCase {\r\n    constructor(private workspaceRepository: WorkspaceRepository) { }\r\n\r\n    async execute(workspaceId: string, userId: string): Promise<void> {\r\n        // Check if workspace exists\r\n        const workspace = await this.workspaceRepository.findById(workspaceId);\r\n        if (!workspace) {\r\n            throw new Error(\"Workspace not found\");\r\n        }\r\n\r\n        // Check if member exists\r\n        const member = await this.workspaceRepository.findMember(workspaceId, userId);\r\n        if (!member) {\r\n            throw new Error(\"User is not a member of this workspace\");\r\n        }\r\n\r\n        // Prevent removing the owner (if applicable logic exists, but for now simple removal)\r\n        // Ideally we should check if the user is the owner, but ownerId is on Workspace.\r\n        if (workspace.props.ownerId === userId) {\r\n            throw new Error(\"Cannot remove the owner from the workspace\");\r\n        }\r\n\r\n        await this.workspaceRepository.removeMember(workspaceId, userId);\r\n    }\r\n}\r\n","import { WorkspaceRepository } from \"../provider/workspace.repository\";\n\nexport class SoftDeleteWorkspaceUseCase {\n  constructor(private workspaceRepository: WorkspaceRepository) {}\n\n  async execute(id: string, userId: string): Promise<void> {\n    const workspace = await this.workspaceRepository.findById(id);\n    if (!workspace) {\n      throw new Error(\"Workspace not found\");\n    }\n\n    if (workspace.props.ownerId !== userId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    await this.workspaceRepository.softDelete(id);\n  }\n}\n","import { WorkspaceRepository } from \"../provider/workspace.repository\";\r\n\r\nexport class RestoreWorkspaceUseCase {\r\n  constructor(private workspaceRepository: WorkspaceRepository) {}\r\n\r\n  async execute(id: string, userId: string): Promise<void> {\r\n    const workspace = await this.workspaceRepository.findById(id);\r\n    if (!workspace) {\r\n      throw new Error(\"Workspace not found\");\r\n    }\r\n\r\n    if (workspace.props.ownerId !== userId) {\r\n      throw new Error(\"Unauthorized\");\r\n    }\r\n\r\n    await this.workspaceRepository.restore(id);\r\n  }\r\n}\r\n","import { WorkspaceRepository } from \"../provider/workspace.repository\";\r\n\r\nexport class PermanentDeleteWorkspaceUseCase {\r\n    constructor(private workspaceRepository: WorkspaceRepository) { }\r\n\r\n    async execute(id: string, userId: string): Promise<void> {\r\n        const workspace = await this.workspaceRepository.findById(id);\r\n        if (!workspace) {\r\n            throw new Error(\"Workspace not found\");\r\n        }\r\n\r\n        if (workspace.props.ownerId !== userId) {\r\n            throw new Error(\"Unauthorized\");\r\n        }\r\n\r\n        if (!workspace.props.isDeleted) {\r\n            throw new Error(\"Workspace must be soft deleted first\");\r\n        }\r\n\r\n        await this.workspaceRepository.permanentDelete(id);\r\n    }\r\n}\r\n","import { Workspace } from \"../model/workspace.entity\";\r\nimport { WorkspaceRepository } from \"../provider/workspace.repository\";\r\n\r\nexport class GetDeletedWorkspacesUseCase {\r\n    constructor(private workspaceRepository: WorkspaceRepository) { }\r\n\r\n    async execute(userId: string): Promise<Workspace[]> {\r\n        return this.workspaceRepository.findDeleted(userId);\r\n    }\r\n}\r\n","import { Workspace } from \"../model/workspace.entity\";\r\nimport { WorkspaceRepository } from \"../provider/workspace.repository\";\r\n\r\nexport class ArchiveWorkspaceUseCase {\r\n    constructor(private workspaceRepository: WorkspaceRepository) { }\r\n\r\n    async execute(id: string, userId: string): Promise<Workspace> {\r\n        const workspace = await this.workspaceRepository.findById(id);\r\n        if (!workspace) {\r\n            throw new Error(\"Workspace not found\");\r\n        }\r\n\r\n        if (workspace.props.ownerId !== userId) {\r\n            throw new Error(\"Unauthorized\");\r\n        }\r\n\r\n        const archivedWorkspace = workspace.archive();\r\n        return this.workspaceRepository.update(archivedWorkspace);\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\nimport { MemberRole } from \"./workspace-member.entity\";\r\n\r\nexport type InviteStatus = \"PENDING\" | \"ACCEPTED\" | \"EXPIRED\" | \"CANCELLED\";\r\n\r\nexport interface WorkspaceInvitationProps extends EntityProps {\r\n    workspaceId: string;\r\n    email: string;\r\n    tokenHash: string;\r\n    role: MemberRole;\r\n    status: InviteStatus;\r\n    invitedById?: string;\r\n    expiresAt: Date;\r\n    acceptedAt?: Date;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nexport class WorkspaceInvitation extends Entity<WorkspaceInvitationProps> {\r\n    constructor(props: WorkspaceInvitationProps) {\r\n        super({\r\n            ...props,\r\n            status: props.status ?? \"PENDING\",\r\n            role: props.role ?? \"MEMBER\",\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<WorkspaceInvitationProps, \"id\" | \"createdAt\" | \"updatedAt\" | \"status\" | \"acceptedAt\">): WorkspaceInvitation {\r\n        return new WorkspaceInvitation({\r\n            ...props,\r\n            status: \"PENDING\",\r\n        });\r\n    }\r\n\r\n    accept(): WorkspaceInvitation {\r\n        return this.clone({\r\n            status: \"ACCEPTED\",\r\n            acceptedAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    cancel(): WorkspaceInvitation {\r\n        return this.clone({\r\n            status: \"CANCELLED\",\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    isExpired(): boolean {\r\n        return this.props.expiresAt < new Date();\r\n    }\r\n}\r\n","import { WorkspaceInvitation } from \"../model/workspace-invitation.entity\";\r\nimport { WorkspaceInvitationRepository } from \"../provider/workspace-invitation.repository\";\r\nimport { WorkspaceRepository } from \"../provider/workspace.repository\";\r\nimport { MemberRole } from \"../model/workspace-member.entity\";\r\nimport { HashService } from \"../../shared/services/hash.service\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nexport class InviteMemberUseCase {\r\n    constructor(\r\n        private workspaceRepository: WorkspaceRepository,\r\n        private invitationRepository: WorkspaceInvitationRepository,\r\n        private hashService: HashService\r\n    ) { }\r\n\r\n    async execute(workspaceId: string, email: string, role: MemberRole, invitedById: string): Promise<{ invitation: WorkspaceInvitation, token: string }> {\r\n        const workspace = await this.workspaceRepository.findById(workspaceId);\r\n        if (!workspace) {\r\n            throw new Error(\"Workspace not found\");\r\n        }\r\n\r\n        // Check if inviter is a member (and has permissions - simplified for now)\r\n        // In a real app, we'd check permissions here.\r\n\r\n        // Generate a secure random token\r\n        const token = uuidv4();\r\n\r\n        // Hash the token before storing it in the database\r\n        // This ensures that even if the database is compromised, tokens cannot be used\r\n        const tokenHash = await this.hashService.hash(token);\r\n\r\n        const expiresAt = new Date();\r\n        expiresAt.setDate(expiresAt.getDate() + 7); // 7 days expiration\r\n\r\n        const invitation = WorkspaceInvitation.create({\r\n            workspaceId,\r\n            email,\r\n            tokenHash,\r\n            role,\r\n            invitedById,\r\n            expiresAt,\r\n        });\r\n\r\n        const savedInvitation = await this.invitationRepository.create(invitation);\r\n\r\n        // Here we would trigger an event or call a service to send the email.\r\n        // For now, we return the plain token so the controller can display it (dev mode) or send it.\r\n        // IMPORTANT: The plain token should ONLY be sent via email, never stored or logged\r\n\r\n        return { invitation: savedInvitation, token };\r\n    }\r\n}\r\n","import { WorkspaceInvitation } from \"../model/workspace-invitation.entity\";\r\nimport { WorkspaceInvitationRepository } from \"../provider/workspace-invitation.repository\";\r\nimport { WorkspaceRepository } from \"../provider/workspace.repository\";\r\nimport { WorkspaceMember } from \"../model/workspace-member.entity\";\r\nimport { HashService } from \"../../shared/services/hash.service\";\r\n\r\nexport class AcceptInvitationUseCase {\r\n    constructor(\r\n        private workspaceRepository: WorkspaceRepository,\r\n        private invitationRepository: WorkspaceInvitationRepository,\r\n        private hashService: HashService\r\n    ) { }\r\n\r\n    async execute(token: string, userId: string): Promise<void> {\r\n        // Since we now store hashed tokens with bcrypt, we can't search directly by hash\r\n        // (bcrypt generates different hashes each time even for the same input)\r\n        // Instead, we fetch all pending invitations and compare the token against each hash\r\n\r\n        const pendingInvitations = await this.invitationRepository.findPendingInvitations();\r\n\r\n        if (pendingInvitations.length === 0) {\r\n            throw new Error(\"Invalid invitation token\");\r\n        }\r\n\r\n        // Find the invitation that matches the provided token\r\n        let matchedInvitation: WorkspaceInvitation | null = null;\r\n\r\n        for (const invitation of pendingInvitations) {\r\n            const isValid = await this.hashService.compare(token, invitation.props.tokenHash);\r\n            if (isValid) {\r\n                matchedInvitation = invitation;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!matchedInvitation) {\r\n            throw new Error(\"Invalid invitation token\");\r\n        }\r\n\r\n        if (matchedInvitation.isExpired()) {\r\n            throw new Error(\"Invitation expired\");\r\n        }\r\n\r\n        const workspaceId = matchedInvitation.props.workspaceId;\r\n\r\n        // Check if user is already a member of the workspace\r\n        const existingMember = await this.workspaceRepository.findMember(workspaceId, userId);\r\n        if (existingMember) {\r\n            // User is already a member - just mark the invitation as accepted and return\r\n            // This makes the operation idempotent and allows accepting invitations multiple times safely\r\n            const acceptedInvitation = matchedInvitation.accept();\r\n            await this.invitationRepository.update(acceptedInvitation);\r\n            return;\r\n        }\r\n\r\n        // Add member to workspace\r\n        const member = WorkspaceMember.create({\r\n            workspaceId,\r\n            userId,\r\n            role: matchedInvitation.props.role,\r\n        });\r\n\r\n        await this.workspaceRepository.addMember(member);\r\n\r\n        // Mark invitation as accepted\r\n        const acceptedInvitation = matchedInvitation.accept();\r\n        await this.invitationRepository.update(acceptedInvitation);\r\n    }\r\n}\r\n","import { WorkspaceSettings, ViewType } from \"../model/workspace-settings.entity\";\r\nimport { WorkspaceSettingsRepository } from \"../provider/workspace-settings.repository\";\r\n\r\nexport interface UpdateWorkspaceSettingsInput {\r\n    workspaceId: string;\r\n    defaultView?: ViewType;\r\n    defaultDueTime?: number;\r\n    timezone?: string;\r\n    locale?: string;\r\n}\r\n\r\nexport class UpdateWorkspaceSettingsUseCase {\r\n    constructor(private readonly settingsRepository: WorkspaceSettingsRepository) { }\r\n\r\n    async execute(input: UpdateWorkspaceSettingsInput): Promise<WorkspaceSettings> {\r\n        // Buscar configuración existente\r\n        const existing = await this.settingsRepository.findByWorkspaceId(input.workspaceId);\r\n\r\n        let settings: WorkspaceSettings;\r\n\r\n        if (existing) {\r\n            // Actualizar configuración existente\r\n            settings = existing.update({\r\n                defaultView: input.defaultView,\r\n                defaultDueTime: input.defaultDueTime,\r\n                timezone: input.timezone,\r\n                locale: input.locale,\r\n            });\r\n        } else {\r\n            // Crear nueva configuración\r\n            settings = WorkspaceSettings.create({\r\n                workspaceId: input.workspaceId,\r\n                defaultView: input.defaultView,\r\n                defaultDueTime: input.defaultDueTime,\r\n                timezone: input.timezone,\r\n                locale: input.locale,\r\n            });\r\n        }\r\n\r\n        return this.settingsRepository.upsert(settings);\r\n    }\r\n}\r\n","import { WorkspaceSettings } from \"../model/workspace-settings.entity\";\r\nimport { WorkspaceSettingsRepository } from \"../provider/workspace-settings.repository\";\r\n\r\nexport interface GetWorkspaceSettingsInput {\r\n    workspaceId: string;\r\n}\r\n\r\nexport class GetWorkspaceSettingsUseCase {\r\n    constructor(private readonly settingsRepository: WorkspaceSettingsRepository) { }\r\n\r\n    async execute(input: GetWorkspaceSettingsInput): Promise<WorkspaceSettings | null> {\r\n        return this.settingsRepository.findByWorkspaceId(input.workspaceId);\r\n    }\r\n}\r\n","import { WorkspaceAuditLog, AuditAction } from \"../model/workspace-audit-log.entity\";\r\nimport { WorkspaceAuditLogRepository } from \"../provider/workspace-audit-log.repository\";\r\n\r\nexport interface CreateAuditLogInput {\r\n    workspaceId: string;\r\n    actorId?: string;\r\n    action: AuditAction;\r\n    payload?: Record<string, unknown>;\r\n}\r\n\r\nexport class CreateAuditLogUseCase {\r\n    constructor(private readonly auditLogRepository: WorkspaceAuditLogRepository) { }\r\n\r\n    async execute(input: CreateAuditLogInput): Promise<WorkspaceAuditLog> {\r\n        const log = WorkspaceAuditLog.create({\r\n            workspaceId: input.workspaceId,\r\n            actorId: input.actorId,\r\n            action: input.action,\r\n            payload: input.payload,\r\n        });\r\n\r\n        return this.auditLogRepository.create(log);\r\n    }\r\n}\r\n","import { WorkspaceAuditLog } from \"../model/workspace-audit-log.entity\";\r\nimport { WorkspaceAuditLogRepository } from \"../provider/workspace-audit-log.repository\";\r\n\r\nexport interface GetWorkspaceAuditLogsInput {\r\n    workspaceId: string;\r\n    limit?: number;\r\n    offset?: number;\r\n}\r\n\r\nexport interface GetWorkspaceAuditLogsOutput {\r\n    logs: WorkspaceAuditLog[];\r\n    total: number;\r\n}\r\n\r\nexport class GetWorkspaceAuditLogsUseCase {\r\n    constructor(private readonly auditLogRepository: WorkspaceAuditLogRepository) { }\r\n\r\n    async execute(input: GetWorkspaceAuditLogsInput): Promise<GetWorkspaceAuditLogsOutput> {\r\n        const limit = input.limit ?? 50;\r\n        const offset = input.offset ?? 0;\r\n\r\n        const [logs, total] = await Promise.all([\r\n            this.auditLogRepository.findByWorkspaceId(input.workspaceId, limit, offset),\r\n            this.auditLogRepository.countByWorkspaceId(input.workspaceId),\r\n        ]);\r\n\r\n        return { logs, total };\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport interface ProjectProps extends EntityProps {\r\n  name: string;\r\n  slug: string;\r\n  description?: string;\r\n  color: string;\r\n  icon?: string;\r\n  workspaceId: string;\r\n  workflowId: string;\r\n  position: number;\r\n  archived: boolean;\r\n  completed: boolean;\r\n  completedAt?: Date;\r\n  isDeleted: boolean;\r\n  deletedAt?: Date;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport class Project extends Entity<ProjectProps> {\r\n  constructor(props: ProjectProps) {\r\n    super({\r\n      ...props,\r\n      color: props.color ?? \"#6B7280\",\r\n      position: props.position ?? 0,\r\n      archived: props.archived ?? false,\r\n      completed: props.completed ?? false,\r\n      isDeleted: props.isDeleted ?? false,\r\n      createdAt: props.createdAt ?? new Date(),\r\n      updatedAt: props.updatedAt ?? new Date(),\r\n    });\r\n  }\r\n\r\n  static create(\r\n    props: Omit<\r\n      ProjectProps,\r\n      | \"id\"\r\n      | \"createdAt\"\r\n      | \"updatedAt\"\r\n      | \"position\"\r\n      | \"archived\"\r\n      | \"completed\"\r\n      | \"completedAt\"\r\n      | \"isDeleted\"\r\n      | \"deletedAt\"\r\n    >,\r\n  ): Project {\r\n    return new Project({\r\n      ...props,\r\n      position: 0,\r\n      archived: false,\r\n      completed: false,\r\n      isDeleted: false,\r\n    });\r\n  }\r\n\r\n  update(\r\n    props: Partial<\r\n      Omit<ProjectProps, \"id\" | \"workspaceId\" | \"createdAt\" | \"workflowId\">\r\n    >,\r\n  ): Project {\r\n    return this.clone({\r\n      ...props,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  archive(): Project {\r\n    return this.clone({\r\n      archived: true,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  unarchive(): Project {\r\n    return this.clone({\r\n      archived: false,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  complete(): Project {\r\n    return this.clone({\r\n      completed: true,\r\n      completedAt: new Date(),\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  uncomplete(): Project {\r\n    return this.clone({\r\n      completed: false,\r\n      completedAt: undefined,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  softDelete(): Project {\r\n    return this.clone({\r\n      isDeleted: true,\r\n      deletedAt: new Date(),\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  restore(): Project {\r\n    return this.clone({\r\n      isDeleted: false,\r\n      deletedAt: undefined,\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n}\r\n","import { Project, ProjectProps } from \"../model/project.entity\";\r\nimport { ProjectRepository } from \"../provider/project.repository\";\r\n\r\nexport class CreateProjectUseCase {\r\n    constructor(private projectRepository: ProjectRepository) { }\r\n\r\n    async execute(props: Omit<ProjectProps, \"id\" | \"createdAt\" | \"updatedAt\" | \"position\" | \"archived\" | \"completed\" | \"completedAt\">): Promise<Project> {\r\n        const project = Project.create(props);\r\n        return this.projectRepository.create(project);\r\n    }\r\n}\r\n","import { Project, ProjectProps } from \"../model/project.entity\";\r\nimport { ProjectRepository } from \"../provider/project.repository\";\r\n\r\nexport class UpdateProjectUseCase {\r\n    constructor(private projectRepository: ProjectRepository) { }\r\n\r\n    async execute(id: string, props: Partial<Omit<ProjectProps, \"id\" | \"workspaceId\" | \"createdAt\">>): Promise<Project> {\r\n        const project = await this.projectRepository.findById(id);\r\n        if (!project) {\r\n            throw new Error(\"Project not found\");\r\n        }\r\n\r\n        const updatedProject = project.update(props);\r\n        return this.projectRepository.update(updatedProject);\r\n    }\r\n}\r\n","import { Project } from \"../model/project.entity\";\r\nimport { ProjectRepository } from \"../provider/project.repository\";\r\n\r\nexport class ArchiveProjectUseCase {\r\n    constructor(private projectRepository: ProjectRepository) { }\r\n\r\n    async execute(id: string): Promise<Project> {\r\n        const project = await this.projectRepository.findById(id);\r\n        if (!project) {\r\n            throw new Error(\"Project not found\");\r\n        }\r\n\r\n        // Toggle archive status: if archived, unarchive it; if not archived, archive it\r\n        const updatedProject = project.props.archived ? project.unarchive() : project.archive();\r\n        return this.projectRepository.update(updatedProject);\r\n    }\r\n}\r\n","import { ProjectRepository } from \"../provider/project.repository\";\r\n\r\nexport class DeleteProjectUseCase {\r\n    constructor(private projectRepository: ProjectRepository) { }\r\n\r\n    async execute(id: string): Promise<void> {\r\n        const project = await this.projectRepository.findById(id);\r\n        if (!project) {\r\n            throw new Error(\"Project not found\");\r\n        }\r\n\r\n        await this.projectRepository.delete(id);\r\n    }\r\n}\r\n","import { ProjectRepository } from \"../provider/project.repository\";\r\n\r\nexport class SoftDeleteProjectUseCase {\r\n  constructor(private projectRepository: ProjectRepository) {}\r\n\r\n  async execute(id: string): Promise<void> {\r\n    const project = await this.projectRepository.findById(id);\r\n    if (!project) {\r\n      throw new Error(\"Project not found\");\r\n    }\r\n\r\n    await this.projectRepository.softDelete(id);\r\n  }\r\n}\r\n","import { ProjectRepository } from \"../provider/project.repository\";\r\n\r\nexport class RestoreProjectUseCase {\r\n  constructor(private projectRepository: ProjectRepository) {}\r\n\r\n  async execute(id: string): Promise<void> {\r\n    const project = await this.projectRepository.findById(id);\r\n    if (!project) {\r\n      throw new Error(\"Project not found\");\r\n    }\r\n\r\n    if (!project.props.isDeleted) {\r\n      throw new Error(\"Project is not deleted\");\r\n    }\r\n\r\n    await this.projectRepository.restore(id);\r\n  }\r\n}\r\n","import { ProjectRepository } from \"../provider/project.repository\";\r\n\r\nexport class PermanentDeleteProjectUseCase {\r\n  constructor(private projectRepository: ProjectRepository) {}\r\n\r\n  async execute(id: string): Promise<void> {\r\n    const project = await this.projectRepository.findById(id);\r\n    if (!project) {\r\n      throw new Error(\"Project not found\");\r\n    }\r\n\r\n    if (!project.props.isDeleted) {\r\n      throw new Error(\"Project must be soft deleted first\");\r\n    }\r\n\r\n    await this.projectRepository.permanentDelete(id);\r\n  }\r\n}\r\n","import { ProjectRepository } from \"../provider/project.repository\";\r\nimport { Project } from \"../model/project.entity\";\r\n\r\nexport class GetDeletedProjectsUseCase {\r\n  constructor(private projectRepository: ProjectRepository) {}\r\n\r\n  async execute(workspaceId: string): Promise<Project[]> {\r\n    const projects = await this.projectRepository.findDeleted(workspaceId);\r\n    return projects;\r\n  }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport interface WorkflowProps extends EntityProps {\r\n    name: string;\r\n    description?: string;\r\n    color: string;\r\n    icon?: string;\r\n    workspaceId: string;\r\n    position: number;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nexport class Workflow extends Entity<WorkflowProps> {\r\n    constructor(props: WorkflowProps) {\r\n        super({\r\n            ...props,\r\n            color: props.color ?? \"#6B7280\",\r\n            position: props.position ?? 0,\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<WorkflowProps, \"id\" | \"createdAt\" | \"updatedAt\" | \"position\">): Workflow {\r\n        return new Workflow({\r\n            ...props,\r\n            position: 0,\r\n        });\r\n    }\r\n\r\n    update(props: Partial<Omit<WorkflowProps, \"id\" | \"workspaceId\" | \"createdAt\">>): Workflow {\r\n        return this.clone({\r\n            ...props,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { Workflow } from \"../model/workflow.entity\";\r\nimport { WorkflowRepository } from \"../provider/workflow.repository\";\r\n\r\ninterface CreateWorkflowInput {\r\n    name: string;\r\n    description?: string;\r\n    color?: string;\r\n    icon?: string;\r\n    workspaceId: string;\r\n}\r\n\r\nexport class CreateWorkflowUseCase implements UseCase<CreateWorkflowInput, Workflow> {\r\n    constructor(private readonly workflowRepository: WorkflowRepository) { }\r\n\r\n    async execute(input: CreateWorkflowInput): Promise<Workflow> {\r\n        const workflow = Workflow.create({\r\n            name: input.name,\r\n            description: input.description,\r\n            color: input.color ?? \"#6B7280\",\r\n            icon: input.icon,\r\n            workspaceId: input.workspaceId,\r\n        });\r\n\r\n        await this.workflowRepository.save(workflow);\r\n\r\n        return workflow;\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { Workflow } from \"../model/workflow.entity\";\r\nimport { WorkflowRepository } from \"../provider/workflow.repository\";\r\n\r\nexport class ListWorkflowsUseCase implements UseCase<string, Workflow[]> {\r\n    constructor(private readonly workflowRepository: WorkflowRepository) { }\r\n\r\n    async execute(workspaceId: string): Promise<Workflow[]> {\r\n        return this.workflowRepository.findByWorkspaceId(workspaceId);\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { Workflow } from \"../model/workflow.entity\";\r\nimport { WorkflowRepository } from \"../provider/workflow.repository\";\r\n\r\ninterface UpdateWorkflowInput {\r\n    id: string;\r\n    name?: string;\r\n    description?: string;\r\n    color?: string;\r\n    icon?: string;\r\n    position?: number;\r\n}\r\n\r\nexport class UpdateWorkflowUseCase implements UseCase<UpdateWorkflowInput, Workflow> {\r\n    constructor(private readonly workflowRepository: WorkflowRepository) { }\r\n\r\n    async execute(input: UpdateWorkflowInput): Promise<Workflow> {\r\n        const workflow = await this.workflowRepository.findById(input.id);\r\n\r\n        if (!workflow) {\r\n            throw new Error(\"Workflow not found\");\r\n        }\r\n\r\n        const updatedWorkflow = workflow.update({\r\n            name: input.name,\r\n            description: input.description,\r\n            color: input.color,\r\n            icon: input.icon,\r\n            position: input.position,\r\n        });\r\n\r\n        await this.workflowRepository.update(updatedWorkflow);\r\n\r\n        return updatedWorkflow;\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { WorkflowRepository } from \"../provider/workflow.repository\";\r\n\r\nexport class DeleteWorkflowUseCase implements UseCase<string, void> {\r\n    constructor(private readonly workflowRepository: WorkflowRepository) { }\r\n\r\n    async execute(id: string): Promise<void> {\r\n        await this.workflowRepository.delete(id);\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport interface TagProps extends EntityProps {\r\n    name: string;\r\n    color: string;\r\n    workspaceId?: string; // Tags are usually per workspace or global? Schema says workspaceId.\r\n    createdAt?: Date;\r\n}\r\n\r\nexport class Tag extends Entity<TagProps> {\r\n    constructor(props: TagProps) {\r\n        super({\r\n            ...props,\r\n            color: props.color ?? \"#6B7280\",\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<TagProps, \"id\" | \"createdAt\">): Tag {\r\n        return new Tag({\r\n            ...props,\r\n        });\r\n    }\r\n\r\n    update(props: Partial<Omit<TagProps, \"id\" | \"workspaceId\" | \"createdAt\">>): Tag {\r\n        return this.clone({\r\n            ...props\r\n        });\r\n    }\r\n}\r\n","import { Tag, TagProps } from \"../model/tag.entity\";\r\nimport { TagRepository } from \"../provider/tag.repository\";\r\n\r\nexport class CreateTagUseCase {\r\n    constructor(private tagRepository: TagRepository) { }\r\n\r\n    async execute(props: Omit<TagProps, \"id\" | \"createdAt\">): Promise<Tag> {\r\n        const tag = Tag.create(props);\r\n        return this.tagRepository.create(tag);\r\n    }\r\n}\r\n","import { TagRepository } from \"../provider/tag.repository\";\r\n\r\nexport class AssignTagToTaskUseCase {\r\n    constructor(private tagRepository: TagRepository) { }\r\n\r\n    async execute(tagId: string, taskId: string): Promise<void> {\r\n        // Verify tag exists\r\n        const tag = await this.tagRepository.findById(tagId);\r\n        if (!tag) {\r\n            throw new Error(\"Tag not found\");\r\n        }\r\n\r\n        // We could also verify task exists if we had TaskRepository here, \r\n        // but usually the repo implementation will handle FK constraint errors.\r\n\r\n        await this.tagRepository.assignToTask(tagId, taskId);\r\n    }\r\n}\r\n","import { TagRepository } from \"../provider/tag.repository\";\r\n\r\nexport class RemoveTagFromTaskUseCase {\r\n    constructor(private tagRepository: TagRepository) { }\r\n\r\n    async execute(tagId: string, taskId: string): Promise<void> {\r\n        await this.tagRepository.removeFromTask(tagId, taskId);\r\n    }\r\n}\r\n","import { Tag, TagProps } from \"../model/tag.entity\";\r\nimport { TagRepository } from \"../provider/tag.repository\";\r\n\r\nexport class UpdateTagUseCase {\r\n    constructor(private tagRepository: TagRepository) { }\r\n\r\n    async execute(id: string, props: Partial<Omit<TagProps, \"id\" | \"workspaceId\" | \"createdAt\">>): Promise<Tag> {\r\n        const tag = await this.tagRepository.findById(id);\r\n        if (!tag) {\r\n            throw new Error(\"Tag not found\");\r\n        }\r\n\r\n        const updatedTag = tag.update(props);\r\n        return this.tagRepository.update(updatedTag);\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type SessionType = \"WORK\" | \"SHORT_BREAK\" | \"LONG_BREAK\" | \"CONTINUOUS\";\r\n\r\nexport interface PauseRecord {\r\n    startedAt: Date;\r\n    endedAt: Date;\r\n    duration: number; // in seconds\r\n}\r\n\r\n\r\n\r\nexport interface TimeSessionProps extends EntityProps {\r\n    taskId?: string;\r\n    userId: string;\r\n    startedAt: Date;\r\n    endedAt?: Date;\r\n    duration?: number; // in minutes (excludes pause time)\r\n    type: SessionType;\r\n    wasCompleted: boolean;\r\n    wasInterrupted: boolean;\r\n    pauseCount?: number;\r\n    totalPauseTime?: number; // in seconds\r\n    pauseData?: PauseRecord[];\r\n    currentPauseStart?: Date;\r\n    parentSessionId?: string;\r\n    splitReason?: string;\r\n    createdAt?: Date;\r\n}\r\n\r\nexport class TimeSession extends Entity<TimeSessionProps> {\r\n    constructor(props: TimeSessionProps) {\r\n        super({\r\n            ...props,\r\n            type: props.type ?? \"WORK\",\r\n            wasCompleted: props.wasCompleted ?? false,\r\n            wasInterrupted: props.wasInterrupted ?? false,\r\n            pauseCount: props.pauseCount ?? 0,\r\n            totalPauseTime: props.totalPauseTime ?? 0,\r\n            pauseData: props.pauseData ?? [],\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<TimeSessionProps, \"id\" | \"createdAt\" | \"wasCompleted\" | \"wasInterrupted\" | \"pauseCount\" | \"totalPauseTime\" | \"pauseData\" | \"currentPauseStart\">): TimeSession {\r\n        return new TimeSession({\r\n            ...props,\r\n            wasCompleted: false,\r\n            wasInterrupted: false,\r\n            pauseCount: 0,\r\n            totalPauseTime: 0,\r\n            pauseData: [],\r\n            currentPauseStart: undefined,\r\n        });\r\n    }\r\n\r\n    pause(pauseStartedAt: Date = new Date()): TimeSession {\r\n        // If already paused, don't pause again or update start time? \r\n        // For now assume it's valid call.\r\n        return this.clone({\r\n            pauseCount: (this.props.pauseCount ?? 0) + 1,\r\n            currentPauseStart: pauseStartedAt,\r\n        });\r\n    }\r\n\r\n    resume(pauseStartedAt: Date, pauseEndedAt: Date = new Date()): TimeSession {\r\n        // Use stored currentPauseStart if available, otherwise use argument\r\n        const actualPauseStart = this.props.currentPauseStart ?? pauseStartedAt;\r\n\r\n        const pauseDuration = Math.floor((pauseEndedAt.getTime() - actualPauseStart.getTime()) / 1000);\r\n        const pauseRecord: PauseRecord = {\r\n            startedAt: actualPauseStart,\r\n            endedAt: pauseEndedAt,\r\n            duration: pauseDuration,\r\n        };\r\n\r\n        return this.clone({\r\n            totalPauseTime: (this.props.totalPauseTime ?? 0) + pauseDuration,\r\n            pauseData: [...(this.props.pauseData ?? []), pauseRecord],\r\n            currentPauseStart: undefined,\r\n        });\r\n    }\r\n\r\n    stop(endedAt: Date = new Date(), wasCompleted: boolean = false, wasInterrupted: boolean = false): TimeSession {\r\n        // If stopped while paused, we need to handle the pending pause.\r\n        // Usually stop implies finishing the session.\r\n        // If paused, the duration should exclude the current pause duration?\r\n        // Or should we consider the session ended at the start of the pause?\r\n        // Let's assume we count time up to 'endedAt', excluding 'totalPauseTime'.\r\n        // If currently paused, we should probably add the current pause to totalPauseTime?\r\n        // Or just ignore the current pause \"gap\" and say it ended now.\r\n\r\n        let extraPauseTime = 0;\r\n        if (this.props.currentPauseStart) {\r\n            // If we stop while paused, the time from pauseStart to now is technically pause time, \r\n            // but since we are stopping, maybe we just consider the work ended at pauseStart?\r\n            // But 'endedAt' is passed.\r\n            // Let's stick to simple logic: total duration = (endedAt - startedAt) - totalPauseTime.\r\n            // If we are paused, we should probably close the pause first?\r\n            // For simplicity, let's assume the user resumes then stops, or we just calculate active time.\r\n\r\n            // If we are paused, the time since pauseStart is NOT work time.\r\n            // So we should add it to totalPauseTime.\r\n            extraPauseTime = Math.floor((endedAt.getTime() - this.props.currentPauseStart.getTime()) / 1000);\r\n        }\r\n\r\n        const totalMs = endedAt.getTime() - this.props.startedAt.getTime();\r\n        const totalSeconds = Math.floor(totalMs / 1000);\r\n        const activeSeconds = totalSeconds - (this.props.totalPauseTime ?? 0) - extraPauseTime;\r\n        const durationMinutes = Math.round(activeSeconds / 60);\r\n\r\n        return this.clone({\r\n            endedAt,\r\n            duration: durationMinutes,\r\n            wasCompleted,\r\n            wasInterrupted,\r\n            currentPauseStart: undefined, // Clear pause state\r\n            totalPauseTime: (this.props.totalPauseTime ?? 0) + extraPauseTime,\r\n        });\r\n    }\r\n\r\n    split(endedAt: Date = new Date(), wasCompleted: boolean = true, splitReason: string = \"TASK_SWITCH\"): TimeSession {\r\n        let extraPauseTime = 0;\r\n        if (this.props.currentPauseStart) {\r\n            extraPauseTime = Math.floor((endedAt.getTime() - this.props.currentPauseStart.getTime()) / 1000);\r\n        }\r\n\r\n        const totalMs = endedAt.getTime() - this.props.startedAt.getTime();\r\n        const totalSeconds = Math.floor(totalMs / 1000);\r\n        const activeSeconds = totalSeconds - (this.props.totalPauseTime ?? 0) - extraPauseTime;\r\n        const durationMinutes = Math.round(activeSeconds / 60);\r\n\r\n        return this.clone({\r\n            endedAt,\r\n            duration: durationMinutes,\r\n            wasCompleted,\r\n            wasInterrupted: false,\r\n            splitReason,\r\n            currentPauseStart: undefined,\r\n            totalPauseTime: (this.props.totalPauseTime ?? 0) + extraPauseTime,\r\n        });\r\n    }\r\n}\r\n","import { TimeSession, SessionType } from \"../model/time-session.entity\";\r\nimport { TimerRepository } from \"../provider/timer.repository\";\r\nimport { TaskRepository } from \"../../tasks/provider/task.repository\";\r\n\r\nexport class StartTimerUseCase {\r\n    constructor(\r\n        private timerRepository: TimerRepository,\r\n        private taskRepository: TaskRepository\r\n    ) { }\r\n\r\n    async execute(userId: string, taskId?: string, type: SessionType = \"WORK\"): Promise<TimeSession> {\r\n        // Check if there is already an active session\r\n        const activeSession = await this.timerRepository.findActiveSession(userId);\r\n        if (activeSession) {\r\n            // Automatically stop the previous session as interrupted\r\n            const stoppedSession = activeSession.stop(new Date(), false, true);\r\n            await this.timerRepository.update(stoppedSession);\r\n        }\r\n\r\n        const session = TimeSession.create({\r\n            userId,\r\n            taskId,\r\n            startedAt: new Date(),\r\n            type,\r\n        });\r\n\r\n        const createdSession = await this.timerRepository.create(session);\r\n\r\n        // Update task status to IN_PROGRESS if it's a WORK session and taskId is provided\r\n        if (type === \"WORK\" && taskId) {\r\n            const task = await this.taskRepository.findById(taskId);\r\n            if (task && task.props.status === \"TODO\") {\r\n                const updatedTask = task.updateStatus(\"IN_PROGRESS\");\r\n                await this.taskRepository.update(updatedTask);\r\n            }\r\n        }\r\n\r\n        return createdSession;\r\n    }\r\n}\r\n","import { TimeSession } from \"../model/time-session.entity\";\r\nimport { TimerRepository } from \"../provider/timer.repository\";\r\n\r\nexport class StopTimerUseCase {\r\n    constructor(private timerRepository: TimerRepository) { }\r\n\r\n    async execute(userId: string, wasCompleted: boolean = false): Promise<TimeSession> {\r\n        const activeSession = await this.timerRepository.findActiveSession(userId);\r\n        if (!activeSession) {\r\n            throw new Error(\"No active timer session found\");\r\n        }\r\n\r\n        const stoppedSession = activeSession.stop(new Date(), wasCompleted, !wasCompleted);\r\n        return this.timerRepository.update(stoppedSession);\r\n    }\r\n}\r\n","import { TimeSession } from \"../model/time-session.entity\";\r\nimport { TimerRepository } from \"../provider/timer.repository\";\r\n\r\nexport class PauseTimerUseCase {\r\n    constructor(private timerRepository: TimerRepository) { }\r\n\r\n    async execute(userId: string, pauseStartedAt: Date = new Date()): Promise<TimeSession> {\r\n        const activeSession = await this.timerRepository.findActiveSession(userId);\r\n        if (!activeSession) {\r\n            throw new Error(\"No active timer session found\");\r\n        }\r\n\r\n        const pausedSession = activeSession.pause(pauseStartedAt);\r\n        return this.timerRepository.update(pausedSession);\r\n    }\r\n}\r\n","import { TimeSession } from \"../model/time-session.entity\";\r\nimport { TimerRepository } from \"../provider/timer.repository\";\r\n\r\nexport class ResumeTimerUseCase {\r\n    constructor(private timerRepository: TimerRepository) { }\r\n\r\n    async execute(userId: string, pauseStartedAt: Date, pauseEndedAt: Date = new Date()): Promise<TimeSession> {\r\n        const activeSession = await this.timerRepository.findActiveSession(userId);\r\n        if (!activeSession) {\r\n            throw new Error(\"No active timer session found\");\r\n        }\r\n\r\n        const resumedSession = activeSession.resume(pauseStartedAt, pauseEndedAt);\r\n        return this.timerRepository.update(resumedSession);\r\n    }\r\n}\r\n","import { TimeSession, SessionType } from \"../model/time-session.entity\";\r\nimport { TimerRepository } from \"../provider/timer.repository\";\r\n\r\nexport class SwitchTaskUseCase {\r\n    constructor(private timerRepository: TimerRepository) { }\r\n\r\n    async execute(\r\n        userId: string,\r\n        newTaskId: string,\r\n        type: SessionType = \"WORK\",\r\n        splitReason: string = \"TASK_SWITCH\"\r\n    ): Promise<{ oldSession: TimeSession; newSession: TimeSession }> {\r\n        // Get current active session\r\n        const activeSession = await this.timerRepository.findActiveSession(userId);\r\n        if (!activeSession) {\r\n            throw new Error(\"No active timer session found\");\r\n        }\r\n\r\n        // Stop the current session as \"completed\" since the work done is valid\r\n        const stoppedSession = activeSession.split(new Date(), true, splitReason);\r\n        await this.timerRepository.update(stoppedSession);\r\n\r\n        // Create a new session for the new task\r\n        const newSession = TimeSession.create({\r\n            userId,\r\n            taskId: newTaskId,\r\n            startedAt: new Date(),\r\n            type,\r\n            parentSessionId: stoppedSession.id as string,\r\n        });\r\n\r\n        const createdSession = await this.timerRepository.create(newSession);\r\n\r\n        return {\r\n            oldSession: stoppedSession,\r\n            newSession: createdSession,\r\n        };\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport interface DailyMetricsProps extends EntityProps {\r\n    userId: string;\r\n    date: Date;\r\n    tasksCreated: number;\r\n    tasksCompleted: number;\r\n    subtasksCompleted: number;\r\n    minutesWorked: number;\r\n    pomodorosCompleted: number;\r\n    shortBreaksCompleted: number;\r\n    longBreaksCompleted: number;\r\n    breakMinutes: number;\r\n    focusScore?: number;\r\n    createdAt?: Date;\r\n}\r\n\r\nexport class DailyMetrics extends Entity<DailyMetricsProps> {\r\n    constructor(props: DailyMetricsProps) {\r\n        super({\r\n            ...props,\r\n            tasksCreated: props.tasksCreated ?? 0,\r\n            tasksCompleted: props.tasksCompleted ?? 0,\r\n            subtasksCompleted: props.subtasksCompleted ?? 0,\r\n            minutesWorked: props.minutesWorked ?? 0,\r\n            pomodorosCompleted: props.pomodorosCompleted ?? 0,\r\n            shortBreaksCompleted: props.shortBreaksCompleted ?? 0,\r\n            longBreaksCompleted: props.longBreaksCompleted ?? 0,\r\n            breakMinutes: props.breakMinutes ?? 0,\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(props: Omit<DailyMetricsProps, \"id\" | \"createdAt\" | \"tasksCreated\" | \"tasksCompleted\" | \"subtasksCompleted\" | \"minutesWorked\" | \"pomodorosCompleted\" | \"shortBreaksCompleted\" | \"longBreaksCompleted\" | \"breakMinutes\">): DailyMetrics {\r\n        return new DailyMetrics({\r\n            ...props,\r\n            tasksCreated: 0,\r\n            tasksCompleted: 0,\r\n            subtasksCompleted: 0,\r\n            minutesWorked: 0,\r\n            pomodorosCompleted: 0,\r\n            shortBreaksCompleted: 0,\r\n            longBreaksCompleted: 0,\r\n            breakMinutes: 0,\r\n        });\r\n    }\r\n\r\n    incrementTasksCreated(): DailyMetrics {\r\n        return this.clone({ tasksCreated: this.props.tasksCreated + 1 });\r\n    }\r\n\r\n    incrementTasksCompleted(): DailyMetrics {\r\n        return this.clone({ tasksCompleted: this.props.tasksCompleted + 1 });\r\n    }\r\n\r\n    decrementTasksCompleted(): DailyMetrics {\r\n        return this.clone({ tasksCompleted: Math.max(0, this.props.tasksCompleted - 1) });\r\n    }\r\n\r\n    incrementSubtasksCompleted(): DailyMetrics {\r\n        return this.clone({ subtasksCompleted: this.props.subtasksCompleted + 1 });\r\n    }\r\n\r\n    decrementSubtasksCompleted(): DailyMetrics {\r\n        return this.clone({ subtasksCompleted: Math.max(0, this.props.subtasksCompleted - 1) });\r\n    }\r\n\r\n    addMinutesWorked(minutes: number): DailyMetrics {\r\n        return this.clone({ minutesWorked: this.props.minutesWorked + minutes });\r\n    }\r\n\r\n    incrementPomodoros(): DailyMetrics {\r\n        return this.clone({ pomodorosCompleted: this.props.pomodorosCompleted + 1 });\r\n    }\r\n\r\n    updateFocusScore(score: number): DailyMetrics {\r\n        return this.clone({ focusScore: Math.max(0, Math.min(1, score)) });\r\n    }\r\n\r\n    incrementShortBreaks(): DailyMetrics {\r\n        return this.clone({ shortBreaksCompleted: this.props.shortBreaksCompleted + 1 });\r\n    }\r\n\r\n    incrementLongBreaks(): DailyMetrics {\r\n        return this.clone({ longBreaksCompleted: this.props.longBreaksCompleted + 1 });\r\n    }\r\n\r\n    addBreakMinutes(minutes: number): DailyMetrics {\r\n        return this.clone({ breakMinutes: this.props.breakMinutes + minutes });\r\n    }\r\n}\r\n","import { DailyMetrics } from \"../model/daily-metrics.entity\";\r\nimport { AnalyticsRepository } from \"../provider/analytics.repository\";\r\n\r\nexport class GetDailyMetricsUseCase {\r\n    constructor(private analyticsRepository: AnalyticsRepository) { }\r\n\r\n    async execute(userId: string, date: Date = new Date()): Promise<DailyMetrics> {\r\n        // Normalize date to start of day or just use the date part\r\n        // For simplicity, let's assume the repository handles date matching (ignoring time)\r\n        // or we pass a specific date object.\r\n\r\n        // Let's normalize to YYYY-MM-DD in the logic if needed, but Date object is standard.\r\n        // We'll rely on the repository to find by \"day\".\r\n\r\n        let metrics = await this.analyticsRepository.findByDate(userId, date);\r\n\r\n        if (!metrics) {\r\n            // Return empty metrics for UI to display zeros, but don't persist yet?\r\n            // Or create new?\r\n            // Let's return a draft/new instance without ID.\r\n            metrics = DailyMetrics.create({\r\n                userId,\r\n                date,\r\n            });\r\n        }\r\n\r\n        return metrics;\r\n    }\r\n}\r\n","import { DailyMetrics } from \"../model/daily-metrics.entity\";\r\nimport { AnalyticsRepository } from \"../provider/analytics.repository\";\r\n\r\nexport interface UpdateDailyMetricsInput {\r\n    userId: string;\r\n    date: Date;\r\n    tasksCreated?: number;\r\n    tasksCompleted?: number;\r\n    subtasksCompleted?: number;\r\n    minutesWorked?: number;\r\n    pomodorosCompleted?: number;\r\n    shortBreaksCompleted?: number;\r\n    longBreaksCompleted?: number;\r\n    breakMinutes?: number;\r\n    focusScore?: number;\r\n}\r\n\r\nexport class UpdateDailyMetricsUseCase {\r\n    constructor(private analyticsRepository: AnalyticsRepository) { }\r\n\r\n    async execute(input: UpdateDailyMetricsInput): Promise<DailyMetrics> {\r\n        // Normalize date to start of day (ignore time)\r\n        const normalizedDate = new Date(input.date);\r\n        normalizedDate.setHours(0, 0, 0, 0);\r\n\r\n        // Find or create daily metrics\r\n        let metrics = await this.analyticsRepository.findByDate(input.userId, normalizedDate);\r\n\r\n        if (!metrics) {\r\n            metrics = DailyMetrics.create({\r\n                userId: input.userId,\r\n                date: normalizedDate,\r\n            });\r\n        }\r\n\r\n        // Apply increments\r\n        if (input.tasksCreated) {\r\n            for (let i = 0; i < input.tasksCreated; i++) {\r\n                metrics = metrics.incrementTasksCreated();\r\n            }\r\n        }\r\n\r\n        if (input.tasksCompleted) {\r\n            for (let i = 0; i < Math.abs(input.tasksCompleted); i++) {\r\n                if (input.tasksCompleted > 0) {\r\n                    metrics = metrics.incrementTasksCompleted();\r\n                } else {\r\n                    metrics = metrics.decrementTasksCompleted();\r\n                }\r\n            }\r\n        }\r\n\r\n        if (input.subtasksCompleted) {\r\n            for (let i = 0; i < Math.abs(input.subtasksCompleted); i++) {\r\n                if (input.subtasksCompleted > 0) {\r\n                    metrics = metrics.incrementSubtasksCompleted();\r\n                } else {\r\n                    metrics = metrics.decrementSubtasksCompleted();\r\n                }\r\n            }\r\n        }\r\n\r\n        if (input.minutesWorked) {\r\n            metrics = metrics.addMinutesWorked(input.minutesWorked);\r\n        }\r\n\r\n        if (input.pomodorosCompleted) {\r\n            for (let i = 0; i < input.pomodorosCompleted; i++) {\r\n                metrics = metrics.incrementPomodoros();\r\n            }\r\n        }\r\n\r\n        if (input.shortBreaksCompleted) {\r\n            for (let i = 0; i < input.shortBreaksCompleted; i++) {\r\n                metrics = metrics.incrementShortBreaks();\r\n            }\r\n        }\r\n\r\n        if (input.longBreaksCompleted) {\r\n            for (let i = 0; i < input.longBreaksCompleted; i++) {\r\n                metrics = metrics.incrementLongBreaks();\r\n            }\r\n        }\r\n\r\n        if (input.breakMinutes) {\r\n            metrics = metrics.addBreakMinutes(input.breakMinutes);\r\n        }\r\n\r\n        if (input.focusScore !== undefined) {\r\n            metrics = metrics.updateFocusScore(input.focusScore);\r\n        }\r\n\r\n        // Save and return\r\n        await this.analyticsRepository.save(metrics);\r\n        return metrics;\r\n    }\r\n}\r\n","export interface FocusScoreInput {\r\n    totalWorkSeconds: number;\r\n    totalPauseSeconds: number;\r\n    pauseCount: number;\r\n}\r\n\r\nexport class CalculateFocusScoreUseCase {\r\n    execute(input: FocusScoreInput): number {\r\n        const { totalWorkSeconds, totalPauseSeconds, pauseCount } = input;\r\n\r\n        // If no work time, return 0\r\n        if (totalWorkSeconds <= 0) {\r\n            return 0;\r\n        }\r\n\r\n        // Base score: ratio of work time to total time\r\n        const totalTime = totalWorkSeconds + totalPauseSeconds;\r\n        const workRatio = totalWorkSeconds / totalTime;\r\n\r\n        // Penalty for frequent pauses (each pause reduces score slightly)\r\n        // Each pause reduces by 2% (max 20% penalty)\r\n        const pausePenalty = Math.min(pauseCount * 0.02, 0.2);\r\n\r\n        // Calculate final score (0-1 range)\r\n        let focusScore = workRatio - pausePenalty;\r\n\r\n        // Ensure score is between 0 and 1\r\n        focusScore = Math.max(0, Math.min(1, focusScore));\r\n\r\n        return focusScore;\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport interface AIProfileProps extends EntityProps {\r\n    userId: string;\r\n    peakHours: Record<number, number>; // hour (0-23) -> productivity score (0-1)\r\n    peakDays: Record<number, number>; // day of week (0-6) -> productivity score (0-1)\r\n    avgTaskDuration: number; // in minutes\r\n    completionRate: number; // 0-1 (percentage)\r\n    categoryPreferences: Record<string, number>; // category -> preference score (0-1)\r\n    updatedAt?: Date;\r\n}\r\n\r\nexport class AIProfile extends Entity<AIProfileProps> {\r\n    constructor(props: AIProfileProps) {\r\n        super({\r\n            ...props,\r\n            peakHours: props.peakHours ?? {},\r\n            peakDays: props.peakDays ?? {},\r\n            avgTaskDuration: props.avgTaskDuration ?? 30,\r\n            completionRate: props.completionRate ?? 0.7,\r\n            categoryPreferences: props.categoryPreferences ?? {},\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(userId: string): AIProfile {\r\n        return new AIProfile({\r\n            userId,\r\n            peakHours: {},\r\n            peakDays: {},\r\n            avgTaskDuration: 30,\r\n            completionRate: 0.7,\r\n            categoryPreferences: {},\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update productivity score for a specific hour of the day (0-23)\r\n     * Uses exponential moving average to smooth out variations\r\n     */\r\n    updatePeakHour(hour: number, score: number): AIProfile {\r\n        if (hour < 0 || hour > 23) {\r\n            throw new Error(\"Hour must be between 0 and 23\");\r\n        }\r\n        if (score < 0 || score > 1) {\r\n            throw new Error(\"Score must be between 0 and 1\");\r\n        }\r\n\r\n        const currentScore = this.props.peakHours[hour] ?? 0.5;\r\n        // Exponential moving average: 70% old value, 30% new value\r\n        const newScore = currentScore * 0.7 + score * 0.3;\r\n\r\n        return this.clone({\r\n            peakHours: {\r\n                ...this.props.peakHours,\r\n                [hour]: newScore,\r\n            },\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update productivity score for a specific day of the week (0=Sunday, 6=Saturday)\r\n     * Uses exponential moving average to smooth out variations\r\n     */\r\n    updatePeakDay(dayOfWeek: number, score: number): AIProfile {\r\n        if (dayOfWeek < 0 || dayOfWeek > 6) {\r\n            throw new Error(\"Day of week must be between 0 and 6\");\r\n        }\r\n        if (score < 0 || score > 1) {\r\n            throw new Error(\"Score must be between 0 and 1\");\r\n        }\r\n\r\n        const currentScore = this.props.peakDays[dayOfWeek] ?? 0.5;\r\n        // Exponential moving average: 70% old value, 30% new value\r\n        const newScore = currentScore * 0.7 + score * 0.3;\r\n\r\n        return this.clone({\r\n            peakDays: {\r\n                ...this.props.peakDays,\r\n                [dayOfWeek]: newScore,\r\n            },\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Recalculate average task duration based on recent completed tasks\r\n     * Uses exponential moving average to give more weight to recent data\r\n     */\r\n    recalculateAvgDuration(recentDurations: number[]): AIProfile {\r\n        if (recentDurations.length === 0) {\r\n            return this;\r\n        }\r\n\r\n        const avgRecent = recentDurations.reduce((sum, d) => sum + d, 0) / recentDurations.length;\r\n        // Exponential moving average: 60% old value, 40% new value\r\n        const newAvg = this.props.avgTaskDuration * 0.6 + avgRecent * 0.4;\r\n\r\n        return this.clone({\r\n            avgTaskDuration: Math.round(newAvg),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update completion rate based on completed and total tasks\r\n     * Uses exponential moving average\r\n     */\r\n    updateCompletionRate(completed: number, total: number): AIProfile {\r\n        if (total === 0) {\r\n            return this;\r\n        }\r\n        if (completed > total) {\r\n            throw new Error(\"Completed tasks cannot exceed total tasks\");\r\n        }\r\n\r\n        const newRate = completed / total;\r\n        // Exponential moving average: 80% old value, 20% new value\r\n        const updatedRate = this.props.completionRate * 0.8 + newRate * 0.2;\r\n\r\n        return this.clone({\r\n            completionRate: Math.max(0, Math.min(1, updatedRate)),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update preference score for a category\r\n     * Higher score means user works better/prefers this category\r\n     */\r\n    updateCategoryPreference(category: string, score: number): AIProfile {\r\n        if (score < 0 || score > 1) {\r\n            throw new Error(\"Score must be between 0 and 1\");\r\n        }\r\n\r\n        const currentScore = this.props.categoryPreferences[category] ?? 0.5;\r\n        // Exponential moving average: 70% old value, 30% new value\r\n        const newScore = currentScore * 0.7 + score * 0.3;\r\n\r\n        return this.clone({\r\n            categoryPreferences: {\r\n                ...this.props.categoryPreferences,\r\n                [category]: newScore,\r\n            },\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the top N most productive hours\r\n     */\r\n    getTopPeakHours(limit: number = 3): number[] {\r\n        return Object.entries(this.props.peakHours)\r\n            .sort(([, a], [, b]) => b - a)\r\n            .slice(0, limit)\r\n            .map(([hour]) => parseInt(hour));\r\n    }\r\n\r\n    /**\r\n     * Get the top N most productive days\r\n     */\r\n    getTopPeakDays(limit: number = 3): number[] {\r\n        return Object.entries(this.props.peakDays)\r\n            .sort(([, a], [, b]) => b - a)\r\n            .slice(0, limit)\r\n            .map(([day]) => parseInt(day));\r\n    }\r\n\r\n    /**\r\n     * Get the top N preferred categories\r\n     */\r\n    getTopCategories(limit: number = 5): string[] {\r\n        return Object.entries(this.props.categoryPreferences)\r\n            .sort(([, a], [, b]) => b - a)\r\n            .slice(0, limit)\r\n            .map(([category]) => category);\r\n    }\r\n\r\n    /**\r\n     * Check if a specific hour is a peak productivity hour (score > 0.7)\r\n     */\r\n    isPeakHour(hour: number): boolean {\r\n        return (this.props.peakHours[hour] ?? 0) > 0.7;\r\n    }\r\n\r\n    /**\r\n     * Check if a specific day is a peak productivity day (score > 0.7)\r\n     */\r\n    isPeakDay(dayOfWeek: number): boolean {\r\n        return (this.props.peakDays[dayOfWeek] ?? 0) > 0.7;\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type ReportScope =\r\n  | \"TASK_COMPLETION\"\r\n  | \"PROJECT_SUMMARY\"\r\n  | \"PERSONAL_ANALYSIS\"\r\n  | \"WEEKLY_SCHEDULED\"\r\n  | \"MONTHLY_SCHEDULED\";\r\n\r\nexport interface MetricsSnapshot {\r\n  tasksCreated?: number;\r\n  tasksCompleted?: number;\r\n  minutesWorked?: number;\r\n  pomodorosCompleted?: number;\r\n  focusScore?: number;\r\n  sessionsCount?: number;\r\n}\r\n\r\nexport interface ProductivityReportProps extends EntityProps {\r\n  userId: string;\r\n  taskId?: string;\r\n  projectId?: string;\r\n  scope: ReportScope;\r\n\r\n  // AI-generated insights\r\n  summary: string;\r\n  strengths: string[];\r\n  weaknesses: string[];\r\n  recommendations: string[];\r\n  patterns: string[];\r\n  productivityScore: number; // 0-100\r\n\r\n  // Historical snapshot\r\n  metricsSnapshot: MetricsSnapshot;\r\n\r\n  // Metadata\r\n  generatedAt?: Date;\r\n  aiModel?: string;\r\n}\r\n\r\nexport class ProductivityReport extends Entity<ProductivityReportProps> {\r\n  constructor(props: ProductivityReportProps) {\r\n    super({\r\n      ...props,\r\n      strengths: props.strengths ?? [],\r\n      weaknesses: props.weaknesses ?? [],\r\n      recommendations: props.recommendations ?? [],\r\n      patterns: props.patterns ?? [],\r\n      productivityScore: Math.min(100, Math.max(0, props.productivityScore ?? 0)),\r\n      metricsSnapshot: props.metricsSnapshot ?? {},\r\n      generatedAt: props.generatedAt ?? new Date(),\r\n      aiModel: props.aiModel ?? \"gemini-2.0-flash-exp\",\r\n    });\r\n\r\n    // Validate productivityScore range\r\n    if (props.productivityScore < 0 || props.productivityScore > 100) {\r\n      throw new Error(\"Productivity score must be between 0 and 100\");\r\n    }\r\n\r\n    // Validate summary is not empty\r\n    if (!props.summary || props.summary.trim().length === 0) {\r\n      throw new Error(\"Summary cannot be empty\");\r\n    }\r\n  }\r\n\r\n  static create(props: Omit<ProductivityReportProps, \"id\" | \"generatedAt\" | \"aiModel\">): ProductivityReport {\r\n    return new ProductivityReport({\r\n      ...props,\r\n      generatedAt: new Date(),\r\n      aiModel: \"gemini-2.0-flash-exp\",\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get a human-readable label for the scope\r\n   */\r\n  getScopeLabel(): string {\r\n    switch (this.props.scope) {\r\n      case \"TASK_COMPLETION\":\r\n        return \"Task Completion Report\";\r\n      case \"PROJECT_SUMMARY\":\r\n        return \"Project Summary\";\r\n      case \"PERSONAL_ANALYSIS\":\r\n        return \"Personal Analysis\";\r\n      case \"WEEKLY_SCHEDULED\":\r\n        return \"Weekly Report\";\r\n      case \"MONTHLY_SCHEDULED\":\r\n        return \"Monthly Report\";\r\n      default:\r\n        return \"Report\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a color for the productivity score\r\n   */\r\n  getScoreColor(): \"green\" | \"yellow\" | \"red\" {\r\n    if (this.props.productivityScore >= 80) return \"green\";\r\n    if (this.props.productivityScore >= 60) return \"yellow\";\r\n    return \"red\";\r\n  }\r\n\r\n  /**\r\n   * Check if this is a good productivity score\r\n   */\r\n  isGoodScore(): boolean {\r\n    return this.props.productivityScore >= 70;\r\n  }\r\n\r\n  /**\r\n   * Get a summary of the metrics snapshot\r\n   */\r\n  getMetricsSummary(): string {\r\n    const m = this.props.metricsSnapshot;\r\n    const parts: string[] = [];\r\n\r\n    if (m.tasksCompleted !== undefined) {\r\n      parts.push(`${m.tasksCompleted} tasks completed`);\r\n    }\r\n    if (m.minutesWorked !== undefined) {\r\n      const hours = Math.floor(m.minutesWorked / 60);\r\n      const mins = m.minutesWorked % 60;\r\n      if (hours > 0) {\r\n        parts.push(`${hours}h ${mins}m worked`);\r\n      } else {\r\n        parts.push(`${mins}m worked`);\r\n      }\r\n    }\r\n    if (m.pomodorosCompleted !== undefined && m.pomodorosCompleted > 0) {\r\n      parts.push(`${m.pomodorosCompleted} pomodoros`);\r\n    }\r\n\r\n    return parts.join(\", \") || \"No metrics available\";\r\n  }\r\n\r\n  /**\r\n   * Check if this report has actionable recommendations\r\n   */\r\n  hasRecommendations(): boolean {\r\n    return this.props.recommendations.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Get the top N recommendations\r\n   */\r\n  getTopRecommendations(limit: number = 3): string[] {\r\n    return this.props.recommendations.slice(0, limit);\r\n  }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { TimeSession } from \"../../timer/model/time-session.entity\";\r\nimport { AIProfile } from \"../model/ai-profile.entity\";\r\nimport { AIProfileRepository } from \"../provider/ai-profile.repository\";\r\n\r\nexport interface LearnFromSessionInput {\r\n    session: TimeSession;\r\n}\r\n\r\nexport class LearnFromSessionUseCase implements UseCase<LearnFromSessionInput, AIProfile> {\r\n    constructor(private readonly aiProfileRepository: AIProfileRepository) {}\r\n\r\n    async execute(input: LearnFromSessionInput): Promise<AIProfile> {\r\n        const { session } = input;\r\n\r\n        // Only learn from completed WORK or CONTINUOUS sessions\r\n        if (!session.props.wasCompleted) {\r\n            throw new Error(\"Can only learn from completed sessions\");\r\n        }\r\n        if (session.props.type !== \"WORK\" && session.props.type !== \"CONTINUOUS\") {\r\n            throw new Error(\"Can only learn from WORK or CONTINUOUS sessions\");\r\n        }\r\n\r\n        // Get or create AI profile for the user\r\n        const profile = await this.aiProfileRepository.findOrCreate(session.props.userId);\r\n\r\n        // Extract temporal information\r\n        const startedAt = session.props.startedAt;\r\n        const hour = startedAt.getHours(); // 0-23\r\n        const dayOfWeek = startedAt.getDay(); // 0-6 (0=Sunday)\r\n\r\n        // Calculate productivity score based on:\r\n        // 1. Focus score (fewer pauses = higher score)\r\n        // 2. Completion status (completed = bonus)\r\n        // 3. Duration (longer focused time = better)\r\n        const productivityScore = this.calculateProductivityScore(session);\r\n\r\n        // Update peak hours and peak days\r\n        let updatedProfile = profile\r\n            .updatePeakHour(hour, productivityScore)\r\n            .updatePeakDay(dayOfWeek, productivityScore);\r\n\r\n        // Update average task duration if this was a task-based session\r\n        if (session.props.taskId && session.props.duration) {\r\n            // For now, we'll just use the current duration\r\n            // In a real scenario, we'd query recent task durations\r\n            updatedProfile = updatedProfile.recalculateAvgDuration([session.props.duration]);\r\n        }\r\n\r\n        // Save the updated profile\r\n        return await this.aiProfileRepository.update(updatedProfile);\r\n    }\r\n\r\n    /**\r\n     * Calculate productivity score based on session characteristics\r\n     * Returns a value between 0 and 1\r\n     */\r\n    private calculateProductivityScore(session: TimeSession): number {\r\n        const duration = session.props.duration ?? 0; // in minutes\r\n        const pauseCount = session.props.pauseCount ?? 0;\r\n        const totalPauseTime = session.props.totalPauseTime ?? 0; // in seconds\r\n        const wasCompleted = session.props.wasCompleted;\r\n\r\n        // Base score starts at 0.5\r\n        let score = 0.5;\r\n\r\n        // Bonus for completion (up to +0.2)\r\n        if (wasCompleted) {\r\n            score += 0.2;\r\n        }\r\n\r\n        // Duration factor (longer focused work = better, up to +0.2)\r\n        // Sessions of 25-50 minutes are ideal\r\n        if (duration >= 25 && duration <= 50) {\r\n            score += 0.2;\r\n        } else if (duration >= 10 && duration < 25) {\r\n            score += 0.1;\r\n        } else if (duration > 50) {\r\n            // Very long sessions might indicate less focus\r\n            score += 0.1;\r\n        }\r\n\r\n        // Pause penalty (fewer pauses = better)\r\n        // Deduct 0.05 per pause, but cap at -0.3\r\n        const pausePenalty = Math.min(pauseCount * 0.05, 0.3);\r\n        score -= pausePenalty;\r\n\r\n        // Calculate focus score (work time vs pause time)\r\n        if (duration > 0) {\r\n            const totalSessionTime = (duration * 60) + totalPauseTime; // convert to seconds\r\n            const workTimeRatio = (duration * 60) / totalSessionTime;\r\n\r\n            // If work time ratio is high, add bonus (up to +0.2)\r\n            if (workTimeRatio >= 0.9) {\r\n                score += 0.2;\r\n            } else if (workTimeRatio >= 0.8) {\r\n                score += 0.15;\r\n            } else if (workTimeRatio >= 0.7) {\r\n                score += 0.1;\r\n            } else if (workTimeRatio < 0.5) {\r\n                // Penalize if more pause time than work time\r\n                score -= 0.2;\r\n            }\r\n        }\r\n\r\n        // Ensure score is between 0 and 1\r\n        return Math.max(0, Math.min(1, score));\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { AIProfile } from \"../model/ai-profile.entity\";\r\nimport { AIProfileRepository } from \"../provider/ai-profile.repository\";\r\n\r\nexport interface GetOptimalScheduleInput {\r\n    userId: string;\r\n    topN?: number; // Number of hours to return (default: 5)\r\n}\r\n\r\nexport interface OptimalScheduleOutput {\r\n    peakHours: Array<{\r\n        hour: number; // 0-23\r\n        score: number; // 0-1\r\n        label: string; // e.g., \"9:00 AM\"\r\n    }>;\r\n    peakDays: Array<{\r\n        day: number; // 0-6 (0=Sunday)\r\n        score: number; // 0-1\r\n        label: string; // e.g., \"Monday\"\r\n    }>;\r\n    recommendation: string;\r\n}\r\n\r\nconst DAY_NAMES = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\n\r\nexport class GetOptimalScheduleUseCase implements UseCase<GetOptimalScheduleInput, OptimalScheduleOutput> {\r\n    constructor(private readonly aiProfileRepository: AIProfileRepository) {}\r\n\r\n    async execute(input: GetOptimalScheduleInput): Promise<OptimalScheduleOutput> {\r\n        const { userId, topN = 5 } = input;\r\n\r\n        // Get AI profile for the user\r\n        const profile = await this.aiProfileRepository.findByUserId(userId);\r\n\r\n        if (!profile) {\r\n            // Return default recommendation if no profile exists yet\r\n            return {\r\n                peakHours: [],\r\n                peakDays: [],\r\n                recommendation: \"Start tracking your work sessions to get personalized productivity insights!\",\r\n            };\r\n        }\r\n\r\n        // Get top peak hours\r\n        const topPeakHours = this.getTopPeakHours(profile, topN);\r\n\r\n        // Get top peak days\r\n        const topPeakDays = this.getTopPeakDays(profile, 3); // Always show top 3 days\r\n\r\n        // Generate recommendation\r\n        const recommendation = this.generateRecommendation(profile, topPeakHours, topPeakDays);\r\n\r\n        return {\r\n            peakHours: topPeakHours,\r\n            peakDays: topPeakDays,\r\n            recommendation,\r\n        };\r\n    }\r\n\r\n    private getTopPeakHours(profile: AIProfile, limit: number): Array<{ hour: number; score: number; label: string }> {\r\n        const peakHours = profile.props.peakHours;\r\n\r\n        return Object.entries(peakHours)\r\n            .map(([hour, score]) => ({\r\n                hour: parseInt(hour),\r\n                score,\r\n                label: this.formatHour(parseInt(hour)),\r\n            }))\r\n            .sort((a, b) => b.score - a.score)\r\n            .slice(0, limit);\r\n    }\r\n\r\n    private getTopPeakDays(profile: AIProfile, limit: number): Array<{ day: number; score: number; label: string }> {\r\n        const peakDays = profile.props.peakDays;\r\n\r\n        return Object.entries(peakDays)\r\n            .map(([day, score]) => {\r\n                const dayNum = parseInt(day);\r\n                return {\r\n                    day: dayNum,\r\n                    score,\r\n                    label: DAY_NAMES[dayNum] || \"Unknown\",\r\n                };\r\n            })\r\n            .sort((a, b) => b.score - a.score)\r\n            .slice(0, limit);\r\n    }\r\n\r\n    private formatHour(hour: number): string {\r\n        const period = hour >= 12 ? \"PM\" : \"AM\";\r\n        const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;\r\n        return `${displayHour}:00 ${period}`;\r\n    }\r\n\r\n    private generateRecommendation(\r\n        profile: AIProfile,\r\n        topHours: Array<{ hour: number; score: number; label: string }>,\r\n        topDays: Array<{ day: number; score: number; label: string }>\r\n    ): string {\r\n        if (topHours.length === 0 && topDays.length === 0) {\r\n            return \"Keep tracking your work sessions to discover your peak productivity times!\";\r\n        }\r\n\r\n        const parts: string[] = [];\r\n\r\n        // Hours recommendation\r\n        if (topHours.length > 0) {\r\n            const bestHour = topHours[0];\r\n            if (bestHour && bestHour.score > 0.7) {\r\n                const hourList = topHours.slice(0, 3).map((h) => h.label).join(\", \");\r\n                parts.push(`Your peak productivity hours are ${hourList}.`);\r\n            } else if (bestHour && bestHour.score > 0.5) {\r\n                parts.push(`You work well during ${bestHour.label}.`);\r\n            }\r\n        }\r\n\r\n        // Days recommendation\r\n        if (topDays.length > 0) {\r\n            const bestDay = topDays[0];\r\n            if (bestDay && bestDay.score > 0.7) {\r\n                const dayList = topDays.slice(0, 2).map((d) => d.label).join(\" and \");\r\n                parts.push(`You're most productive on ${dayList}.`);\r\n            }\r\n        }\r\n\r\n        // Task duration insight\r\n        const avgDuration = profile.props.avgTaskDuration;\r\n        if (avgDuration > 0) {\r\n            parts.push(`Your average focused work session is ${avgDuration} minutes.`);\r\n        }\r\n\r\n        // Completion rate insight\r\n        const completionRate = profile.props.completionRate;\r\n        if (completionRate >= 0.8) {\r\n            parts.push(`You have an excellent task completion rate of ${Math.round(completionRate * 100)}%!`);\r\n        } else if (completionRate < 0.5) {\r\n            parts.push(`Try breaking tasks into smaller chunks to improve your ${Math.round(completionRate * 100)}% completion rate.`);\r\n        }\r\n\r\n        return parts.join(\" \") || \"Keep working to build your productivity profile!\";\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { AIProfile } from \"../model/ai-profile.entity\";\r\nimport { AIProfileRepository } from \"../provider/ai-profile.repository\";\r\n\r\nexport interface PredictTaskDurationInput {\r\n    userId: string;\r\n    taskTitle?: string;\r\n    taskDescription?: string;\r\n    category?: string;\r\n    priority?: \"LOW\" | \"MEDIUM\" | \"HIGH\" | \"URGENT\";\r\n}\r\n\r\nexport interface PredictTaskDurationOutput {\r\n    estimatedMinutes: number;\r\n    confidence: \"LOW\" | \"MEDIUM\" | \"HIGH\";\r\n    reasoning: string;\r\n}\r\n\r\nexport class PredictTaskDurationUseCase implements UseCase<PredictTaskDurationInput, PredictTaskDurationOutput> {\r\n    constructor(private readonly aiProfileRepository: AIProfileRepository) {}\r\n\r\n    async execute(input: PredictTaskDurationInput): Promise<PredictTaskDurationOutput> {\r\n        const { userId, taskTitle, taskDescription, category, priority } = input;\r\n\r\n        // Get AI profile for the user\r\n        const profile = await this.aiProfileRepository.findByUserId(userId);\r\n\r\n        if (!profile) {\r\n            // Return default estimate if no profile exists\r\n            return {\r\n                estimatedMinutes: 30,\r\n                confidence: \"LOW\",\r\n                reasoning: \"Using default estimate of 30 minutes. Complete more tasks to get personalized predictions!\",\r\n            };\r\n        }\r\n\r\n        // Base estimate from user's average\r\n        let estimatedMinutes = profile.props.avgTaskDuration;\r\n        let confidence: \"LOW\" | \"MEDIUM\" | \"HIGH\" = \"MEDIUM\";\r\n        const reasoningParts: string[] = [];\r\n\r\n        // Adjust based on category preference\r\n        if (category && profile.props.categoryPreferences[category]) {\r\n            const categoryScore = profile.props.categoryPreferences[category];\r\n\r\n            if (categoryScore > 0.7) {\r\n                // User is efficient in this category, reduce estimate by 15%\r\n                estimatedMinutes *= 0.85;\r\n                reasoningParts.push(`You're efficient with ${category} tasks (-15%)`);\r\n                confidence = \"HIGH\";\r\n            } else if (categoryScore < 0.4) {\r\n                // User struggles with this category, increase estimate by 20%\r\n                estimatedMinutes *= 1.2;\r\n                reasoningParts.push(`${category} tasks typically take you longer (+20%)`);\r\n                confidence = \"MEDIUM\";\r\n            }\r\n        }\r\n\r\n        // Adjust based on priority\r\n        if (priority) {\r\n            switch (priority) {\r\n                case \"URGENT\":\r\n                    // Urgent tasks often take less time due to focus\r\n                    estimatedMinutes *= 0.9;\r\n                    reasoningParts.push(\"Urgent priority tends to increase focus (-10%)\");\r\n                    break;\r\n                case \"HIGH\":\r\n                    // High priority tasks might be more complex\r\n                    estimatedMinutes *= 1.1;\r\n                    reasoningParts.push(\"High priority suggests complexity (+10%)\");\r\n                    break;\r\n                case \"LOW\":\r\n                    // Low priority tasks might be simpler\r\n                    estimatedMinutes *= 0.85;\r\n                    reasoningParts.push(\"Low priority typically means simpler tasks (-15%)\");\r\n                    break;\r\n            }\r\n        }\r\n\r\n        // Analyze task title/description for complexity indicators\r\n        const text = `${taskTitle || \"\"} ${taskDescription || \"\"}`.toLowerCase();\r\n\r\n        if (this.containsComplexityKeywords(text, [\"refactor\", \"redesign\", \"architecture\", \"migration\"])) {\r\n            estimatedMinutes *= 1.5;\r\n            reasoningParts.push(\"Complex task keywords detected (+50%)\");\r\n        } else if (this.containsComplexityKeywords(text, [\"fix\", \"bug\", \"issue\", \"debug\"])) {\r\n            estimatedMinutes *= 1.2;\r\n            reasoningParts.push(\"Debugging tasks can be unpredictable (+20%)\");\r\n        } else if (this.containsComplexityKeywords(text, [\"simple\", \"quick\", \"minor\", \"small\"])) {\r\n            estimatedMinutes *= 0.75;\r\n            reasoningParts.push(\"Simple task indicators found (-25%)\");\r\n        }\r\n\r\n        // Round to nearest 5 minutes\r\n        estimatedMinutes = Math.round(estimatedMinutes / 5) * 5;\r\n\r\n        // Ensure minimum of 10 minutes\r\n        estimatedMinutes = Math.max(10, estimatedMinutes);\r\n\r\n        // Build reasoning\r\n        let reasoning = `Based on your average of ${profile.props.avgTaskDuration} minutes`;\r\n        if (reasoningParts.length > 0) {\r\n            reasoning += `. ${reasoningParts.join(\". \")}.`;\r\n        } else {\r\n            reasoning += \".\";\r\n        }\r\n\r\n        // Adjust confidence based on data availability\r\n        if (!category && !priority && !taskTitle && !taskDescription) {\r\n            confidence = \"LOW\";\r\n        }\r\n\r\n        return {\r\n            estimatedMinutes,\r\n            confidence,\r\n            reasoning,\r\n        };\r\n    }\r\n\r\n    private containsComplexityKeywords(text: string, keywords: string[]): boolean {\r\n        return keywords.some((keyword) => text.includes(keyword));\r\n    }\r\n}\r\n","import { UseCase } from \"../../shared/use-case\";\r\nimport { ProductivityReport } from \"../model/productivity-report.entity\";\r\nimport { ProductivityReportRepository } from \"../provider/productivity-report.repository\";\r\nimport type { AnalyticsRepository } from \"../../analytics/provider/analytics.repository\";\r\nimport type { TimerRepository } from \"../../timer/provider/timer.repository\";\r\nimport type { AIProfileRepository } from \"../provider/ai-profile.repository\";\r\nimport type { DailyMetrics } from \"../../analytics/model/daily-metrics.entity\";\r\nimport type { TimeSession } from \"../../timer/model/time-session.entity\";\r\n\r\nexport interface GenerateWeeklyReportInput {\r\n  userId: string;\r\n  weekStart?: Date; // If not provided, use current week\r\n}\r\n\r\nexport interface GenerateWeeklyReportOutput {\r\n  report: ProductivityReport;\r\n  isNew: boolean; // true if report was newly generated, false if existing\r\n}\r\n\r\n/**\r\n * Data needed from external AI service\r\n */\r\nexport interface WeeklyReportData {\r\n  summary: string;\r\n  strengths: string[];\r\n  weaknesses: string[];\r\n  recommendations: string[];\r\n  patterns: string[];\r\n  productivityScore: number;\r\n}\r\n\r\nexport interface WeeklyReportContext {\r\n  userId: string;\r\n  scope: string;\r\n  metricsSnapshot: {\r\n    tasksCreated: number;\r\n    tasksCompleted: number;\r\n    minutesWorked: number;\r\n    pomodorosCompleted: number;\r\n    focusScore: number;\r\n    sessionsCount: number;\r\n  };\r\n  sessions: Array<{\r\n    startedAt: Date;\r\n    endedAt?: Date;\r\n    duration?: number;\r\n    taskId?: string;\r\n    userId: string;\r\n    type: string;\r\n    wasCompleted: boolean;\r\n  }>;\r\n  profile?: {\r\n    userId: string;\r\n    peakHours: Record<number, number>;\r\n    peakDays: Record<number, number>;\r\n    avgTaskDuration: number;\r\n    completionRate: number;\r\n    categoryPreferences: Record<string, number>;\r\n  };\r\n}\r\n\r\nexport class GenerateWeeklyReportUseCase implements UseCase<\r\n  GenerateWeeklyReportInput,\r\n  GenerateWeeklyReportOutput\r\n> {\r\n  constructor(\r\n    private readonly reportRepository: ProductivityReportRepository,\r\n    private readonly analyticsRepository: AnalyticsRepository,\r\n    private readonly timerRepository: TimerRepository,\r\n    private readonly aiProfileRepository: AIProfileRepository,\r\n    private readonly generateReportData: (\r\n      context: WeeklyReportContext,\r\n    ) => Promise<WeeklyReportData>,\r\n  ) {}\r\n\r\n  async execute(\r\n    input: GenerateWeeklyReportInput,\r\n  ): Promise<GenerateWeeklyReportOutput> {\r\n    const { userId, weekStart } = input;\r\n\r\n    // Calculate week range\r\n    const startDate = weekStart || this.getWeekStart(new Date());\r\n    const endDate = new Date(startDate);\r\n    endDate.setDate(endDate.getDate() + 6);\r\n\r\n    // Check if report already exists for this week\r\n    const existing = await this.reportRepository.findLatestByScope(\r\n      userId,\r\n      \"WEEKLY_SCHEDULED\",\r\n    );\r\n\r\n    if (existing && this.isSameWeek(existing.props.generatedAt!, startDate)) {\r\n      return { report: existing, isNew: false };\r\n    }\r\n\r\n    // Gather data for report generation\r\n    const [dailyMetrics, sessions, profile] = await Promise.all([\r\n      this.analyticsRepository.getRange(userId, startDate, endDate),\r\n      this.timerRepository.findByUserIdAndDateRange(userId, startDate, endDate),\r\n      this.aiProfileRepository.findByUserId(userId),\r\n    ]);\r\n\r\n    // Calculate metrics snapshot\r\n    const metricsSnapshot = {\r\n      tasksCreated: dailyMetrics.reduce(\r\n        (sum: number, m: DailyMetrics) => sum + m.props.tasksCreated,\r\n        0,\r\n      ),\r\n      tasksCompleted: dailyMetrics.reduce(\r\n        (sum: number, m: DailyMetrics) => sum + m.props.tasksCompleted,\r\n        0,\r\n      ),\r\n      minutesWorked: dailyMetrics.reduce(\r\n        (sum: number, m: DailyMetrics) => sum + m.props.minutesWorked,\r\n        0,\r\n      ),\r\n      pomodorosCompleted: dailyMetrics.reduce(\r\n        (sum: number, m: DailyMetrics) => sum + m.props.pomodorosCompleted,\r\n        0,\r\n      ),\r\n      focusScore:\r\n        dailyMetrics.length > 0\r\n          ? dailyMetrics.reduce(\r\n              (sum: number, m: DailyMetrics) => sum + (m.props.focusScore ?? 0),\r\n              0,\r\n            ) / dailyMetrics.length\r\n          : 0,\r\n      sessionsCount: sessions.length,\r\n    };\r\n\r\n    // Generate AI insights\r\n    const reportData = await this.generateReportData({\r\n      userId,\r\n      scope: \"WEEKLY_SCHEDULED\",\r\n      metricsSnapshot,\r\n      sessions: sessions.map((s: TimeSession) => s.props),\r\n      profile: profile?.props,\r\n    });\r\n\r\n    // Create and save report\r\n    const report = ProductivityReport.create({\r\n      userId,\r\n      scope: \"WEEKLY_SCHEDULED\",\r\n      summary: reportData.summary,\r\n      strengths: reportData.strengths,\r\n      weaknesses: reportData.weaknesses,\r\n      recommendations: reportData.recommendations,\r\n      patterns: reportData.patterns,\r\n      productivityScore: reportData.productivityScore,\r\n      metricsSnapshot,\r\n    });\r\n\r\n    const savedReport = await this.reportRepository.save(report);\r\n\r\n    return { report: savedReport, isNew: true };\r\n  }\r\n\r\n  /**\r\n   * Get the start of the week (Monday) for a given date\r\n   */\r\n  private getWeekStart(date: Date): Date {\r\n    const d = new Date(date);\r\n    const day = d.getDay();\r\n    const diff = d.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is sunday\r\n    return new Date(d.setDate(diff));\r\n  }\r\n\r\n  /**\r\n   * Check if two dates are in the same week\r\n   */\r\n  private isSameWeek(date1: Date, date2: Date): boolean {\r\n    const start1 = this.getWeekStart(date1);\r\n    const start2 = this.getWeekStart(date2);\r\n    return start1.getTime() === start2.getTime();\r\n  }\r\n}\r\n","export interface AIChatContext {\r\n  userId?: string;\r\n  workspaceId?: string;\r\n  projectId?: string;\r\n  taskId?: string;\r\n  conversationHistory?: Array<{\r\n    role: \"user\" | \"assistant\";\r\n    content: string;\r\n    timestamp: Date;\r\n  }>;\r\n}\r\n\r\nexport interface AIService {\r\n  suggestTaskDetails(input: string): Promise<{\r\n    title: string;\r\n    description?: string;\r\n    dueDate?: Date;\r\n    priority?: \"LOW\" | \"MEDIUM\" | \"HIGH\" | \"URGENT\";\r\n  }>;\r\n\r\n  chat(message: string, context?: AIChatContext): Promise<string>;\r\n}\r\n\r\nexport class MockAIService implements AIService {\r\n  async suggestTaskDetails(input: string) {\r\n    // Simulate AI processing\r\n    await new Promise((resolve) => setTimeout(resolve, 1000));\r\n\r\n    const lowerInput = input.toLowerCase();\r\n    let priority: \"LOW\" | \"MEDIUM\" | \"HIGH\" | \"URGENT\" = \"MEDIUM\";\r\n\r\n    if (lowerInput.includes(\"urgente\") || lowerInput.includes(\"asap\")) {\r\n      priority = \"URGENT\";\r\n    } else if (lowerInput.includes(\"importante\")) {\r\n      priority = \"HIGH\";\r\n    }\r\n\r\n    let dueDate = undefined;\r\n    if (lowerInput.includes(\"mañana\")) {\r\n      const tomorrow = new Date();\r\n      tomorrow.setDate(tomorrow.getDate() + 1);\r\n      dueDate = tomorrow;\r\n    } else if (lowerInput.includes(\"hoy\")) {\r\n      dueDate = new Date();\r\n    }\r\n\r\n    return {\r\n      title: input,\r\n      description: \"Generated by Ordo AI based on your input.\",\r\n      priority,\r\n      dueDate,\r\n    };\r\n  }\r\n\r\n  async chat(message: string, context?: AIChatContext) {\r\n    await new Promise((resolve) => setTimeout(resolve, 1000));\r\n    return `I am Ordo AI. You said: \"${message}\". I am currently in development mode.`;\r\n  }\r\n}\r\n\r\nexport const aiService = new MockAIService();\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type HabitFrequency = \"DAILY\" | \"WEEKLY\" | \"SPECIFIC_DAYS\" | \"MONTHLY\";\r\nexport type TimeOfDay = \"MORNING\" | \"AFTERNOON\" | \"EVENING\" | \"ANYTIME\";\r\n\r\nexport interface HabitCompletionProps extends EntityProps {\r\n    habitId: string;\r\n    completedAt: Date;\r\n    completedDate: Date;\r\n    note?: string;\r\n    value?: number;\r\n}\r\n\r\nexport interface HabitProps extends EntityProps {\r\n    name: string;\r\n    description?: string;\r\n    icon?: string;\r\n    color: string;\r\n    userId: string;\r\n    workspaceId?: string;\r\n\r\n    // Schedule\r\n    frequency: HabitFrequency;\r\n    targetDaysOfWeek: number[];\r\n    targetCount: number;\r\n    preferredTime?: string;\r\n    timeOfDay?: TimeOfDay;\r\n\r\n    // Gamification\r\n    currentStreak: number;\r\n    longestStreak: number;\r\n    totalCompletions: number;\r\n\r\n    // State\r\n    isActive: boolean;\r\n    isPaused: boolean;\r\n    pausedAt?: Date;\r\n    archivedAt?: Date;\r\n\r\n    // Completions\r\n    completions?: HabitCompletionProps[];\r\n\r\n    // Timestamps\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nexport class Habit extends Entity<HabitProps> {\r\n    constructor(props: HabitProps) {\r\n        super({\r\n            ...props,\r\n            frequency: props.frequency ?? \"DAILY\",\r\n            targetDaysOfWeek: props.targetDaysOfWeek ?? [0, 1, 2, 3, 4, 5, 6],\r\n            targetCount: props.targetCount ?? 1,\r\n            color: props.color ?? \"#10B981\",\r\n            currentStreak: props.currentStreak ?? 0,\r\n            longestStreak: props.longestStreak ?? 0,\r\n            totalCompletions: props.totalCompletions ?? 0,\r\n            isActive: props.isActive ?? true,\r\n            isPaused: props.isPaused ?? false,\r\n            completions: props.completions ?? [],\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    static create(\r\n        props: Omit<\r\n            HabitProps,\r\n            | \"id\"\r\n            | \"currentStreak\"\r\n            | \"longestStreak\"\r\n            | \"totalCompletions\"\r\n            | \"createdAt\"\r\n            | \"updatedAt\"\r\n            | \"isActive\"\r\n            | \"isPaused\"\r\n        >\r\n    ): Habit {\r\n        return new Habit({\r\n            ...props,\r\n            currentStreak: 0,\r\n            longestStreak: 0,\r\n            totalCompletions: 0,\r\n            isActive: true,\r\n            isPaused: false,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Check if habit is scheduled for a given day of week (0=Sunday, 6=Saturday)\r\n     */\r\n    isScheduledForDay(dayOfWeek: number): boolean {\r\n        if (this.props.frequency === \"DAILY\") {\r\n            return true;\r\n        }\r\n        if (this.props.frequency === \"SPECIFIC_DAYS\") {\r\n            return this.props.targetDaysOfWeek.includes(dayOfWeek);\r\n        }\r\n        // For WEEKLY and MONTHLY, we need more context\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Mark habit as completed, updating streak\r\n     */\r\n    complete(isConsecutive: boolean = true): Habit {\r\n        const newTotal = this.props.totalCompletions + 1;\r\n        const newStreak = isConsecutive ? this.props.currentStreak + 1 : 1;\r\n        const newLongest = Math.max(this.props.longestStreak, newStreak);\r\n\r\n        return this.clone({\r\n            totalCompletions: newTotal,\r\n            currentStreak: newStreak,\r\n            longestStreak: newLongest,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Reset streak (when habit is missed)\r\n     */\r\n    resetStreak(): Habit {\r\n        return this.clone({\r\n            currentStreak: 0,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Pause habit tracking (vacation, illness, etc.)\r\n     */\r\n    pause(): Habit {\r\n        return this.clone({\r\n            isPaused: true,\r\n            pausedAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Resume habit tracking\r\n     */\r\n    resume(): Habit {\r\n        return this.clone({\r\n            isPaused: false,\r\n            pausedAt: undefined,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Archive habit (soft delete)\r\n     */\r\n    archive(): Habit {\r\n        return this.clone({\r\n            isActive: false,\r\n            archivedAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update habit properties\r\n     */\r\n    update(\r\n        props: Partial<\r\n            Omit<HabitProps, \"id\" | \"userId\" | \"createdAt\" | \"currentStreak\" | \"longestStreak\" | \"totalCompletions\">\r\n        >\r\n    ): Habit {\r\n        return this.clone({\r\n            ...props,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\n\nexport interface NoteProps extends EntityProps {\n  content: string;\n  workspaceId: string;\n  authorId: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  color: string;\n  createdAt?: Date;\n  updatedAt?: Date;\n}\n\nexport class Note extends Entity<NoteProps> {\n  constructor(props: NoteProps) {\n    super({\n      ...props,\n      x: props.x ?? 100,\n      y: props.y ?? 100,\n      width: props.width ?? 300,\n      height: props.height ?? 300,\n      color: props.color ?? \"#feff9c\",\n    });\n  }\n\n  static create(props: Omit<NoteProps, \"id\" | \"createdAt\" | \"updatedAt\">): Note {\n    return new Note({\n      ...props,\n      x: props.x ?? 100,\n      y: props.y ?? 100,\n      width: props.width ?? 300,\n      height: props.height ?? 300,\n      color: props.color ?? \"#feff9c\",\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    });\n  }\n\n  updateContent(content: string): Note {\n    return this.clone({\n      content,\n      updatedAt: new Date(),\n    });\n  }\n\n  updatePosition(x: number, y: number): Note {\n    return this.clone({\n      x,\n      y,\n      updatedAt: new Date(),\n    });\n  }\n\n  updateSize(width: number, height: number): Note {\n    return this.clone({\n      width,\n      height,\n      updatedAt: new Date(),\n    });\n  }\n\n  updateColor(color: string): Note {\n    return this.clone({\n      color,\n      updatedAt: new Date(),\n    });\n  }\n\n  update(props: Partial<Omit<NoteProps, \"id\" | \"workspaceId\" | \"authorId\">>): Note {\n    return this.clone({\n      ...props,\n      updatedAt: new Date(),\n    });\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Note } from \"../model/note.entity\";\nimport { NoteRepository } from \"../provider/note.repository\";\n\nexport interface CreateNoteInput {\n  content: string;\n  workspaceId: string;\n  authorId: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  color?: string;\n}\n\nexport class CreateNoteUseCase implements UseCase<CreateNoteInput, Note> {\n  constructor(private readonly repository: NoteRepository) {}\n\n  async execute(input: CreateNoteInput): Promise<Note> {\n    if (!input.content || input.content.trim().length === 0) {\n      throw new Error(\"Note content is required\");\n    }\n\n    if (!input.workspaceId) {\n      throw new Error(\"Workspace ID is required\");\n    }\n\n    const note = Note.create({\n      content: input.content,\n      workspaceId: input.workspaceId,\n      authorId: input.authorId,\n      x: input.x ?? 100,\n      y: input.y ?? 100,\n      width: input.width ?? 300,\n      height: input.height ?? 300,\n      color: input.color ?? \"#feff9c\",\n    });\n\n    await this.repository.save(note);\n\n    return note;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Note } from \"../model/note.entity\";\nimport { NoteRepository } from \"../provider/note.repository\";\n\nexport interface FindNoteInput {\n  id: string;\n  userId: string;\n}\n\nexport class FindNoteUseCase implements UseCase<FindNoteInput, Note> {\n  constructor(private readonly repository: NoteRepository) {}\n\n  async execute(input: FindNoteInput): Promise<Note> {\n    const note = await this.repository.findById(input.id);\n\n    if (!note) {\n      throw new Error(\"Note not found\");\n    }\n\n    // Check if user is the author\n    if (note.props.authorId !== input.userId) {\n      // If not author, verify user is a workspace member\n      const member = await this.repository.findWorkspaceMember(\n        note.props.workspaceId,\n        input.userId\n      );\n\n      if (!member) {\n        throw new Error(\"You do not have permission to access this note\");\n      }\n    }\n\n    return note;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Note } from \"../model/note.entity\";\nimport { NoteRepository } from \"../provider/note.repository\";\nimport { FindNoteUseCase } from \"./find-note.usecase\";\n\nexport interface UpdateNoteInput {\n  id: string;\n  userId: string;\n  content?: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  color?: string;\n}\n\nexport class UpdateNoteUseCase implements UseCase<UpdateNoteInput, Note> {\n  constructor(private readonly repository: NoteRepository) {}\n\n  async execute(input: UpdateNoteInput): Promise<Note> {\n    // First find the note to verify ownership\n    const findNoteUseCase = new FindNoteUseCase(this.repository);\n    const note = await findNoteUseCase.execute({\n      id: input.id,\n      userId: input.userId,\n    });\n\n    // Only the author can update\n    if (note.props.authorId !== input.userId) {\n      throw new Error(\"Only the note author can update it\");\n    }\n\n    // Update only provided fields\n    const updatedNote = note.update({\n      content: input.content,\n      x: input.x,\n      y: input.y,\n      width: input.width,\n      height: input.height,\n      color: input.color,\n    });\n\n    await this.repository.update(updatedNote);\n\n    return updatedNote;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Note } from \"../model/note.entity\";\nimport { NoteRepository } from \"../provider/note.repository\";\nimport { FindNoteUseCase } from \"./find-note.usecase\";\n\nexport interface DeleteNoteInput {\n  id: string;\n  userId: string;\n}\n\nexport class DeleteNoteUseCase implements UseCase<DeleteNoteInput, Note> {\n  constructor(private readonly repository: NoteRepository) {}\n\n  async execute(input: DeleteNoteInput): Promise<Note> {\n    // First find the note to verify ownership\n    const findNoteUseCase = new FindNoteUseCase(this.repository);\n    const note = await findNoteUseCase.execute({\n      id: input.id,\n      userId: input.userId,\n    });\n\n    // Only the author can delete\n    if (note.props.authorId !== input.userId) {\n      throw new Error(\"Only the note author can delete it\");\n    }\n\n    await this.repository.delete(note.id as string);\n\n    return note;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Note } from \"../model/note.entity\";\nimport { NoteRepository } from \"../provider/note.repository\";\n\nexport interface FindAllNotesInput {\n  workspaceId: string;\n  userId: string;\n  limit?: number;\n  page?: number;\n  search?: string;\n  authorId?: string;\n  sortBy?: string;\n  sortOrder?: \"asc\" | \"desc\";\n}\n\nexport class FindAllNotesUseCase implements UseCase<FindAllNotesInput, { data: Note[]; total: number; page: number; limit: number; totalPages: number }> {\n  constructor(private readonly repository: NoteRepository) {}\n\n  async execute(input: FindAllNotesInput): Promise<{ data: Note[]; total: number; page: number; limit: number; totalPages: number }> {\n    // Verify user is a member of the workspace\n    const member = await this.repository.findWorkspaceMember(\n      input.workspaceId,\n      input.userId\n    );\n\n    if (!member) {\n      throw new Error(\"You are not a member of this workspace\");\n    }\n\n    return await this.repository.findByWorkspaceId(input.workspaceId, {\n      limit: input.limit,\n      page: input.page,\n      search: input.search,\n      authorId: input.authorId,\n      sortBy: input.sortBy,\n      sortOrder: input.sortOrder,\n    });\n  }\n}\n","import { Entity, EntityProps, EntityMode } from \"../../shared/entity\";\nimport { COMMENT_LIMITS } from \"../../shared/constants/limits.constants\";\n\n/**\n * Properties for creating a Comment entity.\n *\n * Comments represent user discussions on tasks, supporting threaded\n * replies and user mentions for collaboration.\n *\n * @example\n * ```typescript\n * const comment = new Comment({\n *   taskId: 'task-123',\n *   userId: 'user-456',\n *   content: 'Please review this task',\n *   mentions: ['user-789']\n * });\n * ```\n */\nexport interface CommentProps extends EntityProps {\n  /**\n   * The ID of the task this comment belongs to.\n   * Required - every comment must be associated with a task.\n   */\n  taskId: string;\n\n  /**\n   * The ID of the user who wrote this comment.\n   * Required - every comment must have an author.\n   */\n  userId: string;\n\n  /**\n   * The comment text content.\n   * Required - must be between 1 and 2000 characters.\n   */\n  content: string;\n\n  /**\n   * Optional parent comment ID for threaded replies.\n   * If present, this comment is a reply to another comment.\n   */\n  parentCommentId?: string | null;\n\n  /**\n   * Array of user IDs mentioned in this comment.\n   * Mentions trigger notifications for the mentioned users.\n   */\n  mentions?: string[];\n\n  /**\n   * Whether this comment has been edited.\n   * Automatically set to true when edit() is called.\n   */\n  isEdited?: boolean;\n\n  /**\n   * Timestamp when the comment was last edited.\n   * Automatically updated when edit() is called.\n   */\n  editedAt?: Date;\n\n  /**\n   * Timestamp when the comment was created.\n   * Defaults to current time if not provided.\n   */\n  createdAt?: Date;\n\n  /**\n   * Timestamp when the comment was last updated.\n   * Defaults to current time if not provided.\n   */\n  updatedAt?: Date;\n}\n\n/**\n * Represents a comment on a task.\n *\n * Comments enable team collaboration by allowing discussions\n * directly on tasks. They support threaded replies and user mentions.\n *\n * ## Business Rules\n *\n * - Content must be between 1 and 2000 characters\n * - Every comment must belong to a task\n * - Every comment must have an author\n * - Mentions are stored as an array of user IDs\n * - Comments are immutable - use business methods to create updated versions\n *\n * ## Immutability\n *\n * All update methods return a new Comment instance.\n * Never modify properties directly.\n *\n * @example\n * ```typescript\n * // Create a new comment\n * const comment = Comment.create({\n *   taskId: 'task-123',\n *   userId: 'user-456',\n *   content: 'Let me handle this'\n * });\n *\n * // Edit the content\n * const edited = comment.edit('Updated: I will handle this tomorrow');\n *\n * // Add a mention\n * const withMention = edited.addMention('user-789');\n *\n * // Check if user is mentioned\n * if (withMention.hasMention('user-789')) {\n *   // Send notification\n * }\n *\n * // Remove a mention\n * const final = withMention.removeMention('user-789');\n * ```\n *\n * @see {@link ../../shared/constants/limits.constants.ts | COMMENT_LIMITS}\n */\nexport class Comment extends Entity<CommentProps> {\n  constructor(props: CommentProps, mode: EntityMode = \"valid\") {\n    super({\n      ...props,\n      mentions: props.mentions ?? [],\n      isEdited: props.isEdited ?? false,\n      createdAt: props.createdAt ?? new Date(),\n      updatedAt: props.updatedAt ?? new Date(),\n    }, mode);\n\n    // Validate content if not in draft mode\n    if (this.mode === \"valid\") {\n      this.validateContent(props.content);\n      this.validateTaskId(props.taskId);\n      this.validateUserId(props.userId);\n      this.validateMentions(props.mentions);\n    }\n  }\n\n  /**\n   * Creates a new comment with defaults applied.\n   *\n   * Factory method for creating comments without manually\n   * setting id, timestamps, and default values.\n   *\n   * @param props - Comment properties (id, timestamps auto-generated)\n   * @returns A new Comment instance\n   *\n   * @example\n   * ```typescript\n   * const comment = Comment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: 'Great work!'\n   * });\n   * ```\n   */\n  static create(\n    props: Omit<CommentProps, \"id\" | \"isEdited\" | \"editedAt\" | \"createdAt\" | \"updatedAt\">\n  ): Comment {\n    return new Comment({\n      ...props,\n      mentions: props.mentions ?? [],\n      isEdited: false,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    });\n  }\n\n  // Getters for commonly accessed properties\n  get taskId(): string {\n    return this.props.taskId;\n  }\n\n  get userId(): string {\n    return this.props.userId;\n  }\n\n  get content(): string {\n    return this.props.content;\n  }\n\n  get mentions(): string[] {\n    return this.props.mentions ?? [];\n  }\n\n  get parentCommentId(): string | null | undefined {\n    return this.props.parentCommentId;\n  }\n\n  get isEdited(): boolean {\n    return this.props.isEdited ?? false;\n  }\n\n  get editedAt(): Date | undefined {\n    return this.props.editedAt;\n  }\n\n  get createdAt(): Date {\n    return this.props.createdAt ?? new Date();\n  }\n\n  get updatedAt(): Date {\n    return this.props.updatedAt ?? new Date();\n  }\n\n  /**\n   * Updates the comment content.\n   *\n   * Creates a new comment with updated content, marking it as edited.\n   * The edit timestamp is automatically recorded.\n   *\n   * @param newContent - The new comment content (1-2000 characters)\n   * @returns A new Comment instance with updated content\n   * @throws {Error} If content is invalid\n   *\n   * @example\n   * ```typescript\n   * const comment = Comment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: 'Original text'\n   * });\n   *\n   * const edited = comment.edit('Corrected text');\n   * console.log(edited.isEdited); // true\n   * console.log(edited.editedAt); // Date object\n   * ```\n   */\n  edit(newContent: string): Comment {\n    const trimmed = newContent.trim();\n    this.validateContent(trimmed);\n\n    return this.clone({\n      content: trimmed,\n      isEdited: true,\n      editedAt: new Date(),\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Adds a user mention to the comment.\n   *\n   * If the user is already mentioned, this returns the comment unchanged.\n   * Mentions trigger notifications for the mentioned users.\n   *\n   * @param userId - The ID of the user to mention\n   * @returns A new Comment instance with the mention added\n   *\n   * @example\n   * ```typescript\n   * const comment = Comment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: '@user-789 please review'\n   * });\n   *\n   * const withMention = comment.addMention('user-789');\n   * console.log(withMention.mentions); // ['user-789']\n   * ```\n   */\n  addMention(userId: string): Comment {\n    if (!userId || userId.trim().length === 0) {\n      throw new Error(\"User ID for mention cannot be empty\");\n    }\n\n    const currentMentions = this.props.mentions ?? [];\n    if (currentMentions.includes(userId)) {\n      return this; // Already mentioned, return unchanged\n    }\n\n    return this.clone({\n      mentions: [...currentMentions, userId],\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Removes a user mention from the comment.\n   *\n   * If the user is not mentioned, this returns the comment unchanged.\n   *\n   * @param userId - The ID of the user to unmention\n   * @returns A new Comment instance with the mention removed\n   *\n   * @example\n   * ```typescript\n   * const comment = Comment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: 'Review',\n   *   mentions: ['user-789', 'user-abc']\n   * });\n   *\n   * const withoutMention = comment.removeMention('user-789');\n   * console.log(withoutMention.mentions); // ['user-abc']\n   * ```\n   */\n  removeMention(userId: string): Comment {\n    const currentMentions = this.props.mentions ?? [];\n    if (!currentMentions.includes(userId)) {\n      return this; // Not mentioned, return unchanged\n    }\n\n    return this.clone({\n      mentions: currentMentions.filter((id) => id !== userId),\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Checks if a user is mentioned in this comment.\n   *\n   * Useful for determining if a notification should be sent.\n   *\n   * @param userId - The ID of the user to check\n   * @returns true if the user is mentioned, false otherwise\n   *\n   * @example\n   * ```typescript\n   * const comment = Comment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: '@user-789 please review',\n   *   mentions: ['user-789']\n   * });\n   *\n   * if (comment.hasMention('user-789')) {\n   *   sendNotification('user-789', 'You were mentioned');\n   * }\n   * ```\n   */\n  hasMention(userId: string): boolean {\n    return this.mentions.includes(userId);\n  }\n\n  /**\n   * Checks if this comment is a reply to another comment.\n   *\n   * @returns true if this comment has a parent, false otherwise\n   *\n   * @example\n   * ```typescript\n   * const comment = Comment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: 'I agree',\n   *   parentCommentId: 'comment-123'\n   * });\n   *\n   * console.log(comment.isReply()); // true\n   * ```\n   */\n  isReply(): boolean {\n    return this.props.parentCommentId !== null &&\n           this.props.parentCommentId !== undefined &&\n           this.props.parentCommentId.length > 0;\n  }\n\n  /**\n   * Gets the number of users mentioned in this comment.\n   *\n   * @returns The count of unique mentioned users\n   *\n   * @example\n   * ```typescript\n   * const comment = Comment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: 'Team please review',\n   *   mentions: ['user-789', 'user-abc', 'user-def']\n   * });\n   *\n   * console.log(comment.mentionCount); // 3\n   * ```\n   */\n  get mentionCount(): number {\n    return this.mentions.length;\n  }\n\n  /**\n   * Validates the comment content.\n   *\n   * @private\n   * @param content - The content to validate\n   * @throws {Error} If content is invalid\n   */\n  private validateContent(content: string): void {\n    if (!content || typeof content !== \"string\") {\n      throw new Error(\"Comment content is required\");\n    }\n\n    const trimmed = content.trim();\n    if (trimmed.length === 0) {\n      throw new Error(\"Comment content cannot be empty\");\n    }\n\n    if (trimmed.length < COMMENT_LIMITS.CONTENT_MIN_LENGTH) {\n      throw new Error(\n        `Comment content must be at least ${COMMENT_LIMITS.CONTENT_MIN_LENGTH} character(s)`\n      );\n    }\n\n    if (trimmed.length > COMMENT_LIMITS.CONTENT_MAX_LENGTH) {\n      throw new Error(\n        `Comment content cannot exceed ${COMMENT_LIMITS.CONTENT_MAX_LENGTH} characters`\n      );\n    }\n  }\n\n  /**\n   * Validates the task ID.\n   *\n   * @private\n   * @param taskId - The task ID to validate\n   * @throws {Error} If task ID is invalid\n   */\n  private validateTaskId(taskId: string): void {\n    if (!taskId || typeof taskId !== \"string\" || taskId.trim().length === 0) {\n      throw new Error(\"Task ID is required\");\n    }\n  }\n\n  /**\n   * Validates the user ID.\n   *\n   * @private\n   * @param userId - The user ID to validate\n   * @throws {Error} If user ID is invalid\n   */\n  private validateUserId(userId: string): void {\n    if (!userId || typeof userId !== \"string\" || userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n  }\n\n  /**\n   * Validates the mentions array.\n   *\n   * @private\n   * @param mentions - The mentions array to validate\n   * @throws {Error} If mentions are invalid\n   */\n  private validateMentions(mentions?: string[]): void {\n    if (mentions === undefined || mentions === null) {\n      return; // Optional, valid to be undefined\n    }\n\n    if (!Array.isArray(mentions)) {\n      throw new Error(\"Mentions must be an array\");\n    }\n\n    for (const mention of mentions) {\n      if (typeof mention !== \"string\" || mention.trim().length === 0) {\n        throw new Error(\"Each mention must be a non-empty string\");\n      }\n    }\n  }\n\n  /**\n   * Creates a draft version of this comment.\n   *\n   * Draft mode skips validation, useful for forms before submission.\n   *\n   * @returns A new Comment instance in draft mode\n   *\n   * @example\n   * ```typescript\n   * const draft = comment.asDraft();\n   * // Can now modify without validation\n   * ```\n   */\n  asDraft(): this {\n    return this.clone(this.props, \"draft\");\n  }\n\n  /**\n   * Converts this comment to valid mode.\n   *\n   * Triggers validation of all properties.\n   *\n   * @returns A new Comment instance in valid mode\n   * @throws {Error} If any validation fails\n   *\n   * @example\n   * ```typescript\n   * const draft = new Comment({ content: '' }, 'draft');\n   * const valid = draft.asValid(); // Throws error if content is empty\n   * ```\n   */\n  asValid(): this {\n    return this.clone(this.props, \"valid\");\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Comment, CommentProps } from \"../model/comment.entity\";\nimport { CommentRepository } from \"../provider/comment.repository\";\n\n/**\n * Input for creating a new comment.\n *\n * All fields are required unless marked optional.\n */\nexport interface CreateCommentInput {\n  /**\n   * The ID of the task to comment on.\n   * The task must exist for the comment to be created.\n   */\n  taskId: string;\n\n  /**\n   * The ID of the user creating the comment.\n   * This user will be the author of the comment.\n   */\n  userId: string;\n\n  /**\n   * The comment content.\n   * Must be between 1 and 2000 characters.\n   */\n  content: string;\n\n  /**\n   * Optional parent comment ID for threaded replies.\n   * If provided, this comment will be a reply to another comment.\n   */\n  parentCommentId?: string | null;\n\n  /**\n   * Optional array of user IDs to mention in the comment.\n   * Mentioned users will receive notifications.\n   */\n  mentions?: string[];\n}\n\n/**\n * Use case for creating a new comment on a task.\n *\n * This use case handles the creation of comments, which enable\n * team collaboration by allowing discussions directly on tasks.\n * Comments can be standalone or replies to other comments (threaded).\n *\n * ## Business Rules\n *\n * - The task must exist (checked via repository)\n * - Content must be between 1 and 2000 characters\n * - User ID and task ID are required\n * - Mentions are optional but must be valid user IDs if provided\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new CreateCommentUseCase(commentRepository);\n *\n * const comment = await useCase.execute({\n *   taskId: 'task-123',\n *   userId: 'user-456',\n *   content: 'Let me handle this task',\n *   mentions: ['user-789']\n * });\n *\n * console.log(`Comment created: ${comment.id}`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Task ID is missing or invalid\n * - User ID is missing or invalid\n * - Content is empty or too long\n * - Repository operations fail\n *\n * @see {@link ../model/comment.entity.ts | Comment entity}\n * @see {@link ../provider/comment.repository.ts | CommentRepository}\n */\nexport class CreateCommentUseCase\n  implements UseCase<CreateCommentInput, Comment>\n{\n  constructor(private readonly commentRepository: CommentRepository) {}\n\n  /**\n   * Executes the create comment use case.\n   *\n   * Creates a new comment on the specified task with the provided content.\n   * The comment is validated before being persisted.\n   *\n   * @param input - The comment creation input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the created comment\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const comment = await useCase.execute({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   content: 'Great work on this task!'\n   * });\n   * ```\n   */\n  async execute(\n    input: CreateCommentInput,\n    _loggedUser?: unknown,\n  ): Promise<Comment> {\n    // Validate required fields\n    if (!input.taskId || input.taskId.trim().length === 0) {\n      throw new Error(\"Task ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    if (!input.content || input.content.trim().length === 0) {\n      throw new Error(\"Comment content is required\");\n    }\n\n    // Create the comment entity (validates content via entity constructor)\n    const comment = Comment.create({\n      taskId: input.taskId,\n      userId: input.userId,\n      content: input.content.trim(),\n      parentCommentId: input.parentCommentId ?? null,\n      mentions: input.mentions ?? [],\n    });\n\n    // Persist the comment\n    await this.commentRepository.create(comment);\n\n    return comment;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Comment } from \"../model/comment.entity\";\nimport { CommentRepository } from \"../provider/comment.repository\";\n\n/**\n * Input for updating an existing comment.\n */\nexport interface UpdateCommentInput {\n  /**\n   * The ID of the comment to update.\n   */\n  commentId: string;\n\n  /**\n   * The ID of the user attempting to update the comment.\n   * Must be the original author of the comment.\n   */\n  userId: string;\n\n  /**\n   * The new content for the comment.\n   * Must be between 1 and 2000 characters.\n   */\n  newContent: string;\n}\n\n/**\n * Use case for updating an existing comment's content.\n *\n * This use case handles the editing of comments by their original authors.\n * When a comment is edited, it is marked as edited with a timestamp.\n *\n * ## Business Rules\n *\n * - Only the comment author can edit their own comment\n * - Content must be between 1 and 2000 characters\n * - The edit is tracked with isEdited flag and editedAt timestamp\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new UpdateCommentUseCase(commentRepository);\n *\n * const updated = await useCase.execute({\n *   commentId: 'comment-123',\n *   userId: 'user-456',\n *   newContent: 'Updated: I will handle this tomorrow instead'\n * });\n *\n * console.log(updated.isEdited); // true\n * console.log(updated.editedAt); // Date object\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Comment ID is missing or invalid\n * - User ID is missing or invalid\n * - New content is empty or too long\n * - Comment doesn't exist\n * - User is not the comment author\n *\n * @see {@link ../model/comment.entity.ts | Comment entity}\n * @see {@link ../provider/comment.repository.ts | CommentRepository}\n */\nexport class UpdateCommentUseCase\n  implements UseCase<UpdateCommentInput, Comment>\n{\n  constructor(private readonly commentRepository: CommentRepository) {}\n\n  /**\n   * Executes the update comment use case.\n   *\n   * Updates the content of an existing comment if the user is the author.\n   * The comment is marked as edited with a timestamp.\n   *\n   * @param input - The update input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the updated comment\n   * @throws {Error} If validation fails or user is not the author\n   *\n   * @example\n   * ```typescript\n   * const updated = await useCase.execute({\n   *   commentId: 'comment-123',\n   *   userId: 'user-456',\n   *   newContent: 'Corrected information'\n   * });\n   * ```\n   */\n  async execute(\n    input: UpdateCommentInput,\n    _loggedUser?: unknown,\n  ): Promise<Comment> {\n    // Validate required fields\n    if (!input.commentId || input.commentId.trim().length === 0) {\n      throw new Error(\"Comment ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    if (!input.newContent || input.newContent.trim().length === 0) {\n      throw new Error(\"New content is required\");\n    }\n\n    // Find the existing comment\n    const existingComment = await this.commentRepository.findById(\n      input.commentId,\n    );\n\n    if (!existingComment) {\n      throw new Error(\"Comment not found\");\n    }\n\n    // Verify ownership - only the author can edit\n    if (existingComment.userId !== input.userId) {\n      throw new Error(\"You can only edit your own comments\");\n    }\n\n    // Update the content using the entity's edit method\n    const updatedComment = existingComment.edit(input.newContent.trim());\n\n    // Persist the update\n    await this.commentRepository.update(updatedComment);\n\n    return updatedComment;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Comment } from \"../model/comment.entity\";\nimport { CommentRepository } from \"../provider/comment.repository\";\n\n/**\n * Input for deleting a comment.\n */\nexport interface DeleteCommentInput {\n  /**\n   * The ID of the comment to delete.\n   */\n  commentId: string;\n\n  /**\n   * The ID of the user attempting to delete the comment.\n   * Must be the original author of the comment.\n   */\n  userId: string;\n}\n\n/**\n * Use case for deleting a comment.\n *\n * This use case handles the permanent deletion of comments by their authors.\n * Once deleted, a comment cannot be recovered.\n *\n * ## Business Rules\n *\n * - Only the comment author can delete their own comment\n * - Deletion is permanent (consider soft delete for undo functionality)\n * - All replies to the comment should also be handled (application-specific)\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new DeleteCommentUseCase(commentRepository);\n *\n * await useCase.execute({\n *   commentId: 'comment-123',\n *   userId: 'user-456'\n * });\n *\n * console.log('Comment deleted');\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Comment ID is missing or invalid\n * - User ID is missing or invalid\n * - Comment doesn't exist\n * - User is not the comment author\n *\n * ## Threaded Comments\n *\n * For threaded comments, consider whether deleting a parent comment\n * should also delete its replies. This is application-specific logic\n * that may be implemented in the repository or a separate use case.\n *\n * @see {@link ../model/comment.entity.ts | Comment entity}\n * @see {@link ../provider/comment.repository.ts | CommentRepository}\n */\nexport class DeleteCommentUseCase implements UseCase<DeleteCommentInput, void> {\n  constructor(private readonly commentRepository: CommentRepository) {}\n\n  /**\n   * Executes the delete comment use case.\n   *\n   * Permanently deletes a comment if the user is the author.\n   *\n   * @param input - The delete input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise that resolves when the comment is deleted\n   * @throws {Error} If validation fails or user is not the author\n   *\n   * @example\n   * ```typescript\n   * await useCase.execute({\n   *   commentId: 'comment-123',\n   *   userId: 'user-456'\n   * });\n   * ```\n   */\n  async execute(\n    input: DeleteCommentInput,\n    _loggedUser?: unknown,\n  ): Promise<void> {\n    // Validate required fields\n    if (!input.commentId || input.commentId.trim().length === 0) {\n      throw new Error(\"Comment ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Find the existing comment\n    const existingComment = await this.commentRepository.findById(\n      input.commentId,\n    );\n\n    if (!existingComment) {\n      throw new Error(\"Comment not found\");\n    }\n\n    // Verify ownership - only the author can delete\n    if (existingComment.userId !== input.userId) {\n      throw new Error(\"You can only delete your own comments\");\n    }\n\n    // Permanently delete the comment\n    await this.commentRepository.delete(input.commentId);\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Comment } from \"../model/comment.entity\";\nimport { CommentRepository } from \"../provider/comment.repository\";\n\n/**\n * Input for retrieving comments by task.\n */\nexport interface GetCommentsByTaskInput {\n  /**\n   * The ID of the task to retrieve comments for.\n   */\n  taskId: string;\n}\n\n/**\n * Use case for retrieving all comments for a specific task.\n *\n * This use case handles fetching the complete comment thread for a task,\n * which is essential for displaying task discussions in the UI.\n *\n * ## Business Rules\n *\n * - Returns all comments for the specified task\n * - Comments are ordered chronologically (oldest first)\n * - Includes both top-level comments and threaded replies\n * - Returns an empty array if no comments exist\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetCommentsByTaskUseCase(commentRepository);\n *\n * const comments = await useCase.execute({\n *   taskId: 'task-123'\n * });\n *\n * console.log(`Found ${comments.length} comments`);\n * comments.forEach(comment => {\n *   console.log(`${comment.userId}: ${comment.content}`);\n * });\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Task ID is missing or invalid\n * - Repository operation fails\n *\n * Returns an empty array (not an error) if:\n * - Task has no comments\n * - Task doesn't exist (application-specific - may throw instead)\n *\n * @see {@link ../model/comment.entity.ts | Comment entity}\n * @see {@link ../provider/comment.repository.ts | CommentRepository}\n */\nexport class GetCommentsByTaskUseCase\n  implements UseCase<GetCommentsByTaskInput, Comment[]>\n{\n  constructor(private readonly commentRepository: CommentRepository) {}\n\n  /**\n   * Executes the get comments by task use case.\n   *\n   * Retrieves all comments for the specified task, ordered chronologically.\n   *\n   * @param input - The input containing the task ID\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to an array of comments (empty if none found)\n   * @throws {Error} If task ID is invalid or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const comments = await useCase.execute({\n   *   taskId: 'task-123'\n * });\n   *\n   * // Display comments in UI\n   * return (\n   *   <CommentThread comments={comments} />\n   * );\n   * ```\n   */\n  async execute(\n    input: GetCommentsByTaskInput,\n    _loggedUser?: unknown,\n  ): Promise<Comment[]> {\n    // Validate task ID\n    if (!input.taskId || input.taskId.trim().length === 0) {\n      throw new Error(\"Task ID is required\");\n    }\n\n    // Retrieve comments for the task\n    const comments = await this.commentRepository.findByTaskId(\n      input.taskId,\n    );\n\n    return comments;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Comment } from \"../model/comment.entity\";\nimport { CommentRepository } from \"../provider/comment.repository\";\n\n/**\n * Input for retrieving comments by user.\n */\nexport interface GetCommentsByUserInput {\n  /**\n   * The ID of the user to retrieve comments for.\n   */\n  userId: string;\n}\n\n/**\n * Use case for retrieving all comments created by a specific user.\n *\n * This use case handles fetching all comments authored by a user,\n * which is useful for displaying user activity feeds or comment history.\n *\n * ## Business Rules\n *\n * - Returns all comments created by the specified user\n * - Comments are ordered by creation time (most recent first typically)\n * - Returns an empty array if the user has no comments\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetCommentsByUserUseCase(commentRepository);\n *\n * const comments = await useCase.execute({\n *   userId: 'user-456'\n * });\n *\n * console.log(`User has posted ${comments.length} comments`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - User ID is missing or invalid\n * - Repository operation fails\n *\n * Returns an empty array (not an error) if:\n * - User has no comments\n *\n * @see {@link ../model/comment.entity.ts | Comment entity}\n * @see {@link ../provider/comment.repository.ts | CommentRepository}\n */\nexport class GetCommentsByUserUseCase\n  implements UseCase<GetCommentsByUserInput, Comment[]>\n{\n  constructor(private readonly commentRepository: CommentRepository) {}\n\n  /**\n   * Executes the get comments by user use case.\n   *\n   * Retrieves all comments created by the specified user.\n   *\n   * @param input - The input containing the user ID\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to an array of comments (empty if none found)\n   * @throws {Error} If user ID is invalid or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const comments = await useCase.execute({\n   *   userId: 'user-456'\n   * });\n   *\n   * // Display user's comment history\n   * return (\n   *   <UserCommentHistory comments={comments} />\n   * );\n   * ```\n   */\n  async execute(\n    input: GetCommentsByUserInput,\n    _loggedUser?: unknown,\n  ): Promise<Comment[]> {\n    // Validate user ID\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Retrieve comments by the user\n    const comments = await this.commentRepository.findByUserId(\n      input.userId,\n    );\n\n    return comments;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Comment } from \"../model/comment.entity\";\nimport { CommentRepository } from \"../provider/comment.repository\";\n\n/**\n * Input for adding a mention to a comment.\n */\nexport interface AddMentionInput {\n  /**\n   * The ID of the comment to add the mention to.\n   */\n  commentId: string;\n\n  /**\n   * The ID of the user to mention.\n   * This user will receive a notification about the mention.\n   */\n  userIdToMention: string;\n}\n\n/**\n * Use case for adding a user mention to an existing comment.\n *\n * This use case handles adding user mentions to comments, which triggers\n * notifications for the mentioned users. Mentions enable direct communication\n * within task comments.\n *\n * ## Business Rules\n *\n * - The comment must exist\n * - The user to mention must be a valid user ID\n * - Duplicate mentions are ignored (idempotent operation)\n * - Adding a mention updates the comment's updatedAt timestamp\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new AddMentionUseCase(commentRepository);\n *\n * const updated = await useCase.execute({\n *   commentId: 'comment-123',\n *   userIdToMention: 'user-789'\n * });\n *\n * console.log(`User mentioned. Total mentions: ${updated.mentionCount}`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Comment ID is missing or invalid\n * - User ID to mention is missing or invalid\n * - Comment doesn't exist\n * - Repository operation fails\n *\n * ## Idempotency\n *\n * This operation is idempotent - adding a mention for a user who is\n * already mentioned will return the comment unchanged without error.\n *\n * @see {@link ../model/comment.entity.ts | Comment entity}\n * @see {@link ../provider/comment.repository.ts | CommentRepository}\n */\nexport class AddMentionUseCase implements UseCase<AddMentionInput, Comment> {\n  constructor(private readonly commentRepository: CommentRepository) {}\n\n  /**\n   * Executes the add mention use case.\n   *\n   * Adds a user mention to the specified comment. If the user is already\n   * mentioned, the comment is returned unchanged.\n   *\n   * @param input - The input containing comment ID and user ID to mention\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the updated comment\n   * @throws {Error} If validation fails or comment doesn't exist\n   *\n   * @example\n   * ```typescript\n   * const updated = await useCase.execute({\n   *   commentId: 'comment-123',\n   *   userIdToMention: 'user-789'\n   * });\n   *\n   * // Trigger notification for mentioned user\n   * if (updated.hasMention('user-789')) {\n   *   await sendMentionNotification('user-789', updated.id);\n   * }\n   * ```\n   */\n  async execute(\n    input: AddMentionInput,\n    _loggedUser?: unknown,\n  ): Promise<Comment> {\n    // Validate required fields\n    if (!input.commentId || input.commentId.trim().length === 0) {\n      throw new Error(\"Comment ID is required\");\n    }\n\n    if (\n      !input.userIdToMention ||\n      input.userIdToMention.trim().length === 0\n    ) {\n      throw new Error(\"User ID to mention is required\");\n    }\n\n    // Find the existing comment\n    const existingComment = await this.commentRepository.findById(\n      input.commentId,\n    );\n\n    if (!existingComment) {\n      throw new Error(\"Comment not found\");\n    }\n\n    // Add the mention using the entity's addMention method\n    const updatedComment = existingComment.addMention(input.userIdToMention);\n\n    // Only persist if actually changed (entity handles idempotency)\n    await this.commentRepository.update(updatedComment);\n\n    return updatedComment;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Comment } from \"../model/comment.entity\";\nimport { CommentRepository } from \"../provider/comment.repository\";\n\n/**\n * Input for removing a mention from a comment.\n */\nexport interface RemoveMentionInput {\n  /**\n   * The ID of the comment to remove the mention from.\n   */\n  commentId: string;\n\n  /**\n   * The ID of the user to unmention.\n   */\n  userIdToUnmention: string;\n}\n\n/**\n * Use case for removing a user mention from an existing comment.\n *\n * This use case handles removing user mentions from comments, which may be\n * used when correcting mistakes or when a user requests to be unmentioned.\n *\n * ## Business Rules\n *\n * - The comment must exist\n * - The user ID to unmention must be a valid user ID\n * - Removing a non-existent mention is idempotent (no error)\n * - Removing a mention updates the comment's updatedAt timestamp\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new RemoveMentionUseCase(commentRepository);\n *\n * const updated = await useCase.execute({\n *   commentId: 'comment-123',\n *   userIdToUnmention: 'user-789'\n * });\n *\n * console.log(`User unmentioned. Remaining mentions: ${updated.mentionCount}`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Comment ID is missing or invalid\n * - User ID to unmention is missing or invalid\n * - Comment doesn't exist\n * - Repository operation fails\n *\n * ## Idempotency\n *\n * This operation is idempotent - removing a mention for a user who is\n * not mentioned will return the comment unchanged without error.\n *\n * @see {@link ../model/comment.entity.ts | Comment entity}\n * @see {@link ../provider/comment.repository.ts | CommentRepository}\n */\nexport class RemoveMentionUseCase implements UseCase<RemoveMentionInput, Comment> {\n  constructor(private readonly commentRepository: CommentRepository) {}\n\n  /**\n   * Executes the remove mention use case.\n   *\n   * Removes a user mention from the specified comment. If the user is not\n   * mentioned, the comment is returned unchanged.\n   *\n   * @param input - The input containing comment ID and user ID to unmention\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the updated comment\n   * @throws {Error} If validation fails or comment doesn't exist\n   *\n   * @example\n   * ```typescript\n   * const updated = await useCase.execute({\n   *   commentId: 'comment-123',\n   *   userIdToUnmention: 'user-789'\n   * });\n   *\n   * // Check if mention was removed\n   * if (!updated.hasMention('user-789')) {\n   *   console.log('User successfully unmentioned');\n   * }\n   * ```\n   */\n  async execute(\n    input: RemoveMentionInput,\n    _loggedUser?: unknown,\n  ): Promise<Comment> {\n    // Validate required fields\n    if (!input.commentId || input.commentId.trim().length === 0) {\n      throw new Error(\"Comment ID is required\");\n    }\n\n    if (\n      !input.userIdToUnmention ||\n      input.userIdToUnmention.trim().length === 0\n    ) {\n      throw new Error(\"User ID to unmention is required\");\n    }\n\n    // Find the existing comment\n    const existingComment = await this.commentRepository.findById(\n      input.commentId,\n    );\n\n    if (!existingComment) {\n      throw new Error(\"Comment not found\");\n    }\n\n    // Remove the mention using the entity's removeMention method\n    const updatedComment = existingComment.removeMention(\n      input.userIdToUnmention,\n    );\n\n    // Only persist if actually changed (entity handles idempotency)\n    await this.commentRepository.update(updatedComment);\n\n    return updatedComment;\n  }\n}\n","import { Entity, EntityProps, EntityMode } from \"../../shared/entity\";\nimport { FILE_LIMITS } from \"../../shared/constants/limits.constants\";\n\n/**\n * Properties for creating an Attachment entity.\n *\n * Attachments represent files uploaded to tasks, such as images,\n * documents, and other resources that provide context or reference\n * material for task completion.\n *\n * @example\n * ```typescript\n * const attachment = new Attachment({\n *   taskId: 'task-123',\n *   userId: 'user-456',\n *   fileName: 'document-v2.pdf',\n *   originalName: 'document.pdf',\n *   mimeType: 'application/pdf',\n *   size: 1024000,\n *   storagePath: '/uploads/abc123.pdf'\n * });\n * ```\n */\nexport interface AttachmentProps extends EntityProps {\n  /**\n   * The ID of the task this attachment belongs to.\n   * Required - every attachment must be associated with a task.\n   */\n  taskId: string;\n\n  /**\n   * The ID of the user who uploaded this attachment.\n   * Required - every attachment must have an uploader.\n   */\n  userId: string;\n\n  /**\n   * The stored file name (may include UUID or timestamp prefix).\n   * Required - must be between 1 and 255 characters.\n   */\n  fileName: string;\n\n  /**\n   * The original file name as provided by the user.\n   * Required - must be between 1 and 255 characters.\n   */\n  originalName: string;\n\n  /**\n   * The MIME type of the file.\n   * Required - must be a valid MIME type string.\n   */\n  mimeType: string;\n\n  /**\n   * The file size in bytes.\n   * Required - must be greater than 0 and within size limits.\n   */\n  size: number;\n\n  /**\n   * The storage path or URL where the file is stored.\n   * Required - must be a non-empty string.\n   */\n  storagePath: string;\n\n  /**\n   * Whether the file has been successfully uploaded.\n   * Defaults to false for new attachments before upload completes.\n   */\n  isUploaded?: boolean;\n\n  /**\n   * Timestamp when the file upload completed.\n   * Null if upload has not completed yet.\n   */\n  uploadedAt?: Date | null;\n\n  /**\n   * Timestamp when the attachment record was created.\n   * Defaults to current time if not provided.\n   */\n  createdAt?: Date;\n\n  /**\n   * Timestamp when the attachment record was last updated.\n   * Defaults to current time if not provided.\n   */\n  updatedAt?: Date;\n}\n\n/**\n * Represents a file attachment on a task.\n *\n * Attachments enable users to associate files with tasks for reference,\n * documentation, or collaboration. Files are stored externally (S3, R2, local)\n * while this entity tracks metadata and ownership.\n *\n * ## Business Rules\n *\n * - File name (both stored and original) must be 1-255 characters\n * - Every attachment must belong to a task\n * - Every attachment must have an uploader\n * - File size must be greater than 0 and within limits (default 10MB max)\n * - MIME type must be a valid string\n * - Attachments are immutable - use business methods to create updated versions\n *\n * ## Immutability\n *\n * All update methods return a new Attachment instance.\n * Never modify properties directly.\n *\n * @example\n * ```typescript\n * // Create a new attachment (before upload)\n * const attachment = Attachment.create({\n *   taskId: 'task-123',\n *   userId: 'user-456',\n *   fileName: 'unique-id-document.pdf',\n *   originalName: 'document.pdf',\n *   mimeType: 'application/pdf',\n *   size: 1024000,\n *   storagePath: '/uploads/unique-id-document.pdf'\n * });\n *\n * // Mark as uploaded after successful upload\n * const uploaded = attachment.markAsUploaded();\n *\n * // Check file type\n * if (uploaded.isPDF()) {\n *   console.log('This is a PDF document');\n * }\n *\n * // Get human-readable size\n * console.log(`File size: ${uploaded.getFileSizeInMB().toFixed(2)} MB`);\n * ```\n *\n * @see {@link ../../shared/constants/limits.constants.ts | FILE_LIMITS}\n */\nexport class Attachment extends Entity<AttachmentProps> {\n  constructor(props: AttachmentProps, mode: EntityMode = \"valid\") {\n    super({\n      ...props,\n      isUploaded: props.isUploaded ?? false,\n      createdAt: props.createdAt ?? new Date(),\n      updatedAt: props.updatedAt ?? new Date(),\n    }, mode);\n\n    // Validate all properties if not in draft mode\n    if (this.mode === \"valid\") {\n      this.validateTaskId(props.taskId);\n      this.validateUserId(props.userId);\n      this.validateFileName(props.fileName);\n      this.validateOriginalName(props.originalName);\n      this.validateMimeType(props.mimeType);\n      this.validateSize(props.size);\n      this.validateStoragePath(props.storagePath);\n    }\n  }\n\n  /**\n   * Creates a new attachment with defaults applied.\n   *\n   * Factory method for creating attachments without manually\n   * setting id, timestamps, and default values.\n   *\n   * @param props - Attachment properties (id, timestamps auto-generated)\n   * @returns A new Attachment instance\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   fileName: 'stored-name.pdf',\n   *   originalName: 'document.pdf',\n   *   mimeType: 'application/pdf',\n   *   size: 1024000,\n   *   storagePath: '/uploads/stored-name.pdf'\n   * });\n   * ```\n   */\n  static create(\n    props: Omit<AttachmentProps, \"id\" | \"isUploaded\" | \"uploadedAt\" | \"createdAt\" | \"updatedAt\">\n  ): Attachment {\n    return new Attachment({\n      ...props,\n      isUploaded: false,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    });\n  }\n\n  // Getters for commonly accessed properties\n  get taskId(): string {\n    return this.props.taskId;\n  }\n\n  get userId(): string {\n    return this.props.userId;\n  }\n\n  get fileName(): string {\n    return this.props.fileName;\n  }\n\n  get originalName(): string {\n    return this.props.originalName;\n  }\n\n  get mimeType(): string {\n    return this.props.mimeType;\n  }\n\n  get size(): number {\n    return this.props.size;\n  }\n\n  get storagePath(): string {\n    return this.props.storagePath;\n  }\n\n  get isUploaded(): boolean {\n    return this.props.isUploaded ?? false;\n  }\n\n  get uploadedAt(): Date | null | undefined {\n    return this.props.uploadedAt;\n  }\n\n  get createdAt(): Date {\n    return this.props.createdAt ?? new Date();\n  }\n\n  get updatedAt(): Date {\n    return this.props.updatedAt ?? new Date();\n  }\n\n  /**\n   * Marks the attachment as successfully uploaded.\n   *\n   * Sets the isUploaded flag to true and records the upload timestamp.\n   * Use this after the file has been successfully stored.\n   *\n   * @returns A new Attachment instance marked as uploaded\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({ ... });\n   * // After successful file upload...\n   * const uploaded = attachment.markAsUploaded();\n   * console.log(uploaded.isUploaded); // true\n   * console.log(uploaded.uploadedAt); // Date object\n   * ```\n   */\n  markAsUploaded(): Attachment {\n    return this.clone({\n      isUploaded: true,\n      uploadedAt: new Date(),\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Gets the file size in megabytes.\n   *\n   * @returns The file size in MB (decimal)\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   ...\n   *   size: 5242880 // 5 MB\n   * });\n   * console.log(attachment.getFileSizeInMB()); // 5.0\n   * ```\n   */\n  getFileSizeInMB(): number {\n    return this.props.size / (1024 * 1024);\n  }\n\n  /**\n   * Gets the file size in kilobytes.\n   *\n   * @returns The file size in KB (decimal)\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   ...\n   *   size: 102400 // ~100 KB\n   * });\n   * console.log(attachment.getFileSizeInKB()); // ~100.0\n   * ```\n   */\n  getFileSizeInKB(): number {\n    return this.props.size / 1024;\n  }\n\n  /**\n   * Checks if the attachment is an image file.\n   *\n   * Determines file type by MIME type.\n   *\n   * @returns true if the file is an image, false otherwise\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   ...\n   *   mimeType: 'image/jpeg'\n   * });\n   * if (attachment.isImage()) {\n   *   console.log('This is an image file');\n   * }\n   * ```\n   */\n  isImage(): boolean {\n    return this.props.mimeType.startsWith(\"image/\");\n  }\n\n  /**\n   * Checks if the attachment is a PDF file.\n   *\n   * @returns true if the file is a PDF, false otherwise\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   ...\n   *   mimeType: 'application/pdf'\n   * });\n   * if (attachment.isPDF()) {\n   *   console.log('This is a PDF document');\n   * }\n   * ```\n   */\n  isPDF(): boolean {\n    return this.props.mimeType === \"application/pdf\";\n  }\n\n  /**\n   * Checks if the attachment is a document file.\n   *\n   * Documents include PDF, Word, Excel, PowerPoint, and text files.\n   *\n   * @returns true if the file is a document, false otherwise\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   ...\n   *   mimeType: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n   * });\n   * if (attachment.isDocument()) {\n   *   console.log('This is a document file');\n   * }\n   * ```\n   */\n  isDocument(): boolean {\n    const documentTypes = [\n      \"application/pdf\",\n      \"application/msword\",\n      \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n      \"application/vnd.ms-excel\",\n      \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n      \"application/vnd.ms-powerpoint\",\n      \"application/vnd.openxmlformats-officedocument.presentationml.presentation\",\n      \"text/plain\",\n      \"text/csv\",\n    ];\n    return documentTypes.includes(this.props.mimeType);\n  }\n\n  /**\n   * Gets the file extension from the original name.\n   *\n   * @returns The file extension including the dot (e.g., \".pdf\"), or empty string if no extension\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   ...\n   *   originalName: 'document.pdf'\n   * });\n   * console.log(attachment.getExtension()); // '.pdf'\n   * ```\n   */\n  getExtension(): string {\n    const parts = this.props.originalName.split(\".\");\n    if (parts.length > 1) {\n      const lastPart = parts[parts.length - 1];\n      return \".\" + (lastPart?.toLowerCase() ?? \"\");\n    }\n    return \"\";\n  }\n\n  /**\n   * Checks if the file size exceeds a given limit.\n   *\n   * @param maxSizeMB - Maximum size in megabytes\n   * @returns true if the file is too large, false otherwise\n   *\n   * @example\n   * ```typescript\n   * const attachment = Attachment.create({\n   *   ...\n   *   size: 15 * 1024 * 1024 // 15 MB\n   * });\n   * if (attachment.isTooLarge(10)) {\n   *   console.log('File exceeds 10 MB limit');\n   * }\n   * ```\n   */\n  isTooLarge(maxSizeMB: number): boolean {\n    return this.getFileSizeInMB() > maxSizeMB;\n  }\n\n  /**\n   * Validates the task ID.\n   *\n   * @private\n   * @param taskId - The task ID to validate\n   * @throws {Error} If task ID is invalid\n   */\n  private validateTaskId(taskId: string): void {\n    if (!taskId || typeof taskId !== \"string\" || taskId.trim().length === 0) {\n      throw new Error(\"Task ID is required\");\n    }\n  }\n\n  /**\n   * Validates the user ID.\n   *\n   * @private\n   * @param userId - The user ID to validate\n   * @throws {Error} If user ID is invalid\n   */\n  private validateUserId(userId: string): void {\n    if (!userId || typeof userId !== \"string\" || userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n  }\n\n  /**\n   * Validates the file name.\n   *\n   * @private\n   * @param fileName - The file name to validate\n   * @throws {Error} If file name is invalid\n   */\n  private validateFileName(fileName: string): void {\n    if (!fileName || typeof fileName !== \"string\") {\n      throw new Error(\"File name is required\");\n    }\n\n    const trimmed = fileName.trim();\n    if (trimmed.length === 0) {\n      throw new Error(\"File name cannot be empty\");\n    }\n\n    if (trimmed.length > 255) {\n      throw new Error(\"File name cannot exceed 255 characters\");\n    }\n  }\n\n  /**\n   * Validates the original file name.\n   *\n   * @private\n   * @param originalName - The original file name to validate\n   * @throws {Error} If original name is invalid\n   */\n  private validateOriginalName(originalName: string): void {\n    if (!originalName || typeof originalName !== \"string\") {\n      throw new Error(\"Original file name is required\");\n    }\n\n    const trimmed = originalName.trim();\n    if (trimmed.length === 0) {\n      throw new Error(\"Original file name cannot be empty\");\n    }\n\n    if (trimmed.length > 255) {\n      throw new Error(\"Original file name cannot exceed 255 characters\");\n    }\n  }\n\n  /**\n   * Validates the MIME type.\n   *\n   * @private\n   * @param mimeType - The MIME type to validate\n   * @throws {Error} If MIME type is invalid\n   */\n  private validateMimeType(mimeType: string): void {\n    if (!mimeType || typeof mimeType !== \"string\") {\n      throw new Error(\"MIME type is required\");\n    }\n\n    const trimmed = mimeType.trim();\n    if (trimmed.length === 0) {\n      throw new Error(\"MIME type cannot be empty\");\n    }\n\n    // Basic MIME type format validation (type/subtype)\n    const mimeRegex = /^[a-z]+\\/[a-z0-9]+[a-z0-9+.-]*$/i;\n    if (!mimeRegex.test(trimmed)) {\n      throw new Error(\"Invalid MIME type format\");\n    }\n  }\n\n  /**\n   * Validates the file size.\n   *\n   * @private\n   * @param size - The file size in bytes to validate\n   * @throws {Error} If size is invalid\n   */\n  private validateSize(size: number): void {\n    if (typeof size !== \"number\" || isNaN(size)) {\n      throw new Error(\"File size must be a number\");\n    }\n\n    if (size <= 0) {\n      throw new Error(\"File size must be greater than 0\");\n    }\n\n    const maxSizeBytes = FILE_LIMITS.MAX_FILE_SIZE;\n    if (size > maxSizeBytes) {\n      throw new Error(\n        `File size cannot exceed ${maxSizeBytes / (1024 * 1024)} MB`\n      );\n    }\n  }\n\n  /**\n   * Validates the storage path.\n   *\n   * @private\n   * @param storagePath - The storage path to validate\n   * @throws {Error} If storage path is invalid\n   */\n  private validateStoragePath(storagePath: string): void {\n    if (!storagePath || typeof storagePath !== \"string\") {\n      throw new Error(\"Storage path is required\");\n    }\n\n    const trimmed = storagePath.trim();\n    if (trimmed.length === 0) {\n      throw new Error(\"Storage path cannot be empty\");\n    }\n\n    if (trimmed.length > 2048) {\n      throw new Error(\"Storage path cannot exceed 2048 characters\");\n    }\n  }\n\n  /**\n   * Creates a draft version of this attachment.\n   *\n   * Draft mode skips validation, useful for forms before submission.\n   *\n   * @returns A new Attachment instance in draft mode\n   *\n   * @example\n   * ```typescript\n   * const draft = attachment.asDraft();\n   * // Can now modify without validation\n   * ```\n   */\n  asDraft(): this {\n    return this.clone(this.props, \"draft\");\n  }\n\n  /**\n   * Converts this attachment to valid mode.\n   *\n   * Triggers validation of all properties.\n   *\n   * @returns A new Attachment instance in valid mode\n   * @throws {Error} If any validation fails\n   *\n   * @example\n   * ```typescript\n   * const draft = new Attachment({ fileName: '' }, 'draft');\n   * const valid = draft.asValid(); // Throws error if fileName is empty\n   * ```\n   */\n  asValid(): this {\n    return this.clone(this.props, \"valid\");\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Attachment, AttachmentProps } from \"../model/attachment.entity\";\nimport { AttachmentRepository } from \"../provider/attachment.repository\";\n\n/**\n * Input for creating a new attachment.\n *\n * All fields are required.\n */\nexport interface CreateAttachmentInput {\n  /**\n   * The ID of the task to attach the file to.\n   * The task must exist for the attachment to be created.\n   */\n  taskId: string;\n\n  /**\n   * The ID of the user uploading the file.\n   * This user will be recorded as the uploader.\n   */\n  userId: string;\n\n  /**\n   * The stored file name (may include UUID or timestamp prefix).\n   * This is the actual name used in storage.\n   */\n  fileName: string;\n\n  /**\n   * The original file name as provided by the user.\n   * This is the name that will be displayed in the UI.\n   */\n  originalName: string;\n\n  /**\n   * The MIME type of the file.\n   * Used for content-type negotiation and file type detection.\n   */\n  mimeType: string;\n\n  /**\n   * The file size in bytes.\n   * Must be greater than 0 and within size limits.\n   */\n  size: number;\n\n  /**\n   * The storage path or URL where the file is stored.\n   * This can be a relative path, absolute URL, or cloud storage path.\n   */\n  storagePath: string;\n}\n\n/**\n * Use case for creating a new attachment on a task.\n *\n * This use case handles the creation of attachment records before\n * or after file upload completes. Attachments enable users to\n * associate files with tasks for reference and collaboration.\n *\n * ## Business Rules\n *\n * - The task must exist (checked via repository)\n * - File name (both stored and original) must be 1-255 characters\n * - User ID and task ID are required\n * - File size must be greater than 0 and within limits (default 10MB max)\n * - MIME type must be valid\n * - Storage path must be provided\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new CreateAttachmentUseCase(attachmentRepository);\n *\n * const attachment = await useCase.execute({\n *   taskId: 'task-123',\n *   userId: 'user-456',\n *   fileName: 'abc123-document.pdf',\n *   originalName: 'document.pdf',\n *   mimeType: 'application/pdf',\n *   size: 1024000,\n *   storagePath: '/uploads/abc123-document.pdf'\n * });\n *\n * console.log(`Attachment created: ${attachment.id}`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Task ID is missing or invalid\n * - User ID is missing or invalid\n * - File names are missing or too long\n * - MIME type is invalid\n * - File size is 0 or exceeds limits\n * - Storage path is missing\n * - Repository operations fail\n *\n * @see {@link ../model/attachment.entity.ts | Attachment entity}\n * @see {@link ../provider/attachment.repository.ts | AttachmentRepository}\n */\nexport class CreateAttachmentUseCase\n  implements UseCase<CreateAttachmentInput, Attachment>\n{\n  constructor(private readonly attachmentRepository: AttachmentRepository) {}\n\n  /**\n   * Executes the create attachment use case.\n   *\n   * Creates a new attachment record on the specified task with the\n   * provided file metadata. The attachment is validated before being persisted.\n   *\n   * @param input - The attachment creation input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the created attachment\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const attachment = await useCase.execute({\n   *   taskId: 'task-123',\n   *   userId: 'user-456',\n   *   fileName: 'unique-id-image.jpg',\n   *   originalName: 'photo.jpg',\n   *   mimeType: 'image/jpeg',\n   *   size: 524288,\n   *   storagePath: '/uploads/unique-id-image.jpg'\n   * });\n   * ```\n   */\n  async execute(\n    input: CreateAttachmentInput,\n    _loggedUser?: unknown,\n  ): Promise<Attachment> {\n    // Validate required fields\n    if (!input.taskId || input.taskId.trim().length === 0) {\n      throw new Error(\"Task ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    if (!input.fileName || input.fileName.trim().length === 0) {\n      throw new Error(\"File name is required\");\n    }\n\n    if (!input.originalName || input.originalName.trim().length === 0) {\n      throw new Error(\"Original file name is required\");\n    }\n\n    if (!input.mimeType || input.mimeType.trim().length === 0) {\n      throw new Error(\"MIME type is required\");\n    }\n\n    if (typeof input.size !== \"number\" || input.size <= 0) {\n      throw new Error(\"File size must be a positive number\");\n    }\n\n    if (!input.storagePath || input.storagePath.trim().length === 0) {\n      throw new Error(\"Storage path is required\");\n    }\n\n    // Create the attachment entity (validates via entity constructor)\n    const attachment = Attachment.create({\n      taskId: input.taskId.trim(),\n      userId: input.userId.trim(),\n      fileName: input.fileName.trim(),\n      originalName: input.originalName.trim(),\n      mimeType: input.mimeType.trim(),\n      size: input.size,\n      storagePath: input.storagePath.trim(),\n    });\n\n    // Persist the attachment\n    await this.attachmentRepository.create(attachment);\n\n    return attachment;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Attachment } from \"../model/attachment.entity\";\nimport { AttachmentRepository } from \"../provider/attachment.repository\";\n\n/**\n * Input for marking an attachment as uploaded.\n */\nexport interface MarkAsUploadedInput {\n  /**\n   * The ID of the attachment to mark as uploaded.\n   */\n  attachmentId: string;\n}\n\n/**\n * Use case for marking an attachment as successfully uploaded.\n *\n * This use case handles updating an attachment's status after the file\n * has been successfully stored. This is typically called after the\n * upload process completes to record the upload timestamp.\n *\n * ## Business Rules\n *\n * - The attachment must exist\n * - The isUploaded flag is set to true\n * - The uploadedAt timestamp is recorded\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new MarkAsUploadedUseCase(attachmentRepository);\n *\n * // After successful file upload\n * await storageService.upload(file);\n * const attachment = await useCase.execute({\n *   attachmentId: 'attachment-123'\n * });\n *\n * console.log(`Attachment ${attachment.id} marked as uploaded`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Attachment ID is missing or invalid\n * - Attachment doesn't exist\n * - Repository operation fails\n *\n * @see {@link ../model/attachment.entity.ts | Attachment entity}\n * @see {@link ../provider/attachment.repository.ts | AttachmentRepository}\n */\nexport class MarkAsUploadedUseCase implements UseCase<MarkAsUploadedInput, Attachment> {\n  constructor(private readonly attachmentRepository: AttachmentRepository) {}\n\n  /**\n   * Executes the mark as uploaded use case.\n   *\n   * Marks an attachment as successfully uploaded by setting the\n   * isUploaded flag to true and recording the upload timestamp.\n   *\n   * @param input - The input containing the attachment ID\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the updated attachment\n   * @throws {Error} If attachment ID is invalid or attachment not found\n   *\n   * @example\n   * ```typescript\n   * // After successful upload\n   * const attachment = await useCase.execute({\n   *   attachmentId: 'attachment-123'\n   * });\n   * console.log(attachment.isUploaded); // true\n   * console.log(attachment.uploadedAt); // Date object\n   * ```\n   */\n  async execute(\n    input: MarkAsUploadedInput,\n    _loggedUser?: unknown,\n  ): Promise<Attachment> {\n    // Validate attachment ID\n    if (!input.attachmentId || input.attachmentId.trim().length === 0) {\n      throw new Error(\"Attachment ID is required\");\n    }\n\n    // Find the existing attachment\n    const existingAttachment = await this.attachmentRepository.findById(\n      input.attachmentId,\n    );\n\n    if (!existingAttachment) {\n      throw new Error(\"Attachment not found\");\n    }\n\n    // Mark as uploaded\n    const updatedAttachment = existingAttachment.markAsUploaded();\n\n    // Persist the update\n    await this.attachmentRepository.update(updatedAttachment);\n\n    return updatedAttachment;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Attachment } from \"../model/attachment.entity\";\nimport { AttachmentRepository } from \"../provider/attachment.repository\";\n\n/**\n * Input for deleting an attachment.\n */\nexport interface DeleteAttachmentInput {\n  /**\n   * The ID of the attachment to delete.\n   */\n  attachmentId: string;\n\n  /**\n   * The ID of the user attempting to delete the attachment.\n   * Must be the original uploader of the attachment.\n   */\n  userId: string;\n}\n\n/**\n * Use case for deleting an attachment.\n *\n * This use case handles the deletion of attachment records by their uploaders.\n * Note: Physical file deletion should be handled separately in the service layer\n * as it's a cross-cutting concern (storage provider specifics).\n *\n * ## Business Rules\n *\n * - Only the attachment uploader can delete their own attachment\n * - Deletion of the database record is permanent\n * - Physical file deletion is handled separately (service layer concern)\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new DeleteAttachmentUseCase(attachmentRepository);\n *\n * await useCase.execute({\n *   attachmentId: 'attachment-123',\n *   userId: 'user-456'\n * });\n *\n * // Delete physical file separately\n * await storageService.deleteFile(filePath);\n *\n * console.log('Attachment deleted');\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Attachment ID is missing or invalid\n * - User ID is missing or invalid\n * - Attachment doesn't exist\n * - User is not the attachment uploader\n *\n * @see {@link ../model/attachment.entity.ts | Attachment entity}\n * @see {@link ../provider/attachment.repository.ts | AttachmentRepository}\n */\nexport class DeleteAttachmentUseCase implements UseCase<DeleteAttachmentInput, void> {\n  constructor(private readonly attachmentRepository: AttachmentRepository) {}\n\n  /**\n   * Executes the delete attachment use case.\n   *\n   * Permanently deletes the attachment record if the user is the uploader.\n   * Physical file deletion should be handled separately.\n   *\n   * @param input - The delete input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise that resolves when the attachment record is deleted\n   * @throws {Error} If validation fails or user is not the uploader\n   *\n   * @example\n   * ```typescript\n   * await useCase.execute({\n   *   attachmentId: 'attachment-123',\n   *   userId: 'user-456'\n   * });\n   * // Note: Remember to delete the physical file separately\n   * ```\n   */\n  async execute(\n    input: DeleteAttachmentInput,\n    _loggedUser?: unknown,\n  ): Promise<void> {\n    // Validate required fields\n    if (!input.attachmentId || input.attachmentId.trim().length === 0) {\n      throw new Error(\"Attachment ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Find the existing attachment\n    const existingAttachment = await this.attachmentRepository.findById(\n      input.attachmentId,\n    );\n\n    if (!existingAttachment) {\n      throw new Error(\"Attachment not found\");\n    }\n\n    // Verify ownership - only the uploader can delete\n    if (existingAttachment.userId !== input.userId) {\n      throw new Error(\"You can only delete your own attachments\");\n    }\n\n    // Permanently delete the attachment record\n    await this.attachmentRepository.delete(input.attachmentId);\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Attachment } from \"../model/attachment.entity\";\nimport { AttachmentRepository } from \"../provider/attachment.repository\";\n\n/**\n * Input for retrieving attachments by task.\n */\nexport interface GetAttachmentsByTaskInput {\n  /**\n   * The ID of the task to retrieve attachments for.\n   */\n  taskId: string;\n}\n\n/**\n * Use case for retrieving all attachments for a specific task.\n *\n * This use case handles fetching the complete list of file attachments\n * for a task, which is essential for displaying task resources in the UI.\n *\n * ## Business Rules\n *\n * - Returns all attachments for the specified task\n * - Attachments are ordered by upload date (newest first)\n * - Returns an empty array if no attachments exist\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetAttachmentsByTaskUseCase(attachmentRepository);\n *\n * const attachments = await useCase.execute({\n *   taskId: 'task-123'\n * });\n *\n * console.log(`Found ${attachments.length} attachments`);\n * attachments.forEach(attachment => {\n *   console.log(`${attachment.originalName} (${attachment.getFileSizeInMB().toFixed(2)} MB)`);\n * });\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Task ID is missing or invalid\n * - Repository operation fails\n *\n * Returns an empty array (not an error) if:\n * - Task has no attachments\n *\n * @see {@link ../model/attachment.entity.ts | Attachment entity}\n * @see {@link ../provider/attachment.repository.ts | AttachmentRepository}\n */\nexport class GetAttachmentsByTaskUseCase\n  implements UseCase<GetAttachmentsByTaskInput, Attachment[]>\n{\n  constructor(private readonly attachmentRepository: AttachmentRepository) {}\n\n  /**\n   * Executes the get attachments by task use case.\n   *\n   * Retrieves all attachments for the specified task, ordered by\n   * upload date (newest first).\n   *\n   * @param input - The input containing the task ID\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to an array of attachments (empty if none found)\n   * @throws {Error} If task ID is invalid or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const attachments = await useCase.execute({\n   *   taskId: 'task-123'\n   * });\n   *\n   * // Display attachments in UI\n   * return (\n   *   <AttachmentList attachments={attachments} />\n   * );\n   * ```\n   */\n  async execute(\n    input: GetAttachmentsByTaskInput,\n    _loggedUser?: unknown,\n  ): Promise<Attachment[]> {\n    // Validate task ID\n    if (!input.taskId || input.taskId.trim().length === 0) {\n      throw new Error(\"Task ID is required\");\n    }\n\n    // Retrieve attachments for the task\n    const attachments = await this.attachmentRepository.findByTaskId(\n      input.taskId,\n    );\n\n    return attachments;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Attachment } from \"../model/attachment.entity\";\nimport { AttachmentRepository } from \"../provider/attachment.repository\";\n\n/**\n * Input for retrieving attachments by user.\n */\nexport interface GetAttachmentsByUserInput {\n  /**\n   * The ID of the user to retrieve attachments for.\n   */\n  userId: string;\n}\n\n/**\n * Use case for retrieving all attachments uploaded by a specific user.\n *\n * This use case handles fetching a user's complete upload history,\n * which is useful for activity feeds and user profile pages.\n *\n * ## Business Rules\n *\n * - Returns all attachments uploaded by the specified user\n * - Attachments are ordered by upload date (newest first)\n * - Returns an empty array if user has no attachments\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetAttachmentsByUserUseCase(attachmentRepository);\n *\n * const attachments = await useCase.execute({\n *   userId: 'user-456'\n * });\n *\n * console.log(`User has uploaded ${attachments.length} files`);\n * const totalSize = attachments.reduce((sum, a) => sum + a.size, 0);\n * console.log(`Total storage used: ${(totalSize / (1024 * 1024)).toFixed(2)} MB`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - User ID is missing or invalid\n * - Repository operation fails\n *\n * Returns an empty array (not an error) if:\n * - User has not uploaded any attachments\n *\n * @see {@link ../model/attachment.entity.ts | Attachment entity}\n * @see {@link ../provider/attachment.repository.ts | AttachmentRepository}\n */\nexport class GetAttachmentsByUserUseCase\n  implements UseCase<GetAttachmentsByUserInput, Attachment[]>\n{\n  constructor(private readonly attachmentRepository: AttachmentRepository) {}\n\n  /**\n   * Executes the get attachments by user use case.\n   *\n   * Retrieves all attachments uploaded by the specified user.\n   *\n   * @param input - The input containing the user ID\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to an array of attachments (empty if none found)\n   * @throws {Error} If user ID is invalid or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const attachments = await useCase.execute({\n   *   userId: 'user-456'\n   * });\n   *\n   * // Display in user profile\n   * return (\n   *   <UserUploads attachments={attachments} />\n   * );\n   * ```\n   */\n  async execute(\n    input: GetAttachmentsByUserInput,\n    _loggedUser?: unknown,\n  ): Promise<Attachment[]> {\n    // Validate user ID\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Retrieve attachments uploaded by the user\n    const attachments = await this.attachmentRepository.findByUserId(\n      input.userId,\n    );\n\n    return attachments;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Attachment } from \"../model/attachment.entity\";\nimport { AttachmentRepository } from \"../provider/attachment.repository\";\n\n/**\n * Input for retrieving an attachment by ID.\n */\nexport interface GetAttachmentByIdInput {\n  /**\n   * The ID of the attachment to retrieve.\n   */\n  attachmentId: string;\n}\n\n/**\n * Use case for retrieving a single attachment by its ID.\n *\n * This use case handles fetching attachment details when the ID is known,\n * such as from a URL parameter or after list filtering.\n *\n * ## Business Rules\n *\n * - Returns the attachment if found\n * - Throws an error if attachment doesn't exist\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetAttachmentByIdUseCase(attachmentRepository);\n *\n * const attachment = await useCase.execute({\n *   attachmentId: 'attachment-123'\n * });\n *\n * console.log(`Found: ${attachment.originalName}`);\n * console.log(`Size: ${attachment.getFileSizeInMB().toFixed(2)} MB`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Attachment ID is missing or invalid\n * - Attachment doesn't exist\n * - Repository operation fails\n *\n * @see {@link ../model/attachment.entity.ts | Attachment entity}\n * @see {@link ../link provider/attachment.repository.ts | AttachmentRepository}\n */\nexport class GetAttachmentByIdUseCase\n  implements UseCase<GetAttachmentByIdInput, Attachment>\n{\n  constructor(private readonly attachmentRepository: AttachmentRepository) {}\n\n  /**\n   * Executes the get attachment by ID use case.\n   *\n   * Retrieves a single attachment by its unique identifier.\n   *\n   * @param input - The input containing the attachment ID\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the attachment\n   * @throws {Error} If attachment ID is invalid or attachment not found\n   *\n   * @example\n   * ```typescript\n   * const attachment = await useCase.execute({\n   *   attachmentId: 'attachment-123'\n   * });\n   *\n   * // Display attachment details\n   * return (\n   *   <AttachmentDetails attachment={attachment} />\n   * );\n   * ```\n   */\n  async execute(\n    input: GetAttachmentByIdInput,\n    _loggedUser?: unknown,\n  ): Promise<Attachment> {\n    // Validate attachment ID\n    if (!input.attachmentId || input.attachmentId.trim().length === 0) {\n      throw new Error(\"Attachment ID is required\");\n    }\n\n    // Retrieve the attachment\n    const attachment = await this.attachmentRepository.findById(\n      input.attachmentId,\n    );\n\n    if (!attachment) {\n      throw new Error(\"Attachment not found\");\n    }\n\n    return attachment;\n  }\n}\n","import { Entity, EntityProps, EntityMode } from \"../../shared/entity\";\nimport { NOTIFICATION_LIMITS } from \"../../shared/constants/limits.constants\";\n\n/**\n * Notification type enum.\n *\n * Represents the category or reason for the notification.\n * These types determine how notifications are displayed and grouped.\n *\n * @example\n * ```typescript\n * const type = NotificationType.TASK_ASSIGNED;\n * ```\n */\nexport enum NotificationType {\n  /** User was assigned to a task */\n  TASK_ASSIGNED = \"TASK_ASSIGNED\",\n  /** New comment added to a task */\n  COMMENT_ADDED = \"COMMENT_ADDED\",\n  /** User was mentioned in a comment */\n  MENTIONED = \"MENTIONED\",\n  /** Task due date is approaching */\n  DUE_DATE_APPROACHING = \"DUE_DATE_APPROACHING\",\n  /** User received a workspace invitation */\n  INVITATION_RECEIVED = \"INVITATION_RECEIVED\",\n  /** System-generated notification */\n  SYSTEM = \"SYSTEM\",\n  /** Task was completed */\n  TASK_COMPLETED = \"TASK_COMPLETED\",\n  /** Task status changed */\n  TASK_STATUS_CHANGED = \"TASK_STATUS_CHANGED\",\n  /** User was added to a workspace */\n  WORKSPACE_ADDED = \"WORKSPACE_ADDED\",\n  /** Project status changed */\n  PROJECT_UPDATED = \"PROJECT_UPDATED\",\n}\n\n/**\n * Resource type enum.\n *\n * Represents the entity type that the notification refers to.\n * Used for polymorphic associations and navigation.\n */\nexport enum ResourceType {\n  /** Notification refers to a task */\n  TASK = \"TASK\",\n  /** Notification refers to a project */\n  PROJECT = \"PROJECT\",\n  /** Notification refers to a workspace */\n  WORKSPACE = \"WORKSPACE\",\n  /** Notification refers to a comment */\n  COMMENT = \"COMMENT\",\n}\n\n/**\n * Properties for creating a Notification entity.\n *\n * Notifications represent messages sent to users about relevant events\n * in their workspace, such as task assignments, mentions, and due dates.\n *\n * @example\n * ```typescript\n * const notification = new Notification({\n *   userId: 'user-123',\n *   type: NotificationType.TASK_ASSIGNED,\n *   title: 'New task assigned',\n *   message: 'You have been assigned to \"Complete documentation\"',\n *   resourceId: 'task-456',\n *   resourceType: ResourceType.TASK\n * });\n * ```\n */\nexport interface NotificationProps extends EntityProps {\n  /**\n   * The ID of the user who will receive this notification.\n   * Required - every notification must have a recipient.\n   */\n  userId: string;\n\n  /**\n   * The type/category of this notification.\n   * Required - determines how the notification is displayed.\n   */\n  type: NotificationType;\n\n  /**\n   * The notification title/headline.\n   * Required - must be between 1 and 200 characters.\n   */\n  title: string;\n\n  /**\n   * Optional detailed message.\n   * If provided, must be between 1 and 1000 characters.\n   */\n  message?: string | null;\n\n  /**\n   * Optional ID of the related resource (task, project, etc.).\n   * Used for navigation and deep linking.\n   */\n  resourceId?: string | null;\n\n  /**\n   * Optional type of the related resource.\n   * Used with resourceId for polymorphic associations.\n   */\n  resourceType?: ResourceType | null;\n\n  /**\n   * Optional metadata for navigation (e.g., workspaceId, projectId).\n   * Stored as JSON in the database.\n   */\n  metadata?: Record<string, unknown> | null;\n\n  /**\n   * Whether the notification has been read by the user.\n   * Defaults to false for new notifications.\n   */\n  isRead?: boolean;\n\n  /**\n   * Timestamp when the notification was marked as read.\n   * Null if the notification is unread.\n   */\n  readAt?: Date | null;\n\n  /**\n   * Timestamp when the notification was created.\n   * Defaults to current time if not provided.\n   */\n  createdAt?: Date;\n\n  /**\n   * Timestamp when the notification was last updated.\n   * Defaults to current time if not provided.\n   */\n  updatedAt?: Date;\n}\n\n/**\n * Represents a notification for a user.\n *\n * Notifications keep users informed about relevant events in their workspace,\n * such as task assignments, mentions, comments, and approaching due dates.\n *\n * ## Business Rules\n *\n * - Title must be between 1 and 200 characters\n * - Message (if provided) must be between 1 and 1000 characters\n * - Every notification must have a recipient (userId)\n * - Every notification must have a type\n * - Notifications are immutable - use business methods to create updated versions\n *\n * ## Immutability\n *\n * All update methods return a new Notification instance.\n * Never modify properties directly.\n *\n * @example\n * ```typescript\n * // Create a new notification\n * const notification = Notification.create({\n *   userId: 'user-123',\n *   type: NotificationType.TASK_ASSIGNED,\n *   title: 'New task assigned',\n *   message: 'You have been assigned to \"Complete documentation\"',\n *   resourceId: 'task-456',\n *   resourceType: ResourceType.TASK,\n *   metadata: { workspaceId: 'ws-789' }\n * });\n *\n * // Mark as read\n * const read = notification.markAsRead();\n * console.log(read.isRead); // true\n * console.log(read.readAt); // Date object\n *\n * // Check if high priority\n * if (notification.isOlderThan(7 * 24 * 60 * 60 * 1000)) {\n *   console.log('This notification is more than a week old');\n * }\n * ```\n *\n * @see {@link ../../shared/constants/limits.constants.ts | NOTIFICATION_LIMITS}\n */\nexport class Notification extends Entity<NotificationProps> {\n  constructor(props: NotificationProps, mode: EntityMode = \"valid\") {\n    super({\n      ...props,\n      isRead: props.isRead ?? false,\n      createdAt: props.createdAt ?? new Date(),\n      updatedAt: props.updatedAt ?? new Date(),\n    }, mode);\n\n    // Validate all properties if not in draft mode\n    if (this.mode === \"valid\") {\n      this.validateUserId(props.userId);\n      this.validateType(props.type);\n      this.validateTitle(props.title);\n      this.validateMessage(props.message);\n      this.validateResourceType(props.resourceType);\n      this.validateMetadata(props.metadata);\n      this.validateResourceId(props.resourceId);\n    }\n  }\n\n  /**\n   * Creates a new notification with defaults applied.\n   *\n   * Factory method for creating notifications without manually\n   * setting id, timestamps, and default values.\n   *\n   * @param props - Notification properties (id, timestamps auto-generated)\n   * @returns A new Notification instance\n   *\n   * @example\n   * ```typescript\n   * const notification = Notification.create({\n   *   userId: 'user-123',\n   *   type: NotificationType.TASK_ASSIGNED,\n   *   title: 'New task assigned',\n   *   message: 'You have been assigned to a new task'\n   * });\n   * ```\n   */\n  static create(\n    props: Omit<NotificationProps, \"id\" | \"isRead\" | \"readAt\" | \"createdAt\" | \"updatedAt\">\n  ): Notification {\n    return new Notification({\n      ...props,\n      isRead: false,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    });\n  }\n\n  // Getters for commonly accessed properties\n  get userId(): string {\n    return this.props.userId;\n  }\n\n  get type(): NotificationType {\n    return this.props.type;\n  }\n\n  get title(): string {\n    return this.props.title;\n  }\n\n  get message(): string | null | undefined {\n    return this.props.message;\n  }\n\n  get resourceId(): string | null | undefined {\n    return this.props.resourceId;\n  }\n\n  get resourceType(): ResourceType | null | undefined {\n    return this.props.resourceType;\n  }\n\n  get metadata(): Record<string, unknown> | null | undefined {\n    return this.props.metadata;\n  }\n\n  get isRead(): boolean {\n    return this.props.isRead ?? false;\n  }\n\n  get readAt(): Date | null | undefined {\n    return this.props.readAt;\n  }\n\n  get createdAt(): Date {\n    return this.props.createdAt ?? new Date();\n  }\n\n  get updatedAt(): Date {\n    return this.props.updatedAt ?? new Date();\n  }\n\n  /**\n   * Marks the notification as read.\n   *\n   * Sets the isRead flag to true and records the read timestamp.\n   * If already read, returns the same notification (idempotent).\n   *\n   * @returns A new Notification instance marked as read\n   *\n   * @example\n   * ```typescript\n   * const notification = Notification.create({ ... });\n   * const read = notification.markAsRead();\n   * console.log(read.isRead); // true\n   * console.log(read.readAt); // Date object\n   * ```\n   */\n  markAsRead(): Notification {\n    if (this.props.isRead === true) {\n      return this; // Already read, return unchanged\n    }\n\n    return this.clone({\n      isRead: true,\n      readAt: new Date(),\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Marks the notification as unread.\n   *\n   * Sets the isRead flag to false and clears the read timestamp.\n   * If already unread, returns the same notification (idempotent).\n   *\n   * @returns A new Notification instance marked as unread\n   *\n   * @example\n   * ```typescript\n   * const readNotification = notification.markAsRead();\n   * const unread = readNotification.markAsUnread();\n   * console.log(unread.isRead); // false\n   * console.log(unread.readAt); // null\n   * ```\n   */\n  markAsUnread(): Notification {\n    if (this.props.isRead === false) {\n      return this; // Already unread, return unchanged\n    }\n\n    return this.clone({\n      isRead: false,\n      readAt: null,\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Checks if the notification is expired.\n   *\n   * Currently returns false as notifications don't have an expiration\n   * timestamp in the base schema. This method is provided for future\n   * extensibility.\n   *\n   * @returns true if the notification is expired, false otherwise\n   *\n   * @example\n   * ```typescript\n   * if (!notification.isExpired()) {\n   *   // Display the notification\n   * }\n   * ```\n   */\n  isExpired(): boolean {\n    // Notifications don't currently have expiration\n    // This method is provided for future extensibility\n    return false;\n  }\n\n  /**\n   * Checks if the notification is high priority.\n   *\n   * High priority notifications include task assignments, mentions,\n   * and due date approaching. These should be displayed more prominently.\n   *\n   * @returns true if the notification is high priority, false otherwise\n   *\n   * @example\n   * ```typescript\n   * if (notification.isHighPriority()) {\n   *   // Show with special styling or sound\n   * }\n   * ```\n   */\n  isHighPriority(): boolean {\n    const highPriorityTypes = [\n      NotificationType.TASK_ASSIGNED,\n      NotificationType.MENTIONED,\n      NotificationType.DUE_DATE_APPROACHING,\n    ];\n    return highPriorityTypes.includes(this.props.type);\n  }\n\n  /**\n   * Checks if the notification has an associated resource.\n   *\n   * Notifications with resources can provide deep links to the\n   * relevant task, project, or other entity.\n   *\n   * @returns true if the notification has a resourceId, false otherwise\n   *\n   * @example\n   * ```typescript\n   * if (notification.isActionable()) {\n   *   // Show \"View\" button that links to the resource\n   * }\n   * ```\n   */\n  isActionable(): boolean {\n    return this.props.resourceId !== null &&\n           this.props.resourceId !== undefined &&\n           this.props.resourceId.length > 0;\n  }\n\n  /**\n   * Gets the age of the notification in milliseconds.\n   *\n   * @returns The age in milliseconds since creation\n   *\n   * @example\n   * ```typescript\n   * const ageInMinutes = notification.getAge() / 60000;\n   * console.log(`Notification is ${ageInMinutes} minutes old`);\n   * ```\n   */\n  getAge(): number {\n    return Date.now() - this.props.createdAt!.getTime();\n  }\n\n  /**\n   * Checks if the notification is older than a specified time.\n   *\n   * Useful for filtering out stale notifications or applying\n   * different display rules based on age.\n   *\n   * @param ms - The age threshold in milliseconds\n   * @returns true if the notification is older than the threshold, false otherwise\n   *\n   * @example\n   * ```typescript\n   * // Check if notification is more than a day old\n   * if (notification.isOlderThan(24 * 60 * 60 * 1000)) {\n   *   console.log('This notification is old');\n   * }\n   * ```\n   */\n  isOlderThan(ms: number): boolean {\n    return this.getAge() > ms;\n  }\n\n  /**\n   * Gets the metadata value for a specific key.\n   *\n   * @param key - The metadata key to retrieve\n   * @param defaultValue - The default value if the key doesn't exist\n   * @returns The metadata value or the default\n   *\n   * @example\n   * ```typescript\n   * const workspaceId = notification.getMetadata('workspaceId', '');\n   * const projectId = notification.getMetadata<string>('projectId');\n   * ```\n   */\n  getMetadata<T = unknown>(key: string, defaultValue?: T): T | undefined {\n    const metadata = this.props.metadata;\n    if (metadata && typeof metadata === \"object\" && key in metadata) {\n      return metadata[key] as T;\n    }\n    return defaultValue;\n  }\n\n  /**\n   * Checks if this is a task-related notification.\n   *\n   * @returns true if the notification refers to a task, false otherwise\n   *\n   * @example\n   * ```typescript\n   * if (notification.isTaskNotification()) {\n   *   console.log('Navigate to task:', notification.resourceId);\n   * }\n   * ```\n   */\n  isTaskNotification(): boolean {\n    return this.props.resourceType === ResourceType.TASK;\n  }\n\n  /**\n   * Checks if this is a project-related notification.\n   *\n   * @returns true if the notification refers to a project, false otherwise\n   *\n   * @example\n   * ```typescript\n   * if (notification.isProjectNotification()) {\n   *   console.log('Navigate to project:', notification.resourceId);\n   * }\n   * ```\n   */\n  isProjectNotification(): boolean {\n    return this.props.resourceType === ResourceType.PROJECT;\n  }\n\n  /**\n   * Checks if this is a workspace-related notification.\n   *\n   * @returns true if the notification refers to a workspace, false otherwise\n   *\n   * @example\n   * ```typescript\n   * if (notification.isWorkspaceNotification()) {\n   *   console.log('Navigate to workspace:', notification.resourceId);\n   * }\n   * ```\n   */\n  isWorkspaceNotification(): boolean {\n    return this.props.resourceType === ResourceType.WORKSPACE;\n  }\n\n  /**\n   * Validates the user ID.\n   *\n   * @private\n   * @param userId - The user ID to validate\n   * @throws {Error} If user ID is invalid\n   */\n  private validateUserId(userId: string): void {\n    if (!userId || typeof userId !== \"string\" || userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n  }\n\n  /**\n   * Validates the notification type.\n   *\n   * @private\n   * @param type - The notification type to validate\n   * @throws {Error} If type is invalid\n   */\n  private validateType(type: NotificationType): void {\n    if (!type || typeof type !== \"string\") {\n      throw new Error(\"Notification type is required\");\n    }\n\n    const validTypes = Object.values(NotificationType);\n    if (!validTypes.includes(type)) {\n      throw new Error(\n        `Invalid notification type. Must be one of: ${validTypes.join(\", \")}`\n      );\n    }\n  }\n\n  /**\n   * Validates the notification title.\n   *\n   * @private\n   * @param title - The title to validate\n   * @throws {Error} If title is invalid\n   */\n  private validateTitle(title: string): void {\n    if (!title || typeof title !== \"string\") {\n      throw new Error(\"Notification title is required\");\n    }\n\n    const trimmed = title.trim();\n    if (trimmed.length === 0) {\n      throw new Error(\"Notification title cannot be empty\");\n    }\n\n    if (trimmed.length < NOTIFICATION_LIMITS.TITLE_MIN_LENGTH) {\n      throw new Error(\n        `Notification title must be at least ${NOTIFICATION_LIMITS.TITLE_MIN_LENGTH} character(s)`\n      );\n    }\n\n    if (trimmed.length > NOTIFICATION_LIMITS.TITLE_MAX_LENGTH) {\n      throw new Error(\n        `Notification title cannot exceed ${NOTIFICATION_LIMITS.TITLE_MAX_LENGTH} characters`\n      );\n    }\n  }\n\n  /**\n   * Validates the notification message.\n   *\n   * @private\n   * @param message - The message to validate (optional)\n   * @throws {Error} If message is invalid\n   */\n  private validateMessage(message?: string | null): void {\n    if (message === undefined || message === null || message === \"\") {\n      return; // Message is optional\n    }\n\n    if (typeof message !== \"string\") {\n      throw new Error(\"Notification message must be a string\");\n    }\n\n    const trimmed = message.trim();\n    if (trimmed.length === 0) {\n      return; // Empty message is treated as no message\n    }\n\n    if (trimmed.length > NOTIFICATION_LIMITS.MESSAGE_MAX_LENGTH) {\n      throw new Error(\n        `Notification message cannot exceed ${NOTIFICATION_LIMITS.MESSAGE_MAX_LENGTH} characters`\n      );\n    }\n  }\n\n  /**\n   * Validates the resource type.\n   *\n   * @private\n   * @param resourceType - The resource type to validate (optional)\n   * @throws {Error} If resource type is invalid\n   */\n  private validateResourceType(resourceType?: ResourceType | null): void {\n    if (resourceType === undefined || resourceType === null) {\n      return; // Optional\n    }\n\n    const validTypes = Object.values(ResourceType);\n    if (!validTypes.includes(resourceType)) {\n      throw new Error(\n        `Invalid resource type. Must be one of: ${validTypes.join(\", \")}`\n      );\n    }\n  }\n\n  /**\n   * Validates the resource ID.\n   *\n   * @private\n   * @param resourceId - The resource ID to validate (optional)\n   * @throws {Error} If resource ID is invalid\n   */\n  private validateResourceId(resourceId?: string | null): void {\n    if (resourceId === undefined || resourceId === null || resourceId === \"\") {\n      return; // Optional\n    }\n\n    if (typeof resourceId !== \"string\") {\n      throw new Error(\"Resource ID must be a string\");\n    }\n\n    if (resourceId.trim().length === 0) {\n      return; // Empty is treated as no resource\n    }\n  }\n\n  /**\n   * Validates the metadata object.\n   *\n   * @private\n   * @param metadata - The metadata to validate (optional)\n   * @throws {Error} If metadata is invalid\n   */\n  private validateMetadata(metadata?: Record<string, unknown> | null): void {\n    if (metadata === undefined || metadata === null) {\n      return; // Optional\n    }\n\n    if (typeof metadata !== \"object\" || Array.isArray(metadata)) {\n      throw new Error(\"Notification metadata must be an object\");\n    }\n  }\n\n  /**\n   * Creates a draft version of this notification.\n   *\n   * Draft mode skips validation, useful for forms before submission.\n   *\n   * @returns A new Notification instance in draft mode\n   *\n   * @example\n   * ```typescript\n   * const draft = notification.asDraft();\n   * // Can now modify without validation\n   * ```\n   */\n  asDraft(): this {\n    return this.clone(this.props, \"draft\");\n  }\n\n  /**\n   * Converts this notification to valid mode.\n   *\n   * Triggers validation of all properties.\n   *\n   * @returns A new Notification instance in valid mode\n   * @throws {Error} If any validation fails\n   *\n   * @example\n   * ```typescript\n   * const draft = new Notification({ title: '' }, 'draft');\n   * const valid = draft.asValid(); // Throws error if title is empty\n   * ```\n   */\n  asValid(): this {\n    return this.clone(this.props, \"valid\");\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Notification, NotificationType, ResourceType } from \"../model/notification.entity\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for creating a new notification.\n *\n * All fields are required unless marked optional.\n */\nexport interface CreateNotificationInput {\n  /**\n   * The ID of the user who will receive this notification.\n   * The user must exist for the notification to be created.\n   */\n  userId: string;\n\n  /**\n   * The type/category of this notification.\n   * Determines how the notification is displayed and grouped.\n   */\n  type: NotificationType;\n\n  /**\n   * The notification title/headline.\n   * Must be between 1 and 200 characters.\n   */\n  title: string;\n\n  /**\n   * Optional detailed message.\n   * If provided, must be between 1 and 1000 characters.\n   */\n  message?: string;\n\n  /**\n   * Optional ID of the related resource (task, project, etc.).\n   * Used for navigation and deep linking.\n   */\n  resourceId?: string;\n\n  /**\n   * Optional type of the related resource.\n   * Used with resourceId for polymorphic associations.\n   */\n  resourceType?: ResourceType;\n\n  /**\n   * Optional metadata for navigation (e.g., workspaceId, projectId).\n   * Stored as JSON in the database.\n   */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Use case for creating a new notification.\n *\n * This use case handles the creation of notifications, which keep\n * users informed about relevant events in their workspace.\n *\n * ## Business Rules\n *\n * - The user must exist (checked via repository)\n * - Title must be between 1 and 200 characters\n * - Message (if provided) must be between 1 and 1000 characters\n * - User ID is required\n * - Type must be a valid NotificationType\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new CreateNotificationUseCase(notificationRepository);\n *\n * const notification = await useCase.execute({\n *   userId: 'user-123',\n *   type: NotificationType.TASK_ASSIGNED,\n *   title: 'New task assigned',\n *   message: 'You have been assigned to \"Complete documentation\"',\n *   resourceId: 'task-456',\n *   resourceType: ResourceType.TASK,\n *   metadata: { workspaceId: 'ws-789' }\n * });\n *\n * console.log(`Notification created: ${notification.id}`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - User ID is missing or invalid\n * - Type is invalid\n * - Title is empty or too long\n * - Message is too long\n * - Repository operations fail\n *\n * @see {@link ../model/notification.entity.ts | Notification entity}\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class CreateNotificationUseCase\n  implements UseCase<CreateNotificationInput, Notification>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the create notification use case.\n   *\n   * Creates a new notification with the provided data.\n   * The notification is validated before being persisted.\n   *\n   * @param input - The notification creation input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the created notification\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const notification = await useCase.execute({\n   *   userId: 'user-123',\n   *   type: NotificationType.COMMENT_ADDED,\n   *   title: 'New comment on your task',\n   *   message: 'Someone commented on your task'\n   * });\n   * ```\n   */\n  async execute(\n    input: CreateNotificationInput,\n    _loggedUser?: unknown,\n  ): Promise<Notification> {\n    // Validate required fields\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    if (!input.type) {\n      throw new Error(\"Notification type is required\");\n    }\n\n    if (!input.title || input.title.trim().length === 0) {\n      throw new Error(\"Notification title is required\");\n    }\n\n    // Trim title\n    const trimmedTitle = input.title.trim();\n\n    // Trim message if provided\n    const trimmedMessage = input.message ? input.message.trim() : undefined;\n\n    // Create the notification entity (validates via entity constructor)\n    const notification = Notification.create({\n      userId: input.userId.trim(),\n      type: input.type,\n      title: trimmedTitle,\n      message: trimmedMessage,\n      resourceId: input.resourceId ?? null,\n      resourceType: input.resourceType ?? null,\n      metadata: input.metadata ?? null,\n    });\n\n    // Persist the notification\n    await this.notificationRepository.create(notification);\n\n    return notification;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Notification } from \"../model/notification.entity\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for marking a notification as read.\n *\n * Both fields are required to ensure the user owns the notification.\n */\nexport interface MarkAsReadInput {\n  /**\n   * The ID of the notification to mark as read.\n   */\n  notificationId: string;\n\n  /**\n   * The ID of the user who owns the notification.\n   * Used to verify ownership before marking as read.\n   */\n  userId: string;\n}\n\n/**\n * Use case for marking a notification as read.\n *\n * This use case handles marking a specific notification as read,\n * which updates the isRead flag and sets the readAt timestamp.\n *\n * ## Business Rules\n *\n * - The notification must exist\n * - The notification must belong to the user\n * - If already read, returns the notification unchanged (idempotent)\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new MarkAsReadUseCase(notificationRepository);\n *\n * const notification = await useCase.execute({\n *   notificationId: 'notif-123',\n *   userId: 'user-456'\n * });\n *\n * console.log(`Notification marked as read at: ${notification.readAt}`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Notification ID is missing\n * - User ID is missing\n * - Notification doesn't exist\n * - User doesn't own the notification\n * - Repository operations fail\n *\n * @see {@link ../model/notification.entity.ts | Notification entity}\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class MarkAsReadUseCase\n  implements UseCase<MarkAsReadInput, Notification>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the mark as read use case.\n   *\n   * Finds the notification, verifies ownership, and marks it as read.\n   *\n   * @param input - The mark as read input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the updated notification\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const notification = await useCase.execute({\n   *   notificationId: 'notif-123',\n   *   userId: 'user-456'\n   * });\n   * console.log(notification.isRead); // true\n   * ```\n   */\n  async execute(\n    input: MarkAsReadInput,\n    _loggedUser?: unknown,\n  ): Promise<Notification> {\n    // Validate required fields\n    if (!input.notificationId || input.notificationId.trim().length === 0) {\n      throw new Error(\"Notification ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Find the notification\n    const notification = await this.notificationRepository.findById(\n      input.notificationId.trim(),\n    );\n\n    if (!notification) {\n      throw new Error(\"Notification not found\");\n    }\n\n    // Verify ownership\n    if (notification.userId !== input.userId.trim()) {\n      throw new Error(\"You do not have permission to mark this notification as read\");\n    }\n\n    // Mark as read (idempotent - no-op if already read)\n    const updated = notification.markAsRead();\n\n    // Persist the update\n    await this.notificationRepository.update(updated);\n\n    return updated;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for marking all notifications as read.\n *\n * Only the user ID is required to mark all of their notifications as read.\n */\nexport interface MarkAllAsReadInput {\n  /**\n   * The ID of the user whose notifications should be marked as read.\n   */\n  userId: string;\n}\n\n/**\n * Output for marking all notifications as read.\n *\n * Contains information about how many notifications were marked as read.\n */\nexport interface MarkAllAsReadOutput {\n  /**\n   * The number of notifications that were marked as read.\n   */\n  count: number;\n}\n\n/**\n * Use case for marking all notifications as read for a user.\n *\n * This use case handles bulk marking all unread notifications as read,\n * which is useful for \"mark all as read\" functionality.\n *\n * ## Business Rules\n *\n * - Only unread notifications for the user are affected\n * - Returns the count of notifications marked as read\n * - More efficient than updating each notification individually\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new MarkAllAsReadUseCase(notificationRepository);\n *\n * const result = await useCase.execute({ userId: 'user-123' });\n *\n * console.log(`Marked ${result.count} notifications as read`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - User ID is missing\n * - Repository operations fail\n *\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class MarkAllAsReadUseCase\n  implements UseCase<MarkAllAsReadInput, MarkAllAsReadOutput>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the mark all as read use case.\n   *\n   * Marks all unread notifications for the user as read.\n   *\n   * @param input - The mark all as read input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the count of notifications marked as read\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const result = await useCase.execute({ userId: 'user-123' });\n   * console.log(`Marked ${result.count} notifications as read`);\n   * ```\n   */\n  async execute(\n    input: MarkAllAsReadInput,\n    _loggedUser?: unknown,\n  ): Promise<MarkAllAsReadOutput> {\n    // Validate required fields\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // First, count unread notifications\n    const unreadCount = await this.notificationRepository.countUnreadByUserId(\n      input.userId.trim(),\n    );\n\n    // Mark all as read via repository bulk operation\n    await this.notificationRepository.markAllAsRead(input.userId.trim());\n\n    return {\n      count: unreadCount,\n    };\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Notification } from \"../model/notification.entity\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for marking a notification as unread.\n *\n * Both fields are required to ensure the user owns the notification.\n */\nexport interface MarkAsUnreadInput {\n  /**\n   * The ID of the notification to mark as unread.\n   */\n  notificationId: string;\n\n  /**\n   * The ID of the user who owns the notification.\n   * Used to verify ownership before marking as unread.\n   */\n  userId: string;\n}\n\n/**\n * Use case for marking a notification as unread.\n *\n * This use case handles marking a specific notification as unread,\n * which updates the isRead flag to false and clears the readAt timestamp.\n *\n * ## Business Rules\n *\n * - The notification must exist\n * - The notification must belong to the user\n * - If already unread, returns the notification unchanged (idempotent)\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new MarkAsUnreadUseCase(notificationRepository);\n *\n * const notification = await useCase.execute({\n *   notificationId: 'notif-123',\n *   userId: 'user-456'\n * });\n *\n * console.log(`Notification marked as unread`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Notification ID is missing\n * - User ID is missing\n * - Notification doesn't exist\n * - User doesn't own the notification\n * - Repository operations fail\n *\n * @see {@link ../model/notification.entity.ts | Notification entity}\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class MarkAsUnreadUseCase\n  implements UseCase<MarkAsUnreadInput, Notification>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the mark as unread use case.\n   *\n   * Finds the notification, verifies ownership, and marks it as unread.\n   *\n   * @param input - The mark as unread input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the updated notification\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const notification = await useCase.execute({\n   *   notificationId: 'notif-123',\n   *   userId: 'user-456'\n   * });\n   * console.log(notification.isRead); // false\n   * ```\n   */\n  async execute(\n    input: MarkAsUnreadInput,\n    _loggedUser?: unknown,\n  ): Promise<Notification> {\n    // Validate required fields\n    if (!input.notificationId || input.notificationId.trim().length === 0) {\n      throw new Error(\"Notification ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Find the notification\n    const notification = await this.notificationRepository.findById(\n      input.notificationId.trim(),\n    );\n\n    if (!notification) {\n      throw new Error(\"Notification not found\");\n    }\n\n    // Verify ownership\n    if (notification.userId !== input.userId.trim()) {\n      throw new Error(\"You do not have permission to mark this notification as unread\");\n    }\n\n    // Mark as unread (idempotent - no-op if already unread)\n    const updated = notification.markAsUnread();\n\n    // Persist the update\n    await this.notificationRepository.update(updated);\n\n    return updated;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Notification } from \"../model/notification.entity\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for getting unread notifications.\n *\n * The user ID is required, and limit is optional for pagination.\n */\nexport interface GetUnreadNotificationsInput {\n  /**\n   * The ID of the user to get unread notifications for.\n   */\n  userId: string;\n\n  /**\n   * Optional limit on the number of notifications to return.\n   * If not specified, returns all unread notifications.\n   */\n  limit?: number;\n}\n\n/**\n * Use case for getting unread notifications for a user.\n *\n * This use case retrieves all unread notifications for a user,\n * ordered by creation time (newest first). High-priority\n * notifications are returned first.\n *\n * ## Business Rules\n *\n * - Only returns notifications belonging to the user\n * - Only returns unread notifications\n * - High-priority notifications (TASK_ASSIGNED, MENTIONED, DUE_DATE_APPROACHING) come first\n * - Results are ordered by creation time (newest first within each priority level)\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetUnreadNotificationsUseCase(notificationRepository);\n *\n * const notifications = await useCase.execute({\n *   userId: 'user-123',\n *   limit: 20\n * });\n *\n * console.log(`Found ${notifications.length} unread notifications`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - User ID is missing\n * - Repository operations fail\n *\n * @see {@link ../model/notification.entity.ts | Notification entity}\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class GetUnreadNotificationsUseCase\n  implements UseCase<GetUnreadNotificationsInput, Notification[]>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the get unread notifications use case.\n   *\n   * Retrieves all unread notifications for the user, ordered by\n   * priority and creation time.\n   *\n   * @param input - The get unread notifications input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to an array of unread notifications\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const notifications = await useCase.execute({\n   *   userId: 'user-123'\n   * });\n   *\n   * notifications.forEach(n => {\n   *   console.log(`${n.type}: ${n.title}`);\n   * });\n   * ```\n   */\n  async execute(\n    input: GetUnreadNotificationsInput,\n    _loggedUser?: unknown,\n  ): Promise<Notification[]> {\n    // Validate required fields\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    const userId = input.userId.trim();\n\n    // Get all unread notifications\n    const unreadNotifications =\n      await this.notificationRepository.findUnreadByUserId(userId);\n\n    // Sort by priority (high first) then by creation time (newest first)\n    const sorted = unreadNotifications.sort((a, b) => {\n      // High priority first\n      const aHighPriority = a.isHighPriority();\n      const bHighPriority = b.isHighPriority();\n\n      if (aHighPriority && !bHighPriority) return -1;\n      if (!aHighPriority && bHighPriority) return 1;\n\n      // Same priority, sort by creation time (newest first)\n      return b.createdAt.getTime() - a.createdAt.getTime();\n    });\n\n    // Apply limit if specified (including 0 to return empty)\n    if (input.limit !== undefined) {\n      if (input.limit <= 0) {\n        return [];\n      }\n      return sorted.slice(0, input.limit);\n    }\n\n    return sorted;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Notification } from \"../model/notification.entity\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for getting a notification by ID.\n *\n * Both fields are required to ensure the user owns the notification.\n */\nexport interface GetNotificationByIdInput {\n  /**\n   * The ID of the notification to retrieve.\n   */\n  notificationId: string;\n\n  /**\n   * The ID of the user requesting the notification.\n   * Used to verify ownership before returning the notification.\n   */\n  userId: string;\n}\n\n/**\n * Use case for getting a specific notification by ID.\n *\n * This use case retrieves a single notification and verifies\n * that the requesting user owns the notification.\n *\n * ## Business Rules\n *\n * - The notification must exist\n * - The notification must belong to the user\n * - Returns null if notification doesn't exist or user doesn't own it\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetNotificationByIdUseCase(notificationRepository);\n *\n * const notification = await useCase.execute({\n *   notificationId: 'notif-123',\n *   userId: 'user-456'\n * });\n *\n * if (notification) {\n *   console.log(`Found: ${notification.title}`);\n * } else {\n *   console.log('Notification not found');\n * }\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Notification ID is missing\n * - User ID is missing\n * - Repository operations fail\n *\n * Returns null if the notification doesn't exist or user doesn't own it.\n *\n * @see {@link ../model/notification.entity.ts | Notification entity}\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class GetNotificationByIdUseCase\n  implements UseCase<GetNotificationByIdInput, Notification | null>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the get notification by ID use case.\n   *\n   * Finds the notification and verifies ownership before returning it.\n   *\n   * @param input - The get notification by ID input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the notification if found and owned by user, null otherwise\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const notification = await useCase.execute({\n   *   notificationId: 'notif-123',\n   *   userId: 'user-456'\n   * });\n   *\n   * if (notification) {\n   *   console.log(notification.title);\n   * }\n   * ```\n   */\n  async execute(\n    input: GetNotificationByIdInput,\n    _loggedUser?: unknown,\n  ): Promise<Notification | null> {\n    // Validate required fields\n    if (!input.notificationId || input.notificationId.trim().length === 0) {\n      throw new Error(\"Notification ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Find the notification\n    const notification = await this.notificationRepository.findById(\n      input.notificationId.trim(),\n    );\n\n    // Verify ownership\n    if (!notification || notification.userId !== input.userId.trim()) {\n      return null;\n    }\n\n    return notification;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { Notification, NotificationType } from \"../model/notification.entity\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for getting notifications by type.\n *\n * The user ID and type are required.\n */\nexport interface GetNotificationsByTypeInput {\n  /**\n   * The ID of the user to get notifications for.\n   */\n  userId: string;\n\n  /**\n   * The notification type to filter by.\n   */\n  type: NotificationType;\n}\n\n/**\n * Use case for getting notifications of a specific type for a user.\n *\n * This use case retrieves all notifications of a specific type\n * for a user, useful for filtering and grouping notifications.\n *\n * ## Business Rules\n *\n * - Only returns notifications belonging to the user\n * - Only returns notifications of the specified type\n * - Results are ordered by creation time (newest first)\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new GetNotificationsByTypeUseCase(notificationRepository);\n *\n * const notifications = await useCase.execute({\n *   userId: 'user-123',\n *   type: NotificationType.TASK_ASSIGNED\n * });\n *\n * console.log(`Found ${notifications.length} task assignment notifications`);\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - User ID is missing\n * - Type is missing\n * - Repository operations fail\n *\n * @see {@link ../model/notification.entity.ts | Notification entity}\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class GetNotificationsByTypeUseCase\n  implements UseCase<GetNotificationsByTypeInput, Notification[]>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the get notifications by type use case.\n   *\n   * Retrieves all notifications of the specified type for the user.\n   *\n   * @param input - The get notifications by type input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to an array of notifications of the specified type\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const notifications = await useCase.execute({\n   *   userId: 'user-123',\n   *   type: NotificationType.COMMENT_ADDED\n   * });\n   *\n   * notifications.forEach(n => {\n   *   console.log(`${n.title}: ${n.message}`);\n   * });\n   * ```\n   */\n  async execute(\n    input: GetNotificationsByTypeInput,\n    _loggedUser?: unknown,\n  ): Promise<Notification[]> {\n    // Validate required fields\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    if (!input.type) {\n      throw new Error(\"Notification type is required\");\n    }\n\n    // Get notifications by type\n    const notifications = await this.notificationRepository.findByType(\n      input.userId.trim(),\n      input.type,\n    );\n\n    return notifications;\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for deleting a notification.\n *\n * Both fields are required to ensure the user owns the notification.\n */\nexport interface DeleteNotificationInput {\n  /**\n   * The ID of the notification to delete.\n   */\n  notificationId: string;\n\n  /**\n   * The ID of the user who owns the notification.\n   * Used to verify ownership before deletion.\n   */\n  userId: string;\n}\n\n/**\n * Use case for deleting a notification.\n *\n * This use case handles permanent deletion of a notification,\n * after verifying that the user owns it.\n *\n * ## Business Rules\n *\n * - The notification must exist\n * - The notification must belong to the user\n * - Deletion is permanent and cannot be undone\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new DeleteNotificationUseCase(notificationRepository);\n *\n * await useCase.execute({\n *   notificationId: 'notif-123',\n *   userId: 'user-456'\n * });\n *\n * console.log('Notification deleted');\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - Notification ID is missing\n * - User ID is missing\n * - Notification doesn't exist\n * - User doesn't own the notification\n * - Repository operations fail\n *\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class DeleteNotificationUseCase implements UseCase<DeleteNotificationInput, void> {\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the delete notification use case.\n   *\n   * Finds the notification, verifies ownership, and deletes it permanently.\n   *\n   * @param input - The delete notification input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving when the deletion is complete\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * await useCase.execute({\n   *   notificationId: 'notif-123',\n   *   userId: 'user-456'\n   * });\n   * ```\n   */\n  async execute(\n    input: DeleteNotificationInput,\n    _loggedUser?: unknown,\n  ): Promise<void> {\n    // Validate required fields\n    if (!input.notificationId || input.notificationId.trim().length === 0) {\n      throw new Error(\"Notification ID is required\");\n    }\n\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Find the notification\n    const notification = await this.notificationRepository.findById(\n      input.notificationId.trim(),\n    );\n\n    if (!notification) {\n      throw new Error(\"Notification not found\");\n    }\n\n    // Verify ownership\n    if (notification.userId !== input.userId.trim()) {\n      throw new Error(\"You do not have permission to delete this notification\");\n    }\n\n    // Delete the notification\n    await this.notificationRepository.delete(input.notificationId.trim());\n  }\n}\n","import { UseCase } from \"../../shared/use-case\";\nimport { NotificationRepository } from \"../provider/notification.repository\";\n\n/**\n * Input for counting unread notifications.\n *\n * Only the user ID is required to count their unread notifications.\n */\nexport interface CountUnreadNotificationsInput {\n  /**\n   * The ID of the user to count unread notifications for.\n   */\n  userId: string;\n}\n\n/**\n * Output for counting unread notifications.\n *\n * Contains the count of unread notifications.\n */\nexport interface CountUnreadNotificationsOutput {\n  /**\n   * The number of unread notifications for the user.\n   */\n  count: number;\n}\n\n/**\n * Use case for counting unread notifications for a user.\n *\n * This use case provides the count of unread notifications,\n * useful for displaying notification badges.\n *\n * ## Business Rules\n *\n * - Only counts notifications belonging to the user\n * - Only counts unread notifications\n * - More efficient than fetching all notifications\n *\n * ## Example Usage\n *\n * ```typescript\n * const useCase = new CountUnreadNotificationsUseCase(notificationRepository);\n *\n * const result = await useCase.execute({ userId: 'user-123' });\n *\n * console.log(`User has ${result.count} unread notifications`);\n *\n * // Display badge\n * if (result.count > 0) {\n *   showBadge(result.count);\n * }\n * ```\n *\n * ## Error Handling\n *\n * Throws errors if:\n * - User ID is missing\n * - Repository operations fail\n *\n * @see {@link ../provider/notification.repository.ts | NotificationRepository}\n */\nexport class CountUnreadNotificationsUseCase\n  implements UseCase<CountUnreadNotificationsInput, CountUnreadNotificationsOutput>\n{\n  constructor(private readonly notificationRepository: NotificationRepository) {}\n\n  /**\n   * Executes the count unread notifications use case.\n   *\n   * Counts all unread notifications for the user.\n   *\n   * @param input - The count unread notifications input data\n   * @param _loggedUser - Optional logged user context (not used in this use case)\n   * @returns Promise resolving to the count of unread notifications\n   * @throws {Error} If validation fails or repository operation fails\n   *\n   * @example\n   * ```typescript\n   * const result = await useCase.execute({ userId: 'user-123' });\n   * console.log(`Unread count: ${result.count}`);\n   * ```\n   */\n  async execute(\n    input: CountUnreadNotificationsInput,\n    _loggedUser?: unknown,\n  ): Promise<CountUnreadNotificationsOutput> {\n    // Validate required fields\n    if (!input.userId || input.userId.trim().length === 0) {\n      throw new Error(\"User ID is required\");\n    }\n\n    // Count unread notifications\n    const count = await this.notificationRepository.countUnreadByUserId(\n      input.userId.trim(),\n    );\n\n    return {\n      count,\n    };\n  }\n}\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Type of changelog entry\r\n */\r\nexport type ChangelogType = \"NEW\" | \"IMPROVED\" | \"FIXED\" | \"REMOVED\";\r\n\r\n/**\r\n * Props for ChangelogEntry entity\r\n */\r\nexport interface ChangelogEntryProps extends EntityProps {\r\n    version?: string;\r\n    title: string;\r\n    content: string;\r\n    type: ChangelogType;\r\n    publishedAt: Date;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\n/**\r\n * ChangelogEntry domain entity\r\n * \r\n * Represents a changelog entry for the application's release notes.\r\n */\r\nexport class ChangelogEntry extends Entity<ChangelogEntryProps> {\r\n    constructor(props: ChangelogEntryProps) {\r\n        super({\r\n            ...props,\r\n            type: props.type ?? \"NEW\",\r\n            publishedAt: props.publishedAt ?? new Date(),\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new changelog entry\r\n     */\r\n    static create(\r\n        props: Omit<ChangelogEntryProps, \"id\" | \"createdAt\" | \"updatedAt\">\r\n    ): ChangelogEntry {\r\n        return new ChangelogEntry({\r\n            ...props,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get version(): string | undefined {\r\n        return this.props.version;\r\n    }\r\n\r\n    get title(): string {\r\n        return this.props.title;\r\n    }\r\n\r\n    get content(): string {\r\n        return this.props.content;\r\n    }\r\n\r\n    get type(): ChangelogType {\r\n        return this.props.type;\r\n    }\r\n\r\n    get publishedAt(): Date {\r\n        return this.props.publishedAt;\r\n    }\r\n\r\n    get createdAt(): Date {\r\n        return this.props.createdAt!;\r\n    }\r\n\r\n    get updatedAt(): Date {\r\n        return this.props.updatedAt!;\r\n    }\r\n\r\n    /**\r\n     * Check if entry is published\r\n     */\r\n    isPublished(): boolean {\r\n        return this.props.publishedAt <= new Date();\r\n    }\r\n\r\n    /**\r\n     * Check if entry is a new feature\r\n     */\r\n    isNewFeature(): boolean {\r\n        return this.props.type === \"NEW\";\r\n    }\r\n\r\n    /**\r\n     * Check if entry is a fix\r\n     */\r\n    isFix(): boolean {\r\n        return this.props.type === \"FIXED\";\r\n    }\r\n\r\n    /**\r\n     * Update changelog entry\r\n     */\r\n    update(\r\n        props: Partial<Omit<ChangelogEntryProps, \"id\" | \"createdAt\">>\r\n    ): ChangelogEntry {\r\n        return this.clone({\r\n            ...props,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Publish the entry\r\n     */\r\n    publish(): ChangelogEntry {\r\n        return this.clone({\r\n            publishedAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Props for NewsletterSubscriber entity\r\n */\r\nexport interface NewsletterSubscriberProps extends EntityProps {\r\n    email: string;\r\n    active: boolean;\r\n    userId?: string;\r\n    createdAt?: Date;\r\n}\r\n\r\n/**\r\n * NewsletterSubscriber domain entity\r\n * \r\n * Represents a subscriber to the newsletter.\r\n */\r\nexport class NewsletterSubscriber extends Entity<NewsletterSubscriberProps> {\r\n    constructor(props: NewsletterSubscriberProps) {\r\n        super({\r\n            ...props,\r\n            active: props.active ?? true,\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new newsletter subscriber\r\n     */\r\n    static create(\r\n        props: Omit<NewsletterSubscriberProps, \"id\" | \"createdAt\" | \"active\">\r\n    ): NewsletterSubscriber {\r\n        return new NewsletterSubscriber({\r\n            ...props,\r\n            active: true,\r\n            createdAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get email(): string {\r\n        return this.props.email;\r\n    }\r\n\r\n    get active(): boolean {\r\n        return this.props.active;\r\n    }\r\n\r\n    get userId(): string | undefined {\r\n        return this.props.userId;\r\n    }\r\n\r\n    get createdAt(): Date {\r\n        return this.props.createdAt!;\r\n    }\r\n\r\n    /**\r\n     * Check if subscription is active\r\n     */\r\n    isActive(): boolean {\r\n        return this.props.active;\r\n    }\r\n\r\n    /**\r\n     * Subscribe (activate)\r\n     */\r\n    subscribe(): NewsletterSubscriber {\r\n        return this.clone({ active: true });\r\n    }\r\n\r\n    /**\r\n     * Unsubscribe (deactivate)\r\n     */\r\n    unsubscribe(): NewsletterSubscriber {\r\n        return this.clone({ active: false });\r\n    }\r\n\r\n    /**\r\n     * Link to user account\r\n     */\r\n    linkToUser(userId: string): NewsletterSubscriber {\r\n        return this.clone({ userId });\r\n    }\r\n\r\n    /**\r\n     * Update email\r\n     */\r\n    updateEmail(email: string): NewsletterSubscriber {\r\n        return this.clone({ email });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Props for ContactSubmission entity\r\n */\r\nexport interface ContactSubmissionProps extends EntityProps {\r\n    name: string;\r\n    email: string;\r\n    subject: string;\r\n    message: string;\r\n    read: boolean;\r\n    createdAt?: Date;\r\n}\r\n\r\n/**\r\n * ContactSubmission domain entity\r\n * \r\n * Represents a contact form submission from a user.\r\n */\r\nexport class ContactSubmission extends Entity<ContactSubmissionProps> {\r\n    constructor(props: ContactSubmissionProps) {\r\n        super({\r\n            ...props,\r\n            read: props.read ?? false,\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new contact submission\r\n     */\r\n    static create(\r\n        props: Omit<ContactSubmissionProps, \"id\" | \"createdAt\" | \"read\">\r\n    ): ContactSubmission {\r\n        return new ContactSubmission({\r\n            ...props,\r\n            read: false,\r\n            createdAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get name(): string {\r\n        return this.props.name;\r\n    }\r\n\r\n    get email(): string {\r\n        return this.props.email;\r\n    }\r\n\r\n    get subject(): string {\r\n        return this.props.subject;\r\n    }\r\n\r\n    get message(): string {\r\n        return this.props.message;\r\n    }\r\n\r\n    get read(): boolean {\r\n        return this.props.read;\r\n    }\r\n\r\n    get createdAt(): Date {\r\n        return this.props.createdAt!;\r\n    }\r\n\r\n    /**\r\n     * Check if submission has been read\r\n     */\r\n    isRead(): boolean {\r\n        return this.props.read;\r\n    }\r\n\r\n    /**\r\n     * Mark as read\r\n     */\r\n    markAsRead(): ContactSubmission {\r\n        return this.clone({ read: true });\r\n    }\r\n\r\n    /**\r\n     * Mark as unread\r\n     */\r\n    markAsUnread(): ContactSubmission {\r\n        return this.clone({ read: false });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Status of a roadmap item\r\n */\r\nexport type RoadmapStatus =\r\n    | \"CONSIDERING\"\r\n    | \"PLANNED\"\r\n    | \"IN_PROGRESS\"\r\n    | \"COMPLETED\"\r\n    | \"DECLINED\";\r\n\r\n/**\r\n * Props for RoadmapItem entity\r\n */\r\nexport interface RoadmapItemProps extends EntityProps {\r\n    title: string;\r\n    description: string;\r\n    status: RoadmapStatus;\r\n    totalVotes: number;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\n/**\r\n * RoadmapItem domain entity\r\n * \r\n * Represents a feature request or improvement on the roadmap.\r\n */\r\nexport class RoadmapItem extends Entity<RoadmapItemProps> {\r\n    constructor(props: RoadmapItemProps) {\r\n        super({\r\n            ...props,\r\n            status: props.status ?? \"CONSIDERING\",\r\n            totalVotes: props.totalVotes ?? 0,\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new roadmap item\r\n     */\r\n    static create(\r\n        props: Omit<RoadmapItemProps, \"id\" | \"createdAt\" | \"updatedAt\" | \"status\" | \"totalVotes\">\r\n    ): RoadmapItem {\r\n        return new RoadmapItem({\r\n            ...props,\r\n            status: \"CONSIDERING\",\r\n            totalVotes: 0,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get title(): string {\r\n        return this.props.title;\r\n    }\r\n\r\n    get description(): string {\r\n        return this.props.description;\r\n    }\r\n\r\n    get status(): RoadmapStatus {\r\n        return this.props.status;\r\n    }\r\n\r\n    get totalVotes(): number {\r\n        return this.props.totalVotes;\r\n    }\r\n\r\n    get createdAt(): Date {\r\n        return this.props.createdAt!;\r\n    }\r\n\r\n    get updatedAt(): Date {\r\n        return this.props.updatedAt!;\r\n    }\r\n\r\n    /**\r\n     * Check if item is being considered\r\n     */\r\n    isConsidering(): boolean {\r\n        return this.props.status === \"CONSIDERING\";\r\n    }\r\n\r\n    /**\r\n     * Check if item is planned\r\n     */\r\n    isPlanned(): boolean {\r\n        return this.props.status === \"PLANNED\";\r\n    }\r\n\r\n    /**\r\n     * Check if item is in progress\r\n     */\r\n    isInProgress(): boolean {\r\n        return this.props.status === \"IN_PROGRESS\";\r\n    }\r\n\r\n    /**\r\n     * Check if item is completed\r\n     */\r\n    isCompleted(): boolean {\r\n        return this.props.status === \"COMPLETED\";\r\n    }\r\n\r\n    /**\r\n     * Update status\r\n     */\r\n    updateStatus(status: RoadmapStatus): RoadmapItem {\r\n        return this.clone({\r\n            status,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Increment votes\r\n     */\r\n    incrementVotes(weight: number): RoadmapItem {\r\n        return this.clone({\r\n            totalVotes: this.props.totalVotes + weight,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Decrement votes\r\n     */\r\n    decrementVotes(weight: number): RoadmapItem {\r\n        return this.clone({\r\n            totalVotes: Math.max(0, this.props.totalVotes - weight),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Props for RoadmapVote entity\r\n */\r\nexport interface RoadmapVoteProps extends EntityProps {\r\n    itemId: string;\r\n    userId: string;\r\n    weight: number;\r\n    createdAt?: Date;\r\n}\r\n\r\n/**\r\n * RoadmapVote domain entity\r\n * \r\n * Represents a user's vote on a roadmap item.\r\n * Weight is determined by subscription tier.\r\n */\r\nexport class RoadmapVote extends Entity<RoadmapVoteProps> {\r\n    constructor(props: RoadmapVoteProps) {\r\n        super({\r\n            ...props,\r\n            weight: props.weight ?? 1,\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new roadmap vote\r\n     */\r\n    static create(\r\n        props: Omit<RoadmapVoteProps, \"id\" | \"createdAt\">\r\n    ): RoadmapVote {\r\n        return new RoadmapVote({\r\n            ...props,\r\n            createdAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get itemId(): string {\r\n        return this.props.itemId;\r\n    }\r\n\r\n    get userId(): string {\r\n        return this.props.userId;\r\n    }\r\n\r\n    get weight(): number {\r\n        return this.props.weight;\r\n    }\r\n\r\n    get createdAt(): Date {\r\n        return this.props.createdAt!;\r\n    }\r\n}\r\n\r\n/**\r\n * Calculate vote weight based on subscription plan\r\n */\r\nexport function calculateVoteWeight(plan?: string): number {\r\n    switch (plan) {\r\n        case \"PRO\":\r\n            return 3;\r\n        case \"TEAM\":\r\n            return 5;\r\n        case \"ENTERPRISE\":\r\n            return 10;\r\n        default:\r\n            return 1;\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Props for BlogPost entity\r\n */\r\nexport interface BlogPostProps extends EntityProps {\r\n    slug: string;\r\n    title: string;\r\n    excerpt?: string;\r\n    content: string;\r\n    coverImage?: string;\r\n    published: boolean;\r\n    publishedAt?: Date;\r\n    metaTitle?: string;\r\n    metaDescription?: string;\r\n    author?: string;\r\n    category?: string;\r\n    tags: string[];\r\n    readTime?: number;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\n/**\r\n * BlogPost domain entity\r\n */\r\nexport class BlogPost extends Entity<BlogPostProps> {\r\n    constructor(props: BlogPostProps) {\r\n        super({\r\n            ...props,\r\n            published: props.published ?? false,\r\n            tags: props.tags ?? [],\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new blog post\r\n     */\r\n    static create(\r\n        props: Omit<BlogPostProps, \"id\" | \"createdAt\" | \"updatedAt\" | \"published\" | \"publishedAt\">\r\n    ): BlogPost {\r\n        return new BlogPost({\r\n            ...props,\r\n            published: false,\r\n            tags: props.tags ?? [],\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get slug(): string {\r\n        return this.props.slug;\r\n    }\r\n\r\n    get title(): string {\r\n        return this.props.title;\r\n    }\r\n\r\n    get content(): string {\r\n        return this.props.content;\r\n    }\r\n\r\n    get published(): boolean {\r\n        return this.props.published;\r\n    }\r\n\r\n    /**\r\n     * Publish the post\r\n     */\r\n    publish(): BlogPost {\r\n        return this.clone({\r\n            published: true,\r\n            publishedAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Unpublish the post\r\n     */\r\n    unpublish(): BlogPost {\r\n        return this.clone({\r\n            published: false,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Props for BlogComment entity\r\n */\r\nexport interface BlogCommentProps extends EntityProps {\r\n    content: string;\r\n    userId: string;\r\n    postId: string;\r\n    createdAt?: Date;\r\n}\r\n\r\n/**\r\n * BlogComment domain entity\r\n */\r\nexport class BlogComment extends Entity<BlogCommentProps> {\r\n    constructor(props: BlogCommentProps) {\r\n        super({\r\n            ...props,\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new blog comment\r\n     */\r\n    static create(\r\n        props: Omit<BlogCommentProps, \"id\" | \"createdAt\">\r\n    ): BlogComment {\r\n        return new BlogComment({\r\n            ...props,\r\n            createdAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get content(): string {\r\n        return this.props.content;\r\n    }\r\n\r\n    get userId(): string {\r\n        return this.props.userId;\r\n    }\r\n\r\n    get postId(): string {\r\n        return this.props.postId;\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Props for Achievement entity\r\n */\r\nexport interface AchievementProps extends EntityProps {\r\n    code: string;\r\n    name: string;\r\n    description: string;\r\n    icon: string;\r\n    xpReward: number;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\n/**\r\n * Achievement domain entity\r\n */\r\nexport class Achievement extends Entity<AchievementProps> {\r\n    constructor(props: AchievementProps) {\r\n        super({\r\n            ...props,\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new achievement\r\n     */\r\n    static create(\r\n        props: Omit<AchievementProps, \"id\" | \"createdAt\" | \"updatedAt\">\r\n    ): Achievement {\r\n        return new Achievement({\r\n            ...props,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get code(): string {\r\n        return this.props.code;\r\n    }\r\n\r\n    get name(): string {\r\n        return this.props.name;\r\n    }\r\n\r\n    get description(): string {\r\n        return this.props.description;\r\n    }\r\n\r\n    get icon(): string {\r\n        return this.props.icon;\r\n    }\r\n\r\n    get xpReward(): number {\r\n        return this.props.xpReward;\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\n/**\r\n * Props for UserAchievement entity\r\n */\r\nexport interface UserAchievementProps extends EntityProps {\r\n    userId: string;\r\n    achievementId: string;\r\n    unlockedAt?: Date;\r\n}\r\n\r\n/**\r\n * UserAchievement domain entity\r\n */\r\nexport class UserAchievement extends Entity<UserAchievementProps> {\r\n    constructor(props: UserAchievementProps) {\r\n        super({\r\n            ...props,\r\n            unlockedAt: props.unlockedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create/Unlock an achievement for a user\r\n     */\r\n    static create(\r\n        props: Omit<UserAchievementProps, \"id\" | \"unlockedAt\">\r\n    ): UserAchievement {\r\n        return new UserAchievement({\r\n            ...props,\r\n            unlockedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get userId(): string {\r\n        return this.props.userId;\r\n    }\r\n\r\n    get achievementId(): string {\r\n        return this.props.achievementId;\r\n    }\r\n\r\n    get unlockedAt(): Date {\r\n        return this.props.unlockedAt!;\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\nimport { ChatMessage } from \"./chat-message.entity\";\r\n\r\n/**\r\n * Props for ChatConversation entity\r\n */\r\nexport interface ChatConversationProps extends EntityProps {\r\n    userId: string;\r\n    title?: string;\r\n    context?: any;\r\n    isArchived: boolean;\r\n    archivedAt?: Date;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n    // We don't necessarily need to store all messages in the aggregate if they are too many,\r\n    // but having a list of recent ones or just the metadata is common.\r\n    messages?: ChatMessage[];\r\n}\r\n\r\n/**\r\n * ChatConversation domain entity\r\n */\r\nexport class ChatConversation extends Entity<ChatConversationProps> {\r\n    constructor(props: ChatConversationProps) {\r\n        super({\r\n            ...props,\r\n            isArchived: props.isArchived ?? false,\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new chat conversation\r\n     */\r\n    static create(\r\n        props: Omit<ChatConversationProps, \"id\" | \"createdAt\" | \"updatedAt\" | \"isArchived\" | \"archivedAt\">\r\n    ): ChatConversation {\r\n        return new ChatConversation({\r\n            ...props,\r\n            isArchived: false,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get userId(): string {\r\n        return this.props.userId;\r\n    }\r\n\r\n    get title(): string | undefined {\r\n        return this.props.title;\r\n    }\r\n\r\n    get isArchived(): boolean {\r\n        return this.props.isArchived;\r\n    }\r\n\r\n    /**\r\n     * Archive the conversation\r\n     */\r\n    archive(): ChatConversation {\r\n        return this.clone({\r\n            isArchived: true,\r\n            archivedAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update title\r\n     */\r\n    updateTitle(title: string): ChatConversation {\r\n        return this.clone({\r\n            title,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\n\r\nexport type ChatRole = 'USER' | 'ASSISTANT' | 'SYSTEM';\r\n\r\n/**\r\n * Props for ChatMessage entity\r\n */\r\nexport interface ChatMessageProps extends EntityProps {\r\n    conversationId: string;\r\n    role: ChatRole;\r\n    content: string;\r\n    metadata?: any;\r\n    createdAt?: Date;\r\n}\r\n\r\n/**\r\n * ChatMessage domain entity\r\n */\r\nexport class ChatMessage extends Entity<ChatMessageProps> {\r\n    constructor(props: ChatMessageProps) {\r\n        super({\r\n            ...props,\r\n            createdAt: props.createdAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new chat message\r\n     */\r\n    static create(\r\n        props: Omit<ChatMessageProps, \"id\" | \"createdAt\">\r\n    ): ChatMessage {\r\n        return new ChatMessage({\r\n            ...props,\r\n            createdAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get conversationId(): string {\r\n        return this.props.conversationId;\r\n    }\r\n\r\n    get role(): ChatRole {\r\n        return this.props.role;\r\n    }\r\n\r\n    get content(): string {\r\n        return this.props.content;\r\n    }\r\n\r\n    get metadata(): any {\r\n        return this.props.metadata;\r\n    }\r\n\r\n    get createdAt(): Date {\r\n        return this.props.createdAt!;\r\n    }\r\n}\r\n","import { Entity, EntityProps } from \"../../shared/entity\";\r\nimport { TaskPriority } from \"../../tasks/model/task.entity\";\r\n\r\n\r\n/**\r\n * Props for TaskTemplate entity\r\n */\r\nexport interface TaskTemplateProps extends EntityProps {\r\n    name: string;\r\n    description?: string;\r\n    icon?: string;\r\n    titlePattern?: string;\r\n    defaultPriority: TaskPriority;\r\n    defaultEstimatedMinutes?: number;\r\n    defaultDescription?: string;\r\n    defaultTags?: string[];\r\n    workspaceId: string;\r\n    isPublic: boolean;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\n/**\r\n * TaskTemplate domain entity\r\n */\r\nexport class TaskTemplate extends Entity<TaskTemplateProps> {\r\n    constructor(props: TaskTemplateProps) {\r\n        super({\r\n            ...props,\r\n            isPublic: props.isPublic ?? true,\r\n            createdAt: props.createdAt ?? new Date(),\r\n            updatedAt: props.updatedAt ?? new Date(),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new task template\r\n     */\r\n    static create(\r\n        props: Omit<TaskTemplateProps, \"id\" | \"createdAt\" | \"updatedAt\">\r\n    ): TaskTemplate {\r\n        return new TaskTemplate({\r\n            ...props,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n\r\n    get name(): string {\r\n        return this.props.name;\r\n    }\r\n\r\n    get description(): string | undefined {\r\n        return this.props.description;\r\n    }\r\n\r\n    get workspaceId(): string {\r\n        return this.props.workspaceId;\r\n    }\r\n\r\n    get isPublic(): boolean {\r\n        return this.props.isPublic;\r\n    }\r\n\r\n    /**\r\n     * Update template details\r\n     */\r\n    update(props: Partial<Omit<TaskTemplateProps, \"id\" | \"workspaceId\" | \"createdAt\" | \"updatedAt\">>): TaskTemplate {\r\n        return this.clone({\r\n            ...props,\r\n            updatedAt: new Date(),\r\n        });\r\n    }\r\n}\r\n"],"mappings":"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","names":["Email","_Email","value","email","finalEmail","localPart","domainPart","other","HashPassword","_HashPassword","value","hashPassword","trimmedHash","other","PersonName","_PersonName","value","name","trimmedName","part","parts","nameParts","other","uuidv4","isUuid","Id","_Id","value","id","other","Entity","_Entity","props","mode","Id","entity","other","newProps","newMode","Self","RequiredString","_RequiredString","value","options","errorMessage","trimmedValue","other","PROJECT_COLORS","TAG_COLORS","WORKSPACE_COLORS","TASK_PRIORITIES","PRIORITY_VALUES","getPriorityConfig","priority","getPriorityColor","getPriorityLabel","TASK_STATUS","TASK_STATUS_VALUES","PROJECT_STATUS","PROJECT_STATUS_VALUES","getTaskStatusConfig","status","getTaskStatusColor","getTaskStatusLabel","isTaskCompleted","isTaskInProgress","TIMER_MODES","TIMER_MODE_VALUES","DEFAULT_POMODORO_SETTINGS","TIMER_LIMITS","getTimerModeConfig","mode","getTimerModeColor","getTimerModeLabel","getTimerModeDefaultDuration","shouldTakeLongBreak","completedPomodoros","pomodorosUntilLongBreak","TASK_LIMITS","PROJECT_LIMITS","WORKSPACE_LIMITS","TAG_LIMITS","COMMENT_LIMITS","FILE_LIMITS","USER_LIMITS","PAGINATION_LIMITS","formatFileSize","bytes","k","sizes","i","isAllowedFileType","mimeType","isImageFile","NOTIFICATION_LIMITS","formatDate","date","locale","formatDateShort","formatRelativeTime","d","now","diffMs","diffSec","diffMin","diffHour","diffDay","isToday","today","isPast","isFuture","isOverdue","dueDate","getDaysDiff","date1","date2","d1","startOfDay","endOfDay","startOfWeek","day","diff","startDate","endOfWeek","endDate","addDays","days","addHours","hours","addMinutes","minutes","startOfToday","isBefore","d2","isAfter","isTaskAvailable","task","isScheduledForToday","isDueToday","categorizeTasksByAvailability","tasks","getWorkableTasks","t","formatScheduledDateTime","scheduledDate","scheduledTime","dateStr","formatDuration","minutes","hours","mins","formatDurationFromSeconds","seconds","secs","parts","formatTimerDisplay","formatTimerDisplayExtended","minutesToHours","hoursToMinutes","secondsToMinutes","minutesToSeconds","parseDuration","duration","hourMatch","minMatch","calculateTotalTimeWorked","timeEntries","total","entry","calculateAverageTime","totalMinutes","taskCount","formatTimeOfDay","time","use24Hour","period","getCurrentTime","now","isWorkingHours","date","startHour","endHour","hour","generateSlug","text","truncate","maxLength","ellipsis","capitalize","capitalizeWords","word","camelToTitle","result","snakeToTitle","getInitials","name","generateRandomString","length","chars","i","isValidEmail","email","isValidUrl","url","sanitizeHtml","map","char","normalizeWhitespace","countWords","pluralize","count","plural","formatNumber","num","generateId","isAlphanumeric","stripHtmlTags","html","highlightSearchTerms","searchTerm","regex","calculateProgress","completed","total","calculateCompletionRate","calculateProductivityScore","completedTasks","totalTasks","focusMinutes","targetFocusMinutes","taskScore","focusScore","calculateFocusScore","completedPomodoros","targetPomodoros","calculateAverageCompletionTime","tasks","t","totalTime","sum","task","created","calculateVelocity","days","calculateEstimatedCompletion","remainingTasks","velocity","daysNeeded","completionDate","calculateBurndownRate","initialTasks","elapsedDays","calculateProjectHealth","overdueTasks","targetVelocity","progressScore","overdueScore","velocityScore","calculateTimeUtilization","actualMinutes","estimatedMinutes","calculateEfficiency","totalMinutesWorked","tasksPerHour","calculateStreak","activityDates","sortedDates","d","a","b","streak","today","mostRecent","current","previous","calculatePercentile","value","values","sorted","index","v","calculateWeightedAverage","totalWeight","item","weightedSum","hexToRgb","hex","result","rgbToHex","g","b","toHex","x","getContrastColor","hexColor","rgb","lightenColor","percent","amount","r","darkenColor","addAlpha","alpha","a","hexToRgba","randomColor","isLightColor","isDarkColor","mixColors","color1","color2","weight","rgb1","rgb2","w","generatePalette","baseColor","getColorWithOpacity","opacity","z","taskBaseSchema","z","TASK_LIMITS","PRIORITY_VALUES","TASK_STATUS_VALUES","val","taskDatesSchema","data","createTaskSchema","updateTaskSchema","taskFilterSchema","bulkUpdateTasksSchema","reorderTasksSchema","z","projectBaseSchema","z","PROJECT_LIMITS","createProjectSchema","updateProjectSchema","projectFilterSchema","archiveProjectSchema","duplicateProjectSchema","z","WORKSPACE_TYPES","MEMBER_ROLES","workspaceBaseSchema","z","WORKSPACE_LIMITS","createWorkspaceSchema","updateWorkspaceSchema","workspaceSettingsSchema","inviteMemberSchema","updateMemberRoleSchema","acceptInvitationSchema","transferOwnershipSchema","workspaceFilterSchema","z","tagBaseSchema","z","TAG_LIMITS","createTagSchema","updateTagSchema","tagFilterSchema","assignTagsSchema","z","registerUserSchema","z","USER_LIMITS","loginUserSchema","updateUserProfileSchema","changePasswordSchema","resetPasswordRequestSchema","resetPasswordSchema","userPreferencesSchema","usernameValidationSchema","z","commentBaseSchema","z","COMMENT_LIMITS","createCommentSchema","updateCommentSchema","commentFilterSchema","User","_User","Entity","props","mode","PersonName","Email","HashPassword","ChangeUserName","repo","newName","loggedUser","validName","PersonName","existingUser","RegisterUser","repo","crypto","user","hashedPassword","newUser","User","UserByEmail","repo","email","user","UserLogin","repo","crypto","input","email","password","user","Task","_Task","Entity","props","status","CreateTaskUseCase","repository","input","task","Task","CompleteTaskUseCase","repository","input","task","completedTask","SoftDeleteTaskUseCase","taskRepository","id","RestoreTaskUseCase","taskRepository","id","task","PermanentDeleteTaskUseCase","taskRepository","id","task","GetDeletedTasksUseCase","taskRepository","projectId","Workspace","_Workspace","Entity","props","stats","WorkspaceMember","_WorkspaceMember","Entity","props","WorkspaceSettings","_WorkspaceSettings","Entity","props","WorkspaceAuditLog","_WorkspaceAuditLog","Entity","props","CreateWorkspaceUseCase","workspaceRepository","ownerUsername","props","username","workspaceNameSlug","finalSlug","counter","workspace","Workspace","name","AddMemberToWorkspaceUseCase","workspaceRepository","workspaceId","userId","role","existingMember","member","WorkspaceMember","RemoveMemberFromWorkspaceUseCase","workspaceRepository","workspaceId","userId","workspace","SoftDeleteWorkspaceUseCase","workspaceRepository","id","userId","workspace","RestoreWorkspaceUseCase","workspaceRepository","id","userId","workspace","PermanentDeleteWorkspaceUseCase","workspaceRepository","id","userId","workspace","GetDeletedWorkspacesUseCase","workspaceRepository","userId","ArchiveWorkspaceUseCase","workspaceRepository","id","userId","workspace","archivedWorkspace","WorkspaceInvitation","_WorkspaceInvitation","Entity","props","uuidv4","InviteMemberUseCase","workspaceRepository","invitationRepository","hashService","workspaceId","email","role","invitedById","token","tokenHash","expiresAt","invitation","WorkspaceInvitation","AcceptInvitationUseCase","workspaceRepository","invitationRepository","hashService","token","userId","pendingInvitations","matchedInvitation","invitation","workspaceId","acceptedInvitation","member","WorkspaceMember","UpdateWorkspaceSettingsUseCase","settingsRepository","input","existing","settings","WorkspaceSettings","GetWorkspaceSettingsUseCase","settingsRepository","input","CreateAuditLogUseCase","auditLogRepository","input","log","WorkspaceAuditLog","GetWorkspaceAuditLogsUseCase","auditLogRepository","input","limit","offset","logs","total","Project","_Project","Entity","props","CreateProjectUseCase","projectRepository","props","project","Project","UpdateProjectUseCase","projectRepository","id","props","project","updatedProject","ArchiveProjectUseCase","projectRepository","id","project","updatedProject","DeleteProjectUseCase","projectRepository","id","SoftDeleteProjectUseCase","projectRepository","id","RestoreProjectUseCase","projectRepository","id","project","PermanentDeleteProjectUseCase","projectRepository","id","project","GetDeletedProjectsUseCase","projectRepository","workspaceId","Workflow","_Workflow","Entity","props","CreateWorkflowUseCase","workflowRepository","input","workflow","Workflow","ListWorkflowsUseCase","workflowRepository","workspaceId","UpdateWorkflowUseCase","workflowRepository","input","workflow","updatedWorkflow","DeleteWorkflowUseCase","workflowRepository","id","Tag","_Tag","Entity","props","CreateTagUseCase","tagRepository","props","tag","Tag","AssignTagToTaskUseCase","tagRepository","tagId","taskId","RemoveTagFromTaskUseCase","tagRepository","tagId","taskId","UpdateTagUseCase","tagRepository","id","props","tag","updatedTag","TimeSession","_TimeSession","Entity","props","pauseStartedAt","pauseEndedAt","actualPauseStart","pauseDuration","pauseRecord","endedAt","wasCompleted","wasInterrupted","extraPauseTime","totalMs","activeSeconds","durationMinutes","splitReason","StartTimerUseCase","timerRepository","taskRepository","userId","taskId","type","activeSession","stoppedSession","session","TimeSession","createdSession","task","updatedTask","StopTimerUseCase","timerRepository","userId","wasCompleted","activeSession","stoppedSession","PauseTimerUseCase","timerRepository","userId","pauseStartedAt","activeSession","pausedSession","ResumeTimerUseCase","timerRepository","userId","pauseStartedAt","pauseEndedAt","activeSession","resumedSession","SwitchTaskUseCase","timerRepository","userId","newTaskId","type","splitReason","activeSession","stoppedSession","newSession","TimeSession","createdSession","DailyMetrics","_DailyMetrics","Entity","props","minutes","score","GetDailyMetricsUseCase","analyticsRepository","userId","date","metrics","DailyMetrics","UpdateDailyMetricsUseCase","analyticsRepository","input","normalizedDate","metrics","DailyMetrics","i","CalculateFocusScoreUseCase","input","totalWorkSeconds","totalPauseSeconds","pauseCount","totalTime","workRatio","pausePenalty","focusScore","AIProfile","_AIProfile","Entity","props","userId","hour","score","newScore","dayOfWeek","recentDurations","avgRecent","sum","d","newAvg","completed","total","newRate","updatedRate","category","limit","a","b","day","ProductivityReport","_ProductivityReport","Entity","props","m","parts","hours","mins","limit","LearnFromSessionUseCase","aiProfileRepository","input","session","profile","startedAt","hour","dayOfWeek","productivityScore","updatedProfile","duration","pauseCount","totalPauseTime","wasCompleted","score","pausePenalty","totalSessionTime","workTimeRatio","DAY_NAMES","GetOptimalScheduleUseCase","aiProfileRepository","input","userId","topN","profile","topPeakHours","topPeakDays","recommendation","limit","peakHours","hour","score","a","b","peakDays","day","dayNum","period","topHours","topDays","parts","bestHour","hourList","h","bestDay","dayList","avgDuration","completionRate","PredictTaskDurationUseCase","aiProfileRepository","input","userId","taskTitle","taskDescription","category","priority","profile","estimatedMinutes","confidence","reasoningParts","categoryScore","text","reasoning","keywords","keyword","GenerateWeeklyReportUseCase","reportRepository","analyticsRepository","timerRepository","aiProfileRepository","generateReportData","input","userId","weekStart","startDate","endDate","existing","dailyMetrics","sessions","profile","metricsSnapshot","sum","m","reportData","s","report","ProductivityReport","date","d","day","diff","date1","date2","start1","start2","MockAIService","input","resolve","lowerInput","priority","dueDate","tomorrow","message","context","aiService","Habit","_Habit","Entity","props","dayOfWeek","isConsecutive","newTotal","newStreak","newLongest","Note","_Note","Entity","props","content","x","y","width","height","color","CreateNoteUseCase","repository","input","note","Note","FindNoteUseCase","repository","input","note","UpdateNoteUseCase","repository","input","note","FindNoteUseCase","updatedNote","DeleteNoteUseCase","repository","input","note","FindNoteUseCase","FindAllNotesUseCase","repository","input","Comment","_Comment","Entity","props","mode","newContent","trimmed","userId","currentMentions","id","content","COMMENT_LIMITS","taskId","mentions","mention","CreateCommentUseCase","commentRepository","input","_loggedUser","comment","Comment","UpdateCommentUseCase","commentRepository","input","_loggedUser","existingComment","updatedComment","DeleteCommentUseCase","commentRepository","input","_loggedUser","existingComment","GetCommentsByTaskUseCase","commentRepository","input","_loggedUser","GetCommentsByUserUseCase","commentRepository","input","_loggedUser","AddMentionUseCase","commentRepository","input","_loggedUser","existingComment","updatedComment","RemoveMentionUseCase","commentRepository","input","_loggedUser","existingComment","updatedComment","Attachment","_Attachment","Entity","props","mode","parts","maxSizeMB","taskId","userId","fileName","trimmed","originalName","mimeType","size","maxSizeBytes","FILE_LIMITS","storagePath","CreateAttachmentUseCase","attachmentRepository","input","_loggedUser","attachment","Attachment","MarkAsUploadedUseCase","attachmentRepository","input","_loggedUser","existingAttachment","updatedAttachment","DeleteAttachmentUseCase","attachmentRepository","input","_loggedUser","existingAttachment","GetAttachmentsByTaskUseCase","attachmentRepository","input","_loggedUser","GetAttachmentsByUserUseCase","attachmentRepository","input","_loggedUser","GetAttachmentByIdUseCase","attachmentRepository","input","_loggedUser","attachment","NotificationType","ResourceType","Notification","_Notification","Entity","props","mode","ms","key","defaultValue","metadata","userId","type","validTypes","title","trimmed","NOTIFICATION_LIMITS","message","resourceType","resourceId","CreateNotificationUseCase","notificationRepository","input","_loggedUser","trimmedTitle","trimmedMessage","notification","Notification","MarkAsReadUseCase","notificationRepository","input","_loggedUser","notification","updated","MarkAllAsReadUseCase","notificationRepository","input","_loggedUser","unreadCount","MarkAsUnreadUseCase","notificationRepository","input","_loggedUser","notification","updated","GetUnreadNotificationsUseCase","notificationRepository","input","_loggedUser","userId","sorted","a","b","aHighPriority","bHighPriority","GetNotificationByIdUseCase","notificationRepository","input","_loggedUser","notification","GetNotificationsByTypeUseCase","notificationRepository","input","_loggedUser","DeleteNotificationUseCase","notificationRepository","input","_loggedUser","notification","CountUnreadNotificationsUseCase","notificationRepository","input","_loggedUser","ChangelogEntry","_ChangelogEntry","Entity","props","NewsletterSubscriber","_NewsletterSubscriber","Entity","props","userId","email","ContactSubmission","_ContactSubmission","Entity","props","RoadmapItem","_RoadmapItem","Entity","props","status","weight","RoadmapVote","_RoadmapVote","Entity","props","calculateVoteWeight","plan","BlogPost","_BlogPost","Entity","props","BlogComment","_BlogComment","Entity","props","Achievement","_Achievement","Entity","props","UserAchievement","_UserAchievement","Entity","props","ChatConversation","_ChatConversation","Entity","props","title","ChatMessage","_ChatMessage","Entity","props","TaskTemplate","_TaskTemplate","Entity","props"]}