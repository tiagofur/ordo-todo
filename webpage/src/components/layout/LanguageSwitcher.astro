---
import { getLangFromUrl, useTranslations } from '../../i18n/utils';
import { getRelativeLocaleUrl } from 'astro:i18n';

const currentLang = getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);
const currentPath = Astro.url.pathname;

const languages = [
  { code: 'en', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
  { code: 'es', name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' },
  { code: 'pt-br', name: 'PortuguÃªs', flag: 'ðŸ‡§ðŸ‡·' }
];
---

<div class="relative group">
  <button 
    class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors"
    aria-label={t('nav.language')}
  >
    <span class="text-lg">{languages.find(l => l.code === currentLang)?.flag}</span>
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </button>
  
  <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
    <div class="py-1">
      {languages.map(lang => (
        <a 
          href={getRelativeLocaleUrl(lang.code, currentPath)}
          class={`flex items-center space-x-3 px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${
            lang.code === currentLang ? 'bg-gray-50 dark:bg-gray-900 text-blue-600' : 'text-gray-700 dark:text-gray-300'
          }`}
          aria-label={`Switch to ${lang.name}`}
          lang={lang.code}
        >
          <span class="text-lg" role="img" aria-label={`${lang.name} flag`}>
            {lang.flag}
          </span>
          <span class="font-medium">{lang.name}</span>
          {lang.code === currentLang && (
            <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          )}
        </a>
      ))}
    </div>
  </div>
</div>