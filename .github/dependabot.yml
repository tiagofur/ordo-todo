# Dependabot Configuration - Security-First Approach
# Optimized for maximum security with minimal PR noise
# See: https://docs.github.com/en/code-security/dependabot

version: 2

# Global settings for all ecosystems
# Security updates are handled separately with higher priority

updates:
  # =============================================================================
  # SECURITY-ONLY UPDATES (Immediate, Not Grouped)
  # =============================================================================
  # These run daily and create PRs for security vulnerabilities only
  # Configured per workspace for better tracking

  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "daily"
      time: "03:00"
      timezone: "UTC"
    open-pull-requests-limit: 5
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "security"
      - "ðŸš¨ critical"
    commit-message:
      prefix: "security"
      include: "scope"
    # Only create PRs for security updates
    allow:
      - dependency-type: "all"

  # =============================================================================
  # REGULAR UPDATES (Monthly, Heavily Grouped)
  # =============================================================================
  # Run once per month, group as much as possible to minimize noise

  # Root workspace - All dependencies in 1 PR
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "root"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-dependencies:
        patterns:
          - "*"
    # Ignore security updates here (handled above)
    ignore:
      - dependency-name: "*"
        update-types: ["version-update:semver-patch"]
        # Security patches will be handled by daily security checks

  # Web app - Maximum 2 PRs (frontend + backend concerns)
  - package-ecosystem: "npm"
    directory: "/apps/web"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 2
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "web"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      # Frontend ecosystem - All UI libraries together
      frontend:
        patterns:
          - "next*"
          - "react*"
          - "@next/*"
          - "@radix-ui/*"
          - "lucide-react"
          - "framer-motion"
          - "tailwind*"
          - "@tailwindcss/*"
          - "class-variance-authority"
          - "clsx"
      # Backend/Tools - Everything else
      backend-and-tools:
        patterns:
          - "@prisma/*"
          - "prisma"
          - "@tanstack/*"
          - "zod"
          - "zustand"
          - "*"

  # Backend app - Maximum 2 PRs
  - package-ecosystem: "npm"
    directory: "/apps/backend"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 2
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "backend"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      # NestJS and database
      nestjs-and-database:
        patterns:
          - "@nestjs/*"
          - "@prisma/*"
          - "prisma"
          - "pg"
          - "bcrypt"
      # Other dependencies
      other-dependencies:
        patterns:
          - "*"

  # Mobile app - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/apps/mobile"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "mobile"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-mobile-dependencies:
        patterns:
          - "*"

  # Desktop app - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/apps/desktop"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "desktop"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-desktop-dependencies:
        patterns:
          - "*"

  # Core package - All in 1 PR (minimal dependencies)
  - package-ecosystem: "npm"
    directory: "/packages/core"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "core"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-core-dependencies:
        patterns:
          - "*"

  # UI package - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/packages/ui"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "ui"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-ui-dependencies:
        patterns:
          - "*"

  # Database package - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/packages/db"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "database"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-db-dependencies:
        patterns:
          - "*"

  # Hooks package - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/packages/hooks"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "hooks"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-hooks-dependencies:
        patterns:
          - "*"

  # Stores package - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/packages/stores"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "stores"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-stores-dependencies:
        patterns:
          - "*"

  # API Client package - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/packages/api-client"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "api-client"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-api-client-dependencies:
        patterns:
          - "*"

  # i18n package - All in 1 PR
  - package-ecosystem: "npm"
    directory: "/packages/i18n"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    versioning-strategy: "increase"
    labels:
      - "dependencies"
      - "monthly-update"
      - "i18n"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-i18n-dependencies:
        patterns:
          - "*"

  # GitHub Actions - All in 1 PR, monthly
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 1
    labels:
      - "dependencies"
      - "monthly-update"
      - "github-actions"
    commit-message:
      prefix: "chore"
      include: "scope"
    groups:
      all-github-actions:
        patterns:
          - "*"
