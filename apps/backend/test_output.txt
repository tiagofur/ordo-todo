
> @ordo-todo/backend@1.1.0 test
> jest src/workspaces/workspaces.controller.spec.ts

FAIL src/workspaces/workspaces.controller.spec.ts
  WorkspacesController
    ÔêÜ should be defined (14 ms)
    POST /workspaces
      ÔêÜ should create a new workspace (5 ms)
      ÔêÜ should create workspace with default values (4 ms)
    GET /workspaces
      ÔêÜ should return all workspaces for user (6 ms)
      ÔêÜ should return empty array when user has no workspaces (3 ms)
    GET /workspaces/:id
      ÔêÜ should return workspace by id (4 ms)
    GET /workspaces/by-slug/:slug
      ├ù should return workspace by slug (4 ms)
      ÔêÜ should throw NotFoundException when workspace not found by slug (6 ms)
    GET /workspaces/:username/:slug
      ÔêÜ should return workspace by username and slug (3 ms)
      ÔêÜ should throw NotFoundException when user not found (2 ms)
      ÔêÜ should throw NotFoundException when workspace not found (2 ms)
    PUT /workspaces/:id
      ÔêÜ should update workspace (2 ms)
      ÔêÜ should throw NotFoundException when updating non-existent workspace (2 ms)
    DELETE /workspaces/:id
      ÔêÜ should delete workspace (2 ms)
      ÔêÜ should throw NotFoundException when deleting non-existent workspace (2 ms)
      ÔêÜ should throw ForbiddenException when non-owner tries to delete (6 ms)
    POST /workspaces/:id/archive
      ÔêÜ should archive workspace (2 ms)
      ÔêÜ should throw NotFoundException when archiving non-existent workspace (2 ms)
    GET /workspaces/:id/members
      ÔêÜ should return workspace members (2 ms)
      ÔêÜ should return owner in members list (2 ms)
      ÔêÜ should return empty array when workspace has no members (1 ms)
      ÔêÜ should include virtual owner member for legacy workspaces (2 ms)
    POST /workspaces/:id/members
      ÔêÜ should add member to workspace (2 ms)
      ÔêÜ should add member with ADMIN role (3 ms)
      ÔêÜ should throw NotFoundException when workspace not found (3 ms)
    DELETE /workspaces/:id/members/:userId
      ÔêÜ should remove member from workspace (2 ms)
      ÔêÜ should prevent removing owner member (2 ms)
    POST /workspaces/:id/invitations
      ÔêÜ should create invitation for user (2 ms)
      ÔêÜ should create invitation with default MEMBER role (1 ms)
      ÔêÜ should throw NotFoundException when workspace not found (2 ms)
    GET /workspaces/:id/invitations
      ÔêÜ should return all pending invitations for workspace (1 ms)
      ÔêÜ should return empty array when no invitations exist (1 ms)
    POST /workspaces/invitations/accept
      ÔêÜ should accept invitation and add user as member (2 ms)
      ÔêÜ should be idempotent when accepting invitation twice (3 ms)
      ÔêÜ should throw NotFoundException for invalid token (2 ms)
      ÔêÜ should throw NotFoundException for expired token (2 ms)
    GET /workspaces/:id/settings
      ÔêÜ should return workspace settings (2 ms)
      ÔêÜ should return null when settings not found (2 ms)
    PUT /workspaces/:id/settings
      ÔêÜ should update workspace settings (1 ms)
    GET /workspaces/:id/audit-logs
      ÔêÜ should return audit logs with default pagination (1 ms)
      ÔêÜ should support custom limit and offset (2 ms)
    POST /workspaces/:id/audit-logs
      ÔêÜ should create audit log entry (2 ms)
    Route ordering
      ÔêÜ should match :id/members before :username/:slug (1 ms)

  ÔùÅ WorkspacesController ÔÇ║ GET /workspaces/by-slug/:slug ÔÇ║ should return workspace by slug

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "test-workspace"
    Received: "test-workspace", "user-123"

    Number of calls: 1

      252 |       const result = await controller.findBySlug('test-workspace', mockUser as any);
      253 |
    > 254 |       expect(service.findBySlug).toHaveBeenCalledWith('test-workspace');
          |                                  ^
      255 |       expect(result).toEqual(mockWorkspace);
      256 |     });
      257 |

      at Object.<anonymous> (workspaces/workspaces.controller.spec.ts:254:34)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 42 passed, 43 total
Snapshots:   0 total
Time:        1.946 s, estimated 2 s
Ran all test suites matching src/workspaces/workspaces.controller.spec.ts.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\tfurt\source\repos\ordo-todo\apps\backend
npm error workspace @ordo-todo/backend@1.1.0
npm error location C:\Users\tfurt\source\repos\ordo-todo\apps\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c jest src/workspaces/workspaces.controller.spec.ts
